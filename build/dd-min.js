/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 31 15:21
*/
KISSY.add("dd/ddm",function(i,d,j,f){function h(){h.superclass.constructor.apply(this,arguments)}function b(e){var a;if(e.touches&&1<e.touches.length)n._end();else if(e.preventDefault(),a=this.__activeToDrag)a._move(e);else if(a=this.get("activeDrag"))a._move(e),this.__needDropCheck&&g(this,e,a)}function c(e){e.preventDefault();C.call(this,e)}function g(e,b,g){var c=e.get("validDrops"),k=g.get("mode"),d=0,h=0,l=a(g.get("node")),j=r(l);i.each(c,function(e){if(e.get("disabled"))return f;var c;c=e.getNodeFromTarget(b,
g.get("dragNode")[0],g.get("node")[0]);if(!c)return f;if("point"==k)o(a(c),g.mousePos)&&(c=r(a(c)),d?c<h&&(d=e,h=c):(d=e,h=c));else if("intersect"==k)c=r(w(l,a(c))),c>h&&(h=c,d=e);else if("strict"==k&&(c=r(w(l,a(c))),c==j))return d=e,!1;return f});if((c=e.get("activeDrop"))&&c!=d)c._handleOut(b),g._handleOut(b);e.setInternal("activeDrop",d);d&&(c!=d?d._handleEnter(b):d._handleOver(b))}function k(e){e._shim=u('<div style="background-color:red;position:'+(v?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+
n.get("dragCursor")+";z-index:"+D+';"></div>').prependTo(s.body||s.documentElement).css("opacity",0);k=l;if(v)E.on("resize scroll",x,e);l(e)}function l(e){var a=e.get("activeDrag").get("activeHandler"),b="auto";a&&(b=a.css("cursor"));"auto"==b&&(b=e.get("dragCursor"));e._shim.css({cursor:b,display:"block"});v&&x.call(e)}function m(e){var a=e.get("drops");e.setInternal("validDrops",[]);a.length&&i.each(a,function(e){e._active()})}function p(e){var a=e.get("drops");e.setInternal("validDrops",[]);a.length&&
i.each(a,function(e){e._deActive()})}function a(e){var a=e.offset();return{left:a.left,right:a.left+(e.__dd_cached_width||e.outerWidth()),top:a.top,bottom:a.top+(e.__dd_cached_height||e.outerHeight())}}function o(e,a){return e.left<=a.left&&e.right>=a.left&&e.top<=a.top&&e.bottom>=a.top}function r(a){return a.top>=a.bottom||a.left>=a.right?0:(a.right-a.left)*(a.bottom-a.top)}function w(a,b){var c=Math.max(a.top,b.top),g=Math.min(a.right,b.right),o=Math.min(a.bottom,b.bottom);return{left:Math.max(a.left,
b.left),right:g,top:c,bottom:o}}function y(a){a&&(a.__dd_cached_width=a.outerWidth(),a.__dd_cached_height=a.outerHeight())}var t=i.UA,u=d.all,z=i.Env.host,s=z.document,q=u(s),E=u(z),v=6===t.ie,D=999999,d=d.Gesture,A=d.move,B=d.end;h.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var C=t.ie&&8>t.ie?i.throttle(b,30):b,x=i.throttle(function(){var a;(a=this.get("activeDrag"))&&a.get("shim")&&this._shim.css({width:q.width(),
height:q.height()})},30);i.extend(h,j,{__activeToDrag:0,_regDrop:function(a){this.get("drops").push(a)},_unRegDrop:function(a){var b=this.get("drops"),a=i.indexOf(a,b);-1!=a&&b.splice(a,1)},_regToDrag:function(a){this.__activeToDrag=a;q.on(B,this._end,this);q.on(A,c,this);6===t.ie&&s.body.setCapture()},_start:function(){this.get("drops");var a=this.__activeToDrag;this.setInternal("activeDrag",a);this.__activeToDrag=0;a.get("shim")&&k(this);this.__needDropCheck=0;a.get("groups")&&(m(this),this.get("validDrops").length&&
(y(a.get("node")),this.__needDropCheck=1))},_addValidDrop:function(a){this.get("validDrops").push(a)},_end:function(a){var b=this.__activeToDrag,g=this.get("activeDrag"),o=this.get("activeDrop");a&&(b&&b._move(a),g&&g._move(a));q.detach(A,c,this);q.detach(B,this._end,this);6===t.ie&&s.body.releaseCapture();b&&(b._end(a),this.__activeToDrag=0);this._shim&&this._shim.hide();g&&(g._end(a),p(this),o&&o._end(a),this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}});var n=new h;n.inRegion=
o;n.region=a;n.area=r;n.cacheWH=y;n.PREFIX_CLS="ks-dd-";return n},{requires:["node","base"]});
KISSY.add("dd/draggable",function(i,d,j,f){function h(){return!1}var b=d.all,c=i.each,g=i.UA.ie,k=f.PREFIX_CLS,l=i.Env.host.document,j=j.extend({initializer:function(){this.addTarget(f);this._allowMove=this.get("move")},_onSetNode:function(a){this.setInternal("dragNode",a);this.bindDragEvent()},bindDragEvent:function(){this.get("node").on(d.Gesture.start,p,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(a){a=this;a.get("node").detach(d.Gesture.start,p,a).detach("dragstart",a._fixDragStart)},
_bufferTimer:null,_onSetDisabledChange:function(a){this.get("dragNode")[a?"addClass":"removeClass"](k+"-disabled")},_fixDragStart:function(a){a.preventDefault()},_checkHandler:function(a){var b=this,g=b.get("handlers"),d=0;c(g,function(g){if(g[0]==a||g.contains(a))return d=1,b.setInternal("activeHandler",g),!1});return d},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&1!=a.which||this.get("disabled")?0:1},_prepare:function(a){if(a){var b=this;g&&(m=l.body.onselectstart,l.body.onselectstart=
h);b.get("halt")&&a.stopPropagation();a.preventDefault();var c=a.pageX,d=a.pageY;b.setInternal("startMousePos",b.mousePos={left:c,top:d});if(b._allowMove){var k=b.get("node").offset();b.setInternal("startNodePos",k);b.setInternal("deltaPos",{left:c-k.left,top:d-k.top})}f._regToDrag(b);if(c=b.get("bufferTime"))b._bufferTimer=setTimeout(function(){b._start(a)},1E3*c)}},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(a){var b=a.pageX,
c=a.pageY;if(!this.get("dragging")){var g=this.get("startMousePos"),d=0,k=this.get("clickPixelThresh");if(Math.abs(b-g.left)>=k||Math.abs(c-g.top)>=k)this._start(a),d=1;if(!d)return}this.mousePos={left:b,top:c};a={pageX:b,pageY:c,drag:this};if(g=this._allowMove)d=this.get("deltaPos"),b-=d.left,c-=d.top,a.left=b,a.top=c,this.setInternal("actualPos",{left:b,top:c}),this.fire("dragalign",a);c=1;!1===this.fire("drag",a)&&(c=0);c&&g&&this.get("node").offset(this.get("actualPos"))},stopDrag:function(){f._end()},
_end:function(a){var a=a||{},b;this._clearBufferTimer();g&&(l.body.onselectstart=m);this.get("dragging")&&(this.get("node").removeClass(k+"drag-over"),(b=f.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this,pageX:a.pageX,pageY:a.pageY}))},_handleOut:function(){this.get("node").removeClass(k+"drag-over");this.fire("dragexit",{drag:this,drop:f.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(k+
"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(a){this._clearBufferTimer();this.setInternal("dragging",1);this.setInternal("dragStartMousePos",{left:a.pageX,top:a.pageY});f._start();this.fire("dragstart",{drag:this,pageX:a.pageX,pageY:a.pageY})},destructor:function(){this.detachDragEvent();this.detach()}},{name:"Draggable",ATTRS:{node:{setter:function(a){if(!(a instanceof d))return b(a)}},clickPixelThresh:{valueFn:function(){return f.get("clickPixelThresh")}},
bufferTime:{valueFn:function(){return f.get("bufferTime")}},dragNode:{},shim:{value:!1},handlers:{value:[],getter:function(a){var g=this;a.length||(a[0]=g.get("node"));c(a,function(c,d){"function"===typeof c&&(c=c.call(g));"string"==typeof c&&(c=g.get("node").one(c));c.nodeType&&(c=b(c));a[d]=c});g.setInternal("handlers",a);return a}},activeHandler:{},dragging:{value:!1,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](k+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},
primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:!0},startMousePos:{},dragStartMousePos:{},startNodePos:{},deltaPos:{},actualPos:{}}});j.DropMode={POINT:"point",INTERSECT:"intersect",STRICT:"strict"};i.mix(j,j.DropMode);var m,p=function(a){var b=a.target;this._checkDragStartValid(a)&&this._checkHandler(b)&&this._prepare(a)};return j},{requires:["node","rich-base","./ddm"]});
KISSY.add("dd/draggable-delegate",function(i,d,j,f){var h=d.PREFIX_CLS,b=f.all,c=function(c){var d,f;if(this._checkDragStartValid(c)){d=this.get("handlers");var h=b(c.target);(d=d.length?this._getHandler(h):h)&&(f=this._getNode(d));f&&(this.setInternal("activeHandler",d),this.setInternal("node",f),this.setInternal("dragNode",f),this._prepare(c))}};return j.extend({_onSetNode:function(){},_onSetContainer:function(){this.bindDragEvent()},_onSetDisabledChange:function(b){this.get("container")[b?"addClass":
"removeClass"](h+"-disabled")},bindDragEvent:function(){this.get("container").on(f.Gesture.start,c,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("container").detach(f.Gesture.start,c,this).detach("dragstart",this._fixDragStart)},_getHandler:function(b){for(var c=void 0,d=this.get("container"),f=this.get("handlers");b&&b[0]!==d[0];){i.each(f,function(d){if(b.test(d))return c=b,!1});if(c)break;b=b.parent()}return c},_getNode:function(b){return b.closest(this.get("selector"),
this.get("container"))}},{ATTRS:{container:{setter:function(c){return b(c)}},selector:{},handlers:{value:[],getter:0}}})},{requires:["./ddm","./draggable","node"]});
KISSY.add("dd/droppable",function(i,d,j,f){var h=f.PREFIX_CLS;return j.extend({initializer:function(){this.addTarget(f);f._regDrop(this)},getNodeFromTarget:function(b,c,d){var b=this.get("node"),f=b[0];return f==c||f==d?null:b},_active:function(){var b=f.get("activeDrag"),c=this.get("node"),d=this.get("groups"),b=b.get("groups");a:if(!0===b)d=1;else{for(var k in d)if(b[k]){d=1;break a}d=0}d?(f._addValidDrop(this),c&&(c.addClass(h+"drop-active-valid"),f.cacheWH(c))):c&&c.addClass(h+"drop-active-invalid")},
_deActive:function(){var b=this.get("node");b&&b.removeClass(h+"drop-active-valid").removeClass(h+"drop-active-invalid")},__getCustomEvt:function(b){return i.mix({drag:f.get("activeDrag"),drop:this},b)},_handleOut:function(){var b=this.__getCustomEvt();this.get("node").removeClass(h+"drop-over");this.fire("dropexit",b)},_handleEnter:function(b){b=this.__getCustomEvt(b);b.drag._handleEnter(b);this.get("node").addClass(h+"drop-over");this.fire("dropenter",b)},_handleOver:function(b){b=this.__getCustomEvt(b);
b.drag._handleOver(b);this.fire("dropover",b)},_end:function(){var b=this.__getCustomEvt();this.get("node").removeClass(h+"drop-over");this.fire("drophit",b)},destructor:function(){f._unRegDrop(this)}},{name:"Droppable",ATTRS:{node:{setter:function(b){if(b)return d.one(b)}},groups:{value:{}},disabled:{}}})},{requires:["node","rich-base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(i,d,j,f){function h(){var b=this.get("container"),g=[],f=this.get("selector");b.all(f).each(function(b){d.cacheWH(b);g.push(b)});this.__allNodes=g}var b=j.extend({initializer:function(){d.on("dragstart",h,this)},getNodeFromTarget:function(b,f,h){var j={left:b.pageX,top:b.pageY},b=this.__allNodes,m=0,p=Number.MAX_VALUE;b&&i.each(b,function(a){var b=a[0];b===h||b===f||(b=d.region(a),d.inRegion(b,j)&&(b=d.area(b),b<p&&(p=b,m=a)))});m&&(this.setInternal("lastNode",
this.get("node")),this.setInternal("node",m));return m},_handleOut:function(){b.superclass._handleOut.apply(this,arguments);this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(c){var d=this.get("node"),f=b.superclass._handleOut,h=b.superclass._handleOver,i=b.superclass._handleEnter,j=this.get("lastNode");j[0]!==d[0]?(this.setInternal("node",j),f.apply(this,arguments),this.setInternal("node",d),i.call(this,c)):h.call(this,c)},_end:function(){b.superclass._end.apply(this,
arguments);this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(b){return f.one(b)}}}});return b},{requires:["./ddm","./droppable","node"]});KISSY.add("dd",function(i,d,j,f,h,b){i={Draggable:j,DDM:d,Droppable:h,DroppableDelegate:b,DraggableDelegate:f};return KISSY.DD=i},{requires:["dd/ddm","dd/draggable","dd/draggable-delegate","dd/droppable","dd/droppable-delegate"]});
