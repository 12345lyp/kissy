/*
Copyright 2013, KISSY UI Library v1.31
MIT Licensed
build time: Jul 24 16:34
*/
/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(f,l,q){l=q.Controller.extend({initializer:function(){this.__commands={};this.__controls={}}},{Config:{},XHTML_DTD:l.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{value:1},data:{getter:function(){return this._getData()},setter:function(f){return this._setData(f)}},formatData:{getter:function(){return this._getData(1)},setter:function(f){return this._setData(f)}},customStyle:{value:""},
customLink:{value:[]}}},{xclass:"editor"});l.HTML_PARSER={textarea:function(f){return f.one("."+this.get("prefixCls")+"editor-textarea")}};f.mix(l,f.EventTarget);return KISSY.Editor=l},{requires:["htmlparser","component/base","core"]});
KISSY.add("editor/core/clipboard",function(f,l,q,r){function n(e){this.editor=e;this._init()}function v(e){var b=e.get("document")[0],d=e.getSelection(),s;if(d.getType()==r.SELECTION_ELEMENT&&(s=d.getSelectedElement())){var e=d.getRanges()[0],c=a(b.createTextNode(""));c.insertBefore(s);e.setStartBefore(c);e.setEndAfter(s);d.selectRanges([e]);setTimeout(function(){s.parent()&&(c.remove(),d.selectElement(s))},0)}}var a=f.all,k=f.UA,m=k.ie?"beforepaste":"paste",p=l.RANGE;f.augment(n,{_init:function(){var e=
this,b=e.editor,d=b.get("document"),a=d.one("body"),c=function(c){this.type=c};c.prototype={exec:function(c){var d=this.type;c.focus();setTimeout(function(){k.ie&&("cut"==d?v(c):"paste"==d&&(e._preventPasteEvent(),e._getClipboardDataFromPasteBin()));j(c,d)||alert(w[d])},0)}};a.on(m,e._getClipboardDataFromPasteBin,e);k.ie&&(a.on("paste",e._iePaste,e),d.on("keydown",e._onKeyDown,e),d.on("contextmenu",function(){e._isPreventBeforePaste=1;setTimeout(function(){e._isPreventBeforePaste=0},0)}));b.addCommand("copy",
new c("copy"));b.addCommand("cut",new c("cut"));b.addCommand("paste",new c("paste"))},_onKeyDown:function(a){this.editor.get("mode")==l.WYSIWYG_MODE&&(a.ctrlKey&&86==a.keyCode||a.shiftKey&&45==a.keyCode)&&this._preventPasteEvent()},_stateFromNamedCommand:function(a){var b,d=this.editor;if("paste"==a){this._isPreventBeforePaste=1;try{b=d.get("document")[0].queryCommandEnabled(a)}catch(s){}this._isPreventBeforePaste=0}else b=(a=(a=d.getSelection())&&a.getRanges())&&!(1==a.length&&a[0].collapsed);return b},
_preventPasteEvent:function(){var a=this;a._preventPasteTimer&&clearTimeout(a._preventPasteTimer);a._isPreventPaste=1;a._preventPasteTimer=setTimeout(function(){a._isPreventPaste=0},70)},_iePaste:function(a){var b=this.editor;this._isPreventPaste||(a.preventDefault(),b.execCommand("paste"))},_getClipboardDataFromPasteBin:function(){if(!this._isPreventBeforePaste){var e=this.editor,b=e.get("document")[0];if(!b.getElementById("ke_pastebin")){var d=e.getSelection(),s=new q(b),c=a(k.webkit?"<body></body>":
"<div></div>",b);c.attr("id","ke_pastebin");k.webkit&&c[0].appendChild(b.createTextNode("\u200b"));b.body.appendChild(c[0]);c.css({position:"absolute",top:d.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});c.css("left","-1000px");var h=d.createBookmarks();s.setStartAt(c,p.POSITION_AFTER_START);s.setEndAt(c,p.POSITION_BEFORE_END);s.select(!0);setTimeout(function(){var b,i=c;c=k.webkit&&(b=c.first())&&b.hasClass("Apple-style-span")?b:c;d.selectBookmarks(h);var a=c.html();
i.remove();if(a=f.trim(a.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,"")))b=e.fire("paste",{html:a}),!1!==b&&(void 0!==b&&(a=b),/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(a)?f.use("editor/plugin/word-filter",function(c,b){e.insertHtml(b.toDataFormat(a,e))}):e.insertHtml(a))},0)}}}});var u=function(e,b){var d=e.get("document")[0],s=a(d.body),c=!1,h=function(){c=!0};s.on(b,h);(7<k.ie?d:d.selection.createRange()).execCommand(b);s.detach(b,h);return c},j=k.ie?function(a,b){return u(a,
b)}:function(a,b){try{return a.get("document")[0].execCommand(b)}catch(d){return!1}},w={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},x={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};return{init:function(a){var b;a.docReady(function(){b=new n(a)});var d={copy:1,cut:1,paste:1},s=["copy","cut","paste"];a.on("contextmenu",function(c){var h=c.contextmenu;if(!h.__copy_fix){h.__copy_fix=1;for(c=0;c<
s.length;c++)h.addChild({content:x[s[c]],value:s[c]});h.on("click",function(c){var b=c.target.get("value");d[b]&&(h.hide(),setTimeout(function(){a.execCommand("save");a.execCommand(b);setTimeout(function(){a.execCommand("save")},10)},30))})}for(var g=h.get("children"),c=g.length-1;c--;0<=c){var i=g[c],o;o=i.get?i.get("value"):i.value;d[o]&&(o=!b._stateFromNamedCommand(o),i.set?i.set("disabled",o):i.disabled=o)}})}}},{requires:["./base","./range","./selection","node"]});
KISSY.add("editor/core/dom",function(f,l,q){function r(b,d){var a=b[d?"next":"prev"](n,1);if(a&&a[0].nodeType==k.ELEMENT_NODE){for(var c=[];a.attr("_ke_bookmark")||a._4e_isEmptyInlineRemovable(n);)if(c.push(a),a=d?a.next(n,1):a.prev(n,1),!a)return;if(b._4e_isIdentical(a,n)){for(var h=new p(d?b[0].lastChild:b[0].firstChild);c.length;)c.shift()._4e_move(b,!d,n);a._4e_moveChildren(b,!d,n);a.remove();h[0]&&h[0].nodeType==k.ELEMENT_NODE&&h._4e_mergeSiblings()}}}var n=n,v=l.XHTML_DTD,a=f.DOM,k=a.NodeType,
m=f.UA,p=f.Node,u={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};l.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var j=l.POSITION,w={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,
"table-column":1,"table-cell":1,"table-caption":1},x={hr:1},e=function(b){return b&&(b[0]||b)};q.injectDom({_4e_sameLevel:function(b,d){var d=e(d),a=b.parentNode;return a&&a==d.parentNode},_4e_isBlockBoundary:function(b,d){var e=f.merge(x,d);return!(!w[a.css(b,"display")]&&!e[a.nodeName(b)])},_4e_index:function(b,d){for(var a=b.parentNode.childNodes,c,h=-1,g=0;g<a.length;g++)if(c=a[g],!d||!(3==c.nodeType&&c.previousSibling&&3==c.previousSibling.nodeType))if(h++,c===b)return h;return-1},_4e_move:function(b,
d,a){d=e(d);a?d.insertBefore(b,d.firstChild):d.appendChild(b)},_4e_isIdentical:function(b,d){if(!d)return!1;d=e(d);if(a.nodeName(b)!=a.nodeName(d))return!1;var s=b.attributes,c=d.attributes,h=s.length,g=c.length;if(h!=g)return!1;for(var i=0;i<h;i++){var o=s[i],j=o.name;if(o.specified&&a.attr(b,j)!=a.attr(d,j))return!1}if(8>q.ieEngine)for(i=0;i<g;i++)if(o=c[i],j=o.name,o.specified&&a.attr(b,j)!=a.attr(d,j))return!1;return!0},_4e_isEmptyInlineRemovable:function(b){if(!v.$removeEmpty[a.nodeName(b)])return!1;
for(var b=b.childNodes,d=0,e=b.length;d<e;d++){var c=b[d],h=c.nodeType;if(!(h==k.ELEMENT_NODE&&c.getAttribute("_ke_bookmark"))&&(h==k.ELEMENT_NODE&&!a._4e_isEmptyInlineRemovable(c)||h==a.NodeType.TEXT_NODE&&f.trim(c.nodeValue)))return!1}return!0},_4e_moveChildren:function(b,d,a){d=e(d);if(b!=d)if(a)for(;a=b.lastChild;)d.insertBefore(b.removeChild(a),d.firstChild);else for(;a=b.firstChild;)d.appendChild(b.removeChild(a))},_4e_mergeSiblings:function(b){b=new p(b);u[b.nodeName()]&&(r(b,!0),r(b))},_4e_splitText:function(b,
d){var e=b.ownerDocument;if(b.nodeType==a.NodeType.TEXT_NODE){if(m.ie&&d==b.nodeValue.length){var c=e.createTextNode("");a.insertAfter(c,b);return c}c=b.splitText(d);e.documentMode&&(e=e.createTextNode(""),a.insertAfter(e,c),a.remove(e));return c}},_4e_parents:function(b,d){var a=[];a.__IS_NODELIST=1;do a[d?"push":"unshift"](b);while(b=b.parentNode);return a},_4e_nextSourceNode:function(b,d,j,c){if(c&&!c.call)var h=e(c),c=function(c){return c!==h};var d=!d&&b.firstChild,g=b;if(!d){if(b.nodeType==
k.ELEMENT_NODE&&c&&!1===c(b,!0))return null;d=b.nextSibling}for(;!d&&(g=g.parentNode);){if(c&&!1===c(g,!0))return null;d=g.nextSibling}return!d||c&&!1===c(d)?null:j&&j!=d.nodeType?a._4e_nextSourceNode(d,!1,j,c):d},_4e_previousSourceNode:function(b,d,j,c){if(c&&!c.call)var h=e(c),c=function(c){return c!==h};var d=!d&&b.lastChild,g=b;if(!d){if(b.nodeType==k.ELEMENT_NODE&&c&&!1===c(b,!0))return null;d=b.previousSibling}for(;!d&&(g=g.parentNode);){if(c&&!1===c(g,!0))return null;d=g.previousSibling}return!d||
c&&!1===c(d)?null:j&&d.nodeType!=j?a._4e_previousSourceNode(d,!1,j,c):d},_4e_commonAncestor:function(b,d){d=e(d);if(b===d)return b;if(a.contains(d,b))return d;var j=b;do if(a.contains(j,d))return j;while(j=j.parentNode);return null},_4e_hasAttributes:9>q.ieEngine?function(b){for(var d=b.attributes,a=0;a<d.length;a++){var c=d[a];switch(c.name){case "class":if(b.getAttribute("class"))return!0;break;default:if(c.specified)return!0}}return!1}:function(b){m.gecko&&b.removeAttribute("_moz_dirty");return b.hasAttributes()},
_4e_position:function(b,d){var f=e(d);if(b.compareDocumentPosition)return b.compareDocumentPosition(f);if(b==f)return j.POSITION_IDENTICAL;if(b.nodeType==k.ELEMENT_NODE&&f.nodeType==k.ELEMENT_NODE){if(a.contains(b,f))return j.POSITION_CONTAINS+j.POSITION_PRECEDING;if(a.contains(f,b))return j.POSITION_IS_CONTAINED+j.POSITION_FOLLOWING;if("sourceIndex"in b)return 0>b.sourceIndex||0>f.sourceIndex?j.POSITION_DISCONNECTED:b.sourceIndex<f.sourceIndex?j.POSITION_PRECEDING:j.POSITION_FOLLOWING}for(var c=
a._4e_address(b),f=a._4e_address(f),h=Math.min(c.length,f.length),g=0;g<=h-1;g++)if(c[g]!=f[g])return c[g]<f[g]?j.POSITION_PRECEDING:j.POSITION_FOLLOWING;return c.length<f.length?j.POSITION_CONTAINS+j.POSITION_PRECEDING:j.POSITION_IS_CONTAINED+j.POSITION_FOLLOWING},_4e_address:function(b,d){for(var e=[],c=b.ownerDocument.documentElement,h=b;h&&h!=c;)e.unshift(a._4e_index(h,d)),h=h.parentNode;return e},_4e_remove:function(b,d){var a=b.parentNode;if(a){if(d)for(var c;c=b.firstChild;)a.insertBefore(b.removeChild(c),
b);a.removeChild(b)}return b},_4e_trim:function(b){a._4e_ltrim(b);a._4e_rtrim(b)},_4e_ltrim:function(b){for(var d;d=b.firstChild;){if(d.nodeType==a.NodeType.TEXT_NODE){var e=q.ltrim(d.nodeValue),c=d.nodeValue.length;if(e)e.length<c&&(a._4e_splitText(d,c-e.length),b.removeChild(b.firstChild));else{b.removeChild(d);continue}}break}},_4e_rtrim:function(b){for(var d;d=b.lastChild;){if(d.type==a.NodeType.TEXT_NODE){var e=q.rtrim(d.nodeValue),c=d.nodeValue.length;if(e)e.length<c&&(a._4e_splitText(d,e.length),
b.removeChild(b.lastChild));else{b.removeChild(d);continue}}break}!m.ie&&!m.opera&&(d=b.lastChild)&&1==d.nodeType&&"br"==a.nodeName(d)&&b.removeChild(d)},_4e_appendBogus:function(b){for(var d=b.lastChild;d&&d.nodeType==a.NodeType.TEXT_NODE&&!f.trim(d.nodeValue);)d=d.previousSibling;if(!d||d.nodeType==a.NodeType.TEXT_NODE||"br"!==a.nodeName(d))d=m.opera?b.ownerDocument.createTextNode(""):b.ownerDocument.createElement("br"),b.appendChild(d)},_4e_setMarker:function(b,d,a,c){var b=new p(b),h=b.data("list_marker_id")||
b.data("list_marker_id",f.guid()).data("list_marker_id"),g=b.data("list_marker_names")||b.data("list_marker_names",{}).data("list_marker_names");d[h]=b;g[a]=1;return b.data(a,c)},_4e_clearMarkers:function(b,d,a){var b=new p(b),c=b.data("list_marker_names"),h=b.data("list_marker_id"),g;for(g in c)b.removeData(g);b.removeData("list_marker_names");a&&(b.removeData("list_marker_id"),delete d[h])},_4e_copyAttributes:function(b,d,e){for(var d=new p(d),c=b.attributes,e=e||{},h=0;h<c.length;h++){var g=c[h],
i=g.name.toLowerCase(),o;if(!(i in e))if("checked"==i&&(o=a.attr(b,i)))d.attr(i,o);else if(g.specified||m.ie&&g.value&&"value"==i)o=a.attr(b,i),null===o&&(o=g.nodeValue),d.attr(i,o)}""!==b.style.cssText&&(d[0].style.cssText=b.style.cssText)},_4e_isEditable:function(b){b=a.nodeName(b);return(b=!v.$nonEditable[b]&&(v[b]||v.span))&&b["#text"]},_4e_getByAddress:function(b,a,e){for(var b=b.documentElement,c=0;b&&c<a.length;c++){var h=a[c];if(e)for(var g=-1,i=0;i<b.childNodes.length;i++){var o=b.childNodes[i];
if(!(!0===e&&3==o.nodeType&&o.previousSibling&&3==o.previousSibling.nodeType)&&(g++,g==h)){b=o;break}}else b=b.childNodes[h]}return b}})},{requires:["./base","./utils","node"]});
KISSY.add("editor/core/domIterator",function(f,l){function q(a){1>arguments.length||(this.range=a,this.forceBrBreak=n,this.enlargeBr=r,this.enforceRealBlocks=n,this._||(this._={}))}var r=!0,n=!1,v=f.UA,a=l.Walker,k=l.Range,m=l.RANGE,p=l.ElementPath,u=f.Node,j=f.DOM,w=/^[\r\n\t ]*$/;f.augment(q,{getNextParagraph:function(l){var e,b,d,s,c;if(!this._.lastNode){b=this.range.clone();b.shrink(m.SHRINK_ELEMENT,r);b.enlarge(this.forceBrBreak||!this.enlargeBr?m.ENLARGE_LIST_ITEM_CONTENTS:m.ENLARGE_BLOCK_CONTENTS);
var h=new a(b),g=a.bookmark(r,r);h.evaluator=g;this._.nextNode=h.next();h=new a(b);h.evaluator=g;h=h.previous();this._.lastNode=h._4e_nextSourceNode(r);this._.lastNode&&this._.lastNode[0].nodeType==j.NodeType.TEXT_NODE&&!f.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(g=new k(b.document),g.moveToPosition(this._.lastNode,m.POSITION_AFTER_END),g.checkEndOfBlock()&&(g=new p(g.endContainer),this._.lastNode=(g.block||g.blockLimit)._4e_nextSourceNode(r)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new u(b.document.createTextNode("")),j.insertAfter(this._.lastNode[0],h[0]));b=null}g=this._.nextNode;h=this._.lastNode;for(this._.nextNode=null;g;){var i=n,o=g[0].nodeType!=j.NodeType.ELEMENT_NODE,A=n;if(o)g[0].nodeType==j.NodeType.TEXT_NODE&&w.test(g[0].nodeValue)&&(o=n);else{var C=g.nodeName();if(g._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==C)o=r;else if(!b&&!g[0].childNodes.length&&"hr"!=C){e=g;d=g.equals(h);break}b&&(b.setEndAt(g,m.POSITION_BEFORE_START),
"br"!=C&&(this._.nextNode=g));i=r}else{if(g[0].firstChild){b||(b=new k(this.range.document),b.setStartAt(g,m.POSITION_BEFORE_START));g=new u(g[0].firstChild);continue}o=r}}o&&!b&&(b=new k(this.range.document),b.setStartAt(g,m.POSITION_BEFORE_START));d=(!i||o)&&g.equals(h);if(b&&!i)for(;!g[0].nextSibling&&!d;){C=g.parent();if(C._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){i=r;d||C.equals(h);break}g=C;o=r;d=g.equals(h);A=r}o&&b.setEndAt(g,m.POSITION_AFTER_END);g=g._4e_nextSourceNode(A,null,h);if((d=
!g)||i&&b)break}if(!e){if(!b)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;e=new p(b.startContainer);g=e.blockLimit;i={div:1,th:1,td:1};e=e.block;if((!e||!e[0])&&!this.enforceRealBlocks&&i[g.nodeName()]&&b.checkStartOfBlock()&&b.checkEndOfBlock())e=g;else if(!e||this.enforceRealBlocks&&"li"==e.nodeName())e=new u(this.range.document.createElement(l||"p")),e[0].appendChild(b.extractContents()),e._4e_trim(),b.insertNode(e),s=c=r;else if("li"!=e.nodeName()){if(!b.checkStartOfBlock()||
!b.checkEndOfBlock())e=e.clone(n),e[0].appendChild(b.extractContents()),e._4e_trim(),c=b.splitBlock(),s=!c.wasStartOfBlock,c=!c.wasEndOfBlock,b.insertNode(e)}else d||(this._.nextNode=e.equals(h)?null:b.getBoundaryNodes().endNode._4e_nextSourceNode(r,null,h))}s&&(b=new u(e[0].previousSibling),b[0]&&b[0].nodeType==j.NodeType.ELEMENT_NODE&&("br"==b.nodeName()?b._4e_remove():b[0].lastChild&&"br"==j.nodeName(b[0].lastChild)&&j._4e_remove(b[0].lastChild)));c&&(b=a.bookmark(n,r),s=new u(e[0].lastChild),
s[0]&&s[0].nodeType==j.NodeType.ELEMENT_NODE&&"br"==s.nodeName()&&(v.ie||s.prev(b,1)||s.next(b,1))&&s.remove());this._.nextNode||(this._.nextNode=d||e.equals(h)?null:e._4e_nextSourceNode(r,null,h));return e}});k.prototype.createIterator=function(){return new q(this)};return q},{requires:["./base","./range","./elementPath","./walker","node"]});
KISSY.add("editor",function(f,l,q,r,n,v,a,k,m,p){function u(a,d){var g=a.body;D(function(){a.designMode="on";setTimeout(function(){a.designMode="off";g.focus();arguments.callee.retry||(arguments.callee.retry=b)},50)},function(){a.designMode="off";o.attr(g,"contentEditable",c);o.attr(g,"contentEditable",b);!d&&u(a,1)})}function j(a){a.get("iframe");var b=a.get("textarea")[0],d=a.get("window")[0],t=a.get("document")[0];g.webkit&&(y.on(t,"click",function(a){var c=new C(a.target);f.inArray(c.nodeName(),
["input","select"])&&a.preventDefault()}),y.on(t,"mouseup",function(a){var c=new C(a.target);f.inArray(c.nodeName(),["input","textarea"])&&a.preventDefault()}));if(g.gecko||i||g.opera){var h;h=(new C('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(b);h.on("focus",function(){a.focus()});a.activateGecko=function(){g.gecko&&a.__iframeFocus&&h[0].focus()};a.on("destroy",function(){h.detach();h.remove()})}y.on(d,"focus",function(){g.gecko?u(t,c):g.opera&&
t.body.focus();a.notifySelectionChange()});if(g.gecko)y.on(t,"mousedown",function(){a.__iframeFocus||u(t,c)});if(i&&(y.on(t,"keydown",function(c){if(c.keyCode in{8:1,46:1}){var b=a.getSelection(),d=b.getSelectedElement();if(d){a.execCommand("save");var t=b.getRanges()[0].createBookmark();d.remove();b.selectBookmarks([t]);a.execCommand("save");c.preventDefault()}}}),"CSS1Compat"==t.compatMode)){var e={33:1,34:1};y.on(t,"keydown",function(c){c.keyCode in e&&setTimeout(function(){a.getSelection().scrollIntoView()},
0)})}if(g.webkit)y.on(t,"mousedown",function(c){c=new C(c.target);f.inArray(c.nodeName(),["img","hr","input","textarea","select"])&&a.getSelection().selectElement(c)});if(g.gecko)y.on(t,"dragstart",function(a){var c=new C(a.target);c.nodeName()==="img"&&/ke_/.test(c[0].className)&&a.preventDefault()});r.add(a)}function w(a,c,b,d){var g="",i,e=q.debugUrl("theme/editor-iframe.css");for(i=0;i<b.length;i++)g+=f.substitute('<link href="{href}" rel="stylesheet" />',{href:b[i]});return f.substitute(t,{doctype:8===
h.documentMode?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"${title}",links:g,href:e,style:c,data:d||"&nbsp;",script:a?'<script id="ke_active_script">'+(o.isCustomDomain()?'document.domain="'+h.domain+'";':"")+'parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':""})}function x(a,c){function b(){e=h.document;a.setInternal("document",new C(e));a.setInternal("window",new C(h));d.detach();e.open("text/html","replace");e.write(t);e.close()}var d=a.get("iframe"),t=w(a._UUID,a.get("customStyle"),
a.get("customLink"),c),g=d[0],h=g.contentWindow,e;d.__loaded=1;try{e=h.document}catch(z){if(g.src=g.src,7>i){setTimeout(b,10);return}}b()}function e(a,c){var b=o.getEmptyIframeSrc()||"";b&&(b=' src="'+b+'" ');var b=new C(f.substitute(F,{iframeSrc:b})),d=a.get("textarea");d.hasAttr("tabindex")&&b.attr("tabIndex",g.webkit?-1:d.attr("tabIndex"));d.parent().prepend(b);a.set("iframe",b);a.__docReady=0;if(g.gecko&&!b.__loaded)b.on("load",function(){x(a,c)},a);else x(a,c)}var b=!0,d=d,s=f.all,c=!1,h=document,
g=f.UA,i=g.ie,o=f.DOM,A=o.NodeType,C=f.Node,y=f.Event,D=q.tryThese,t="<!doctype html><html><head>{doctype}<title>{title}</title><link href='{href}' rel='stylesheet' /><style>{style}</style>{links}</head><body class='ks-editor' >{data}{script}</body></html>",F='<iframe style="width:100%;height:100%;border:none;"  frameborder="0"  title="kissy-editor"  allowTransparency="true"  {iframeSrc} ></iframe>',z='<div class="{prefixCls}editor-tools"></div><div class="{prefixCls}editor-textarea-wrap" '+(g.mobile?
'style="overflow:scroll;-webkit-overflow-scrolling:touch;"':"")+"></div><div class='{prefixCls}editor-status'></div>";f.mix(l,{SOURCE_MODE:0,WYSIWYG_MODE:1});var I=l.WYSIWYG_MODE;f.augment(l,{createDom:function(){var a,c=this.get("prefixCls"),b=this.get("textarea"),d;b?(this.set("textarea",b=s(b)),b[0].parentNode&&b[0].parentNode.removeChild(b[0])):this.set("textarea",b=s("<textarea class='"+c+"-editor-textarea'></textarea>"));d=this.get("el");d.html(f.substitute(z,{prefixCls:c}));a=d.one(f.substitute(".{prefixCls}editor-textarea-wrap",
{prefixCls:c}));this._UUID=f.guid();this.set({toolBarEl:d.one(f.substitute(".{prefixCls}editor-tools",{prefixCls:c})),statusBarEl:d.one(f.substitute(".{prefixCls}editor-status",{prefixCls:c}))},{silent:1});b.css("width","100%");b.css("display","none");a.append(b);r.register(this)},renderUI:function(){a.init(this);k.init(this);m.init(this);p.init(this)},bindUI:function(){function a(){c.detach("docReady",a);if(c.get("focused"))c.focus();else{var b=c.getSelection();b&&b.removeAllRanges()}}var c=this,
b,d=c.get("prefixCls"),t=c.get("textarea");if(c.get("attachForm")&&(b=t[0].form))y.on(b,"submit",c.sync,c),c.on("destroy",function(){y.detach(b,"submit",c.sync,c)});c.on("docReady",a);c.on("blur",function(){c.get("el").removeClass(d+"editor-focused")});c.on("focus",function(){c.get("el").addClass(d+"editor-focused")})},_onSetHeight:function(c){var a=this.get("textarea"),b=this.get("toolBarEl"),d=this.get("statusBarEl"),c=parseInt(c,10),c=c-((b&&b.outerHeight()||0)+(d&&d.outerHeight()||0));a.parent().css("height",
c);a.css("height",c)},_onSetMode:function(c){var a=this,b,d=a.get("rendered"),t=a.get("iframe"),g=a.get("textarea");c==I?(d&&a.execCommand("save"),a.on("docReady",b=function(){d&&a.execCommand("save");a.detach("docReady",b)}),a._setData(g.val()),g.hide(),a.fire("wysiwygMode")):(t&&(g.val(a._getData(1,I)),t.hide()),g.show(),a.fire("sourceMode"))},_onSetFocused:function(a){a&&this.__docReady&&this.focus()},destructor:function(){var a=this.get("document")[0],c=this.get("window");this.sync();r.remove(this);
y.remove([a,a.documentElement,a.body,c[0]]);f.each(this.__controls,function(a){a.destroy&&a.destroy()});this.__commands={};this.__controls={}},getControl:function(a){return this.__controls[a]},getControls:function(){return this.__controls},addControl:function(a,c){this.__controls[a]=c},showDialog:function(a,c){var a=a+"/dialog",b=this.__controls[a];b.show(c);this.fire("dialogShow",{dialog:b.dialog,pluginDialog:b,dialogName:a})},addCommand:function(a,c){this.__commands[a]=c},hasCommand:function(a){return this.__commands[a]},
execCommand:function(a){var c=this.__commands[a],b=f.makeArray(arguments);b.shift();b.unshift(this);return c?c.exec.apply(c,b):d},queryCommandValue:function(a){return this.execCommand(q.getQueryCmd(a))},_getData:function(a,c){var b=this.htmlDataProcessor,t;c==d&&(c=this.get("mode"));t=c==I?this.get("document")[0].body.innerHTML:b.toDataFormat(this.get("textarea").val());t=a?b.toHtml(t):b.toServer(t);t=f.trim(t);/^(?:<(p)>)?(?:(?:&nbsp;)|\s)*(?:<\/\1>)?$/.test(t)&&(t="");return t},_setData:function(a){var c,
b=a;if(this.get("mode")!=I)this.get("textarea").val(a);else{if(c=this.htmlDataProcessor)b=c.toDataFormat(a);if(this.get("iframe")){a=this.get("iframe");c=this.get("window")[0];var d=this.get("document")[0];y.remove([d,d.documentElement,d.body,c]);a.remove()}e(this,b)}},sync:function(){this.get("textarea").val(this.get("data"))},getDocHtml:function(){return w(0,this.get("customStyle"),this.get("customLink"),this.get("formatData"))},getSelection:function(){return l.Selection.getSelection(this.get("document")[0])},
focus:function(){var a=this.get("window");if(a){var c=this.get("document")[0],a=a[0];g.ie||a&&a.parent&&a.parent.focus();a&&a.focus();try{c.body.focus()}catch(b){}this.notifySelectionChange()}},blur:function(){this.get("window")[0].blur();this.get("document")[0].body.blur()},addCustomStyle:function(a,c){var b=this.get("window"),d=this.get("customStyle")||"";this.set("customStyle",d+("\n"+a));b&&o.addStyleSheet(b,a,c)},removeCustomStyle:function(a){o.remove(o.get("#"+a,this.get("window")[0]))},addCustomLink:function(a){var c=
this.get("customLink")||[],b=this.get("document")[0];c.push(a);this.set("customLink",c);c=b.createElement("link");c.rel="stylesheet";b.getElementsByTagName("head")[0].appendChild(c);c.href=a},removeCustomLink:function(a){for(var c=this.get("document")[0],c=o.query("link",c),b=0;b<c.length;b++)o.attr(c[b],"href")==a&&o.remove(c[b]);c=this.get("customLink")||[];a=f.indexOf(a,c);-1!=a&&c.splice(a,1)},docReady:function(a){this.on("docReady",a);this.__docReady&&a.call(this)},checkSelectionChange:function(){var a=
this;a.__checkSelectionChangeId&&clearTimeout(a.__checkSelectionChangeId);a.__checkSelectionChangeId=setTimeout(function(){var c=a.getSelection();if(c&&!c.isInvalid){var b=c.getStartElement(),d=new l.ElementPath(b);if(!a.__previousPath||!a.__previousPath.compare(d))a.__previousPath=d,a.fire("selectionChange",{selection:c,path:d,element:b})}},100)},notifySelectionChange:function(){this.__previousPath=null;this.checkSelectionChange()},insertElement:function(a){if(this.get("mode")!==I)return d;this.focus();
var c,t=a.nodeName(),g=l.XHTML_DTD,h=g.$block[t],i=l.RANGE,e=(t=this.getSelection())&&t.getRanges(),z,F,o;if(!e||0==e.length)return d;this.execCommand("save");for(F=e.length-1;0<=F;F--)z=e[F],c=!F&&a||a.clone(b),z.insertNodeByDtd(c),o||(o=c);if(!o)return d;z.moveToPosition(o,i.POSITION_AFTER_END);h&&(a=l.Walker.whitespaces(!0),(a=(o=o.next(a,1))&&o[0].nodeType==A.ELEMENT_NODE&&o.nodeName())&&g.$block[a]&&g[a]["#text"]&&z.moveToElementEditablePosition(o));t.selectRanges([z]);this.focus();c&&1==c[0].nodeType&&
c.scrollIntoView(d,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0});G.call(this);return c},insertHtml:function(a,b){var t=this,g,h=t.get("document")[0];if(t.get("mode")===I){if(g=t.htmlDataProcessor)a=g.toDataFormat(a,b);t.focus();t.execCommand("save");if(i){g=h.selection;"Control"==g.type&&g.clear();try{g.createRange().pasteHTML(a)}catch(e){}}else try{h.execCommand("inserthtml",c,a)}catch(z){setTimeout(function(){if(0==t.getSelection().getRanges().length){var b=new l.Range(h),g=
o.first(h.body,function(a){return 1==a.nodeType&&"br"!=o.nodeName(a)});g||(g=new C(h.createElement("p")),g._4e_appendBogus(d),h.body.appendChild(g[0]));b.setStartAt(g,l.RANGE.POSITION_AFTER_START);b.select()}h.execCommand("inserthtml",c,a)},50)}setTimeout(function(){t.getSelection().scrollIntoView()},50);G.call(t)}},insertHTML:function(a,c){return this.insertHtml(a,c)}});l._initIFrame=function(a){var d=r.getInstance(a),t=d.get("document")[0],a=t.getElementById("ke_active_script");o.remove(a);j(d);
var h=t.body;i?(h.hideFocus=b,h.disabled=b,h.contentEditable=b,h.removeAttribute("disabled")):setTimeout(function(){g.gecko||g.opera?h.contentEditable=b:g.webkit?h.parentNode.contentEditable=b:t.designMode="on"},0);if(g.gecko||g.opera){var e=t.documentElement;y.on(e,"mousedown",function(a){if(a.target==e){g.gecko&&u(t,c);d.activateGecko()}})}setTimeout(function(){i&&setTimeout(function(){if(t){h.runtimeStyle.marginBottom="0px";h.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){d.__docReady=
1;d.fire("docReady");var a=d.get("disableObjectResizing"),b=d.get("disableInlineTableEditing");if(a||b)try{t.execCommand("enableObjectResizing",c,!a);t.execCommand("enableInlineTableEditing",c,!b)}catch(g){y.on(h,i?"resizestart":"resize",function(c){var d=new C(c.target);(a||d.nodeName()==="table"&&b)&&c.preventDefault()})}},10)};var G=f.buffer(function(){this.execCommand("save")},50);return l},{requires:"editor/core/base,editor/core/utils,editor/core/focusManager,editor/core/styles,editor/core/zIndexManager,editor/core/clipboard,editor/core/enterKey,editor/core/htmlDataProcessor,editor/core/selectionFix".split(",")});
KISSY.add("editor/core/elementPath",function(f,l){function q(f){for(var p=v,l=v,j=[];f;){if(f[0].nodeType==r.NodeType.ELEMENT_NODE){this.lastElement||(this.lastElement=f);var w=f.nodeName();if(!l&&(!p&&a[w]&&(p=f),k[w])){var q;if(q=!p)if(q="div"==w){a:{q=f[0].childNodes;for(var e=0,b=q.length;e<b;e++){var d=q[e];if(d.nodeType==r.NodeType.ELEMENT_NODE&&n.$block[d.nodeName.toLowerCase()]){q=!0;break a}}q=!1}q=!q}q?p=f:l=f}j.push(f);if("body"==w)break}f=f.parent()}this.block=p;this.blockLimit=l;this.elements=
j}var r=f.DOM,n=l.XHTML_DTD,v=null,a={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},k={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};q.prototype={constructor:q,compare:function(a){var f=this.elements,a=a&&a.elements;if(!a||f.length!=a.length)return!1;for(var k=0;k<f.length;k++)if(!r.equals(f[k],a[k]))return!1;return!0},contains:function(a){for(var f=this.elements,k=0;k<f.length;k++)if(f[k].nodeName()in a)return f[k];return v},toString:function(){var a=
this.elements,f,k=[];for(f=0;f<a.length;f++)k.push(a[f].nodeName());return k.toString()}};return l.ElementPath=q},{requires:["./base","./dom","node"]});
KISSY.add("editor/core/enterKey",function(f,l,q,r){function n(j){var l;l=j.getSelection().getRanges();for(var n=l.length-1;0<n;n--)l[n].deleteContents();l=l[0];n=l.document;if(l.checkStartOfBlock()&&l.checkEndOfBlock()){var e=(new r(l.startContainer)).block;if(e&&("li"==e.nodeName()||"li"==e.parent().nodeName()))return j.hasCommand("outdent")?(j.execCommand("save"),j.execCommand("outdent"),j.execCommand("save"),!0):!1}var b=l.splitBlock("p");if(!b)return!0;var j=b.previousBlock,e=b.nextBlock,d=b.wasStartOfBlock,
s=b.wasEndOfBlock,c;if(e)c=e.parent(),"li"==c.nodeName()&&(e._4e_breakParent(c),e._4e_move(e.next(),!0));else if(j&&(c=j.parent())&&"li"==c.nodeName())j._4e_breakParent(c),l.moveToElementEditablePosition(j.next()),j._4e_move(j.prev());if(!d&&!s){if("li"==e.nodeName()&&(c=e.first(q.invisible(!0)))&&f.inArray(c.nodeName(),["ul","ol"]))(a.ie?new p(n.createTextNode("\u00a0")):new p(n.createElement("br"))).insertBefore(c);e&&l.moveToElementEditablePosition(e)}else{var h;if(j){if("li"==j.nodeName()||!k.test(j.nodeName()))h=
j.clone()}else e&&(h=e.clone());h||(h=new p("<p>",null,n));if(c=b.elementPath)for(var b=0,g=c.elements.length;b<g;b++){var i=c.elements[b];if(i.equals(c.block)||i.equals(c.blockLimit))break;m.$removeEmpty[i.nodeName()]&&(i=i.clone(),h._4e_moveChildren(i),h.append(i))}a.ie||h._4e_appendBogus();l.insertNode(h);if(a.ie&&d&&(!s||!j[0].childNodes.length))l.moveToElementEditablePosition(s?j:h),l.select();l.moveToElementEditablePosition(d&&!s?e:h)}a.ie||(e?(h=new p(n.createElement("span")),h.html("&nbsp;"),
l.insertNode(h),h.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}),l.deleteContents()):h.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}));l.select();return!0}function v(a){var f=a.get("document")[0];u.on(f,"keydown",function(f){if(13===f.keyCode&&!f.shiftKey&&!f.ctrlKey&&!f.metaKey){a.execCommand("save");var e=a.execCommand("enterBlock");a.execCommand("save");!1!==e&&f.preventDefault()}})}var a=f.UA,k=/^h[1-6]$/,m=l.XHTML_DTD,
p=f.Node,u=f.Event;return{init:function(a){a.addCommand("enterBlock",{exec:n});a.docReady(function(){v(a)})}}},{requires:["./base","./walker","./elementPath","node"]});
KISSY.add("editor/core/focusManager",function(f){function l(){var f=this;f.__iframeFocus=m;k=f;a&&clearTimeout(a);a=setTimeout(function(){f.fire("focus")},100)}function q(){var f=this;f.__iframeFocus=p;k=u;a&&clearTimeout(a);a=setTimeout(function(){f.fire("blur")},100)}var r=f.Editor,n=f.Event,v={},a,k,f={refreshAll:function(){for(var a in v){var f=v[a].get("document")[0];f.designMode="off";f.designMode="on"}},currentInstance:function(){return k},getInstance:function(a){return v[a]},add:function(a){var f=
a.get("window")[0];n.on(f,"focus",l,a);n.on(f,"blur",q,a)},register:function(a){v[a._UUID]=a},remove:function(a){delete v[a._UUID];var f=a.get("window")[0];n.remove(f,"focus",l,a);n.remove(f,"blur",q,a)}},m=!0,p=!1,u=null;f.refreshAll=f.refreshAll;r.focusManager=f;r.getInstances=function(){return v};return f},{requires:["./base","./dom"]});
KISSY.add("editor/core/htmlDataProcessor",function(f,l,q){return{init:function(r){function n(a){var a=a.childNodes,c,b,d,h=a.length;if(h){d=1;for(c=0;c<h;c++)if(b=a[c],b.nodeType!=f.DOM.NodeType.TEXT_NODE||b.nodeValue){d=0;break}return d?!1:void 0}return!1}function v(a){return a.replace(w,function(a,c,b){return"<"+c+b.replace(x,function(a,c){return-1==b.indexOf("_ke_saved_"+c)?" _ke_saved_"+a+" "+a:a})+">"})}function a(a){return a.replace(b,function(a){return"<ke:encoded>"+encodeURIComponent(a)+"</ke:encoded>"})}
function k(a){return a.replace(d,function(a,c){return f.urlDecode(c)})}var m=f.Node,p=f.UA,u=new q.Filter,j=new q.Filter;(function(){function a(c){c=q.serialize(c);return new q.Comment(e+encodeURIComponent(c).replace(/--/g,"%2D%2D"))}var c={tagNames:[[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]],tags:{script:a,noscript:a,span:n}},b={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(a){if(a.attributes.length)for(var c=["name","href","src"],
b,d=0;d<c.length;d++)b="_ke_saved_"+c[d],a.getAttribute(b)&&a.removeAttribute(c[d]);return a},embed:function(a){var c=a.parentNode;if(c&&"object"==c.nodeName){var b=c.getAttribute("width"),c=c.getAttribute("height");b&&a.setAttribute("width",b);c&&a.setAttribute("width",c)}},a:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1},span:n,strong:n,em:n,del:n,u:n},attributes:{style:function(a){if(!f.trim(a))return!1}},attributeNames:[[/^_ke_saved_/,""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,
""],[/^_ks.*/,""]],comment:function(a){if(a.substr(0,e.length)==e)return a=f.trim(f.urlDecode(a.substr(e.length))),q.parse(a).childNodes[0]}};p.ie&&(b.attributes.style=function(a){return a.replace(/(^|;)([^:]+)/g,function(a){return a.toLowerCase()})});u.addRules(b);j.addRules(c)})();(function(){function a(c){for(var c=c.childNodes,b=c.length,d=c[b-1];d&&3==d.nodeType&&!f.trim(d.nodeValue);)d=c[--b];return d}function c(b){var d=a(b);d&&(1==d.nodeType&&"br"==d.nodeName?b.removeChild(d):3==d.nodeType&&
e.test(d.nodeValue)&&b.removeChild(d))}function b(c){var d=a(c);return!d||"form"==c.nodeName&&"input"==d.nodeName}function d(a){c(a);b(a)&&(p.ie||a.appendChild(new q.Tag("br")))}function h(a){c(a);b(a)&&a.appendChild(new q.Text("\u00a0"))}var e=/^[\t\r\n ]*(?:&nbsp;|\xa0)[\t\r\n ]*$/,k=l.XHTML_DTD,t=f.merge(k.$block,k.$listItem,k.$tableContent),F;for(F in t)"br"in k[F]||delete t[F];delete t.pre;var k={tags:{}},z={tags:{}};for(F in t)k.tags[F]=d,z.tags[F]=h;j.addRules(k);u.addRules(z)})();u.addRules({text:function(a){return a.replace(/\xa0/g,
"&nbsp;")}});var w=/<(a|area|img|input)\b([^>]*)>/gi,x=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,e="{ke_protected}",b=/(?:<textarea[^>]*>[\s\S]*<\/textarea>)|(?:<style[^>]*>[\s\S]*<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,d=/<ke:encoded>([^<]*)<\/ke:encoded>/gi,s=/(<\/?)((?:object|embed|param|html|body|head|title|script|noscript)[^>]*>)/gi,c=/(<\/?)ke:((?:object|embed|param|html|body|head|title|script|noscript)[^>]*>)/gi,h=/<ke:(param|embed)([^>]*?)\/?>(?!\s*<\/ke:\1)/gi;
r.htmlDataProcessor={dataFilter:j,htmlFilter:u,toHTML:function(a){p.webkit&&(a=a.replace(/\u200b/g,""));var c=new q.BeautifyWriter;(new q.Parser(a)).parse().writeHtml(c,u);return a=c.getHtml()},toDataFormat:function(b,d){var d=d||j,b=a(b),b=v(b),b=b.replace(s,"$1ke:$2"),b=b.replace(h,"<ke:$1$2></ke:$1>"),e=new m("<div>");e.html("a"+b);b=e.html().substr(1);b=b.replace(c,"$1$2");b=k(b);e=new q.BasicWriter;(new q.Parser(b)).parse().writeHtml(e,d);return b=e.getHtml()},toServer:function(a){var c=new q.MinifyWriter;
(new q.Parser(a)).parse().writeHtml(c,u);return c.getHTML()}}}}},{requires:["./base","htmlparser"]});
KISSY.config("modules",{"editor/plugin/heading/cmd":{requires:["editor"]},"editor/plugin/page-break/index":{requires:["editor","editor/plugin/fake-objects/"]},"editor/plugin/italic/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/font-size/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/image/dialog":{requires:["ajax","editor","editor/plugin/overlay/","tabs","editor/plugin/menubutton/"]},"editor/plugin/underline/index":{requires:["editor","editor/plugin/font/ui",
"editor/plugin/underline/cmd"]},"editor/plugin/maximize/cmd":{requires:["editor"]},"editor/plugin/contextmenu/index":{requires:["editor","menu","editor/plugin/focus-fix/"]},"editor/plugin/heading/index":{requires:["editor","editor/plugin/heading/cmd"]},"editor/plugin/drag-upload/index":{requires:["editor"]},"editor/plugin/color/cmd":{requires:["editor"]},"editor/plugin/code/index":{requires:["editor","editor/plugin/dialog-loader/"]},"editor/plugin/flash/dialog":{requires:["editor","editor/plugin/flash-common/utils",
"editor/plugin/overlay/","editor/plugin/menubutton/"]},"editor/plugin/strike-through/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/unordered-list/index":{requires:["editor","editor/plugin/list-utils/btn","editor/plugin/unordered-list/cmd"]},"editor/plugin/outdent/cmd":{requires:["editor","editor/plugin/dent-utils/cmd"]},"editor/plugin/italic/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/italic/cmd"]},"editor/plugin/remove-format/cmd":{requires:["editor"]},
"editor/plugin/font-size/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/font-size/cmd"]},"editor/plugin/indent/cmd":{requires:["editor","editor/plugin/dent-utils/cmd"]},"editor/plugin/table/index":{requires:["editor","editor/plugin/dialog-loader/","editor/plugin/contextmenu/"]},"editor/plugin/word-filter/dynamic/index":{requires:["htmlparser"]},"editor/plugin/justify-left/cmd":{requires:["editor/plugin/justify-utils/cmd"]},"editor/plugin/resize/index":{requires:["editor","dd/base"]},
"editor/plugin/video/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton/"]},"editor/plugin/focus-fix/index":{requires:["editor"]},"editor/plugin/xiami-music/index":{requires:["editor","editor/plugin/flash-common/baseClass","editor/plugin/flash-common/utils","editor/plugin/fake-objects/"]},"editor/plugin/maximize/index":{requires:["editor","editor/plugin/maximize/cmd"]},"editor/plugin/color/color-picker/dialog":{requires:["editor","editor/plugin/overlay/"]},"editor/plugin/smiley/index":{requires:["editor",
"editor/plugin/overlay/"]},"editor/plugin/separator/index":{requires:["editor"]},"editor/plugin/video/index":{requires:["editor","editor/plugin/flash-common/utils","editor/plugin/flash-common/baseClass","editor/plugin/fake-objects/"]},"editor/plugin/multiple-upload/index":{requires:["editor","editor/plugin/dialog-loader/"]},"editor/plugin/undo/btn":{requires:["editor","editor/plugin/button/"]},"editor/plugin/menubutton/index":{requires:["editor","menubutton"]},"editor/plugin/flash/index":{requires:["editor",
"editor/plugin/flash-common/baseClass","editor/plugin/flash-common/utils","editor/plugin/fake-objects/"]},"editor/plugin/overlay/index":{requires:["editor","overlay","editor/plugin/focus-fix/","dd/plugin/constrain","component/plugin/drag"]},"editor/plugin/link/utils":{requires:["editor"]},"editor/plugin/xiami-music/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton/"]},"editor/plugin/list-utils/cmd":{requires:["editor","editor/plugin/list-utils/"]},"editor/plugin/button/index":{requires:["editor",
"button"]},"editor/plugin/checkbox-source-area/index":{requires:["editor"]},"editor/plugin/strike-through/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/strike-through/cmd"]},"editor/plugin/fore-color/index":{requires:["editor","editor/plugin/color/btn","editor/plugin/fore-color/cmd"]},"editor/plugin/flash-bridge/index":{requires:["swf","editor"]},"editor/plugin/fore-color/cmd":{requires:["editor/plugin/color/cmd"]},"editor/plugin/table/dialog":{requires:["editor","editor/plugin/overlay/",
"editor/plugin/menubutton/"]},"editor/plugin/justify-utils/cmd":{requires:["editor"]},"editor/plugin/undo/index":{requires:["editor","editor/plugin/undo/btn","editor/plugin/undo/cmd"]},"editor/plugin/justify-right/cmd":{requires:["editor/plugin/justify-utils/cmd"]},"editor/plugin/image/index":{requires:["editor","editor/plugin/button/","editor/plugin/bubble/","editor/plugin/contextmenu/","editor/plugin/dialog-loader/"]},"editor/plugin/dent-utils/cmd":{requires:["editor","editor/plugin/list-utils/"]},
"editor/plugin/ordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]},"editor/plugin/list-utils/index":{requires:["editor"]},"editor/plugin/dialog-loader/index":{requires:["overlay","editor"]},"editor/plugin/flash-common/utils":{requires:["swf"]},"editor/plugin/font-family/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/font-family/cmd"]},"editor/plugin/undo/cmd":{requires:["editor"]},"editor/plugin/indent/index":{requires:["editor","editor/plugin/indent/cmd"]},"editor/plugin/font/cmd":{requires:["editor"]},
"editor/plugin/ordered-list/index":{requires:["editor","editor/plugin/list-utils/btn","editor/plugin/ordered-list/cmd"]},"editor/plugin/color/btn":{requires:["editor","editor/plugin/button/","editor/plugin/overlay/","editor/plugin/dialog-loader/"]},"editor/plugin/bold/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/local-storage/index":{requires:["editor","overlay","editor/plugin/flash-bridge/"]},"editor/plugin/bubble/index":{requires:["overlay","editor"]},"editor/plugin/underline/cmd":{requires:["editor",
"editor/plugin/font/cmd"]},"editor/plugin/bold/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/bold/cmd"]},"editor/plugin/back-color/index":{requires:["editor","editor/plugin/color/btn","editor/plugin/back-color/cmd"]},"editor/plugin/draft/index":{requires:["editor","editor/plugin/local-storage/","overlay","editor/plugin/menubutton/"]},"editor/plugin/link/index":{requires:["editor","editor/plugin/bubble/","editor/plugin/link/utils","editor/plugin/dialog-loader/","editor/plugin/button/"]},
"editor/plugin/remove-format/index":{requires:["editor","editor/plugin/remove-format/cmd","editor/plugin/button/"]},"editor/plugin/font/ui":{requires:["editor","editor/plugin/button/","editor/plugin/menubutton/"]},"editor/plugin/element-path/index":{requires:["editor"]},"editor/plugin/source-area/index":{requires:["editor","editor/plugin/button/"]},"editor/plugin/justify-right/index":{requires:["editor","editor/plugin/justify-right/cmd"]},"editor/plugin/list-utils/btn":{requires:["editor","editor/plugin/button/",
"editor/plugin/menubutton/"]},"editor/plugin/justify-left/index":{requires:["editor","editor/plugin/justify-left/cmd"]},"editor/plugin/outdent/index":{requires:["editor","editor/plugin/outdent/cmd"]},"editor/plugin/fake-objects/index":{requires:["editor"]},"editor/plugin/font-family/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/back-color/cmd":{requires:["editor/plugin/color/cmd"]},"editor/plugin/link/dialog":{requires:["editor","editor/plugin/overlay/","editor/plugin/link/utils"]},
"editor/plugin/multiple-upload/dialog":{requires:"editor,component/plugin/drag,editor/plugin/progressbar/,editor/plugin/overlay/,editor/plugin/flash-bridge/,editor/plugin/local-storage/,swf".split(",")},"editor/plugin/code/dialog":{requires:["editor","editor/plugin/overlay/","menubutton"]},"editor/plugin/justify-center/cmd":{requires:["editor/plugin/justify-utils/cmd"]},"editor/plugin/flash-common/baseClass":{requires:["editor","editor/plugin/contextmenu/","editor/plugin/bubble/","editor/plugin/dialog-loader/",
"editor/plugin/flash-common/utils"]},"editor/plugin/justify-center/index":{requires:["editor","editor/plugin/justify-center/cmd"]},"editor/plugin/unordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});
KISSY.add("editor/core/range",function(f,l,q,r,n){function v(a){var b=a.nodeType!=d.NodeType.TEXT_NODE&&d.nodeName(a)in c.$removeEmpty,h=a.nodeType==d.NodeType.TEXT_NODE&&!f.trim(a.nodeValue),a=!!a.parentNode.getAttribute("_ke_bookmark");return b||h||a}function a(a){return!o(a)&&!A(a)}function k(a){var c=w;return function(b){if(A(b))return j;if(b.nodeType==d.NodeType.TEXT_NODE){if(f.trim(b.nodeValue).length)return w}else if(b.nodeType==d.NodeType.ELEMENT_NODE&&(b=d.nodeName(b),!D[b]))if(!a&&!s.ie&&
"br"==b&&!c)c=j;else return w;return j}}function m(a,c){var b=a.startContainer,g=a.endContainer,e=a.startOffset,i=a.endOffset,f,o=w,k=w,l=void 0,m=a.document,p;0<c&&(l=m.createDocumentFragment());if(a.collapsed)return l;a.optimizeBookmark();g[0].nodeType==d.NodeType.TEXT_NODE?(k=j,g=g._4e_splitText(i)):0<g[0].childNodes.length&&(i>=g[0].childNodes.length?(g=new h(g[0].appendChild(m.createTextNode(""))),p=j):g=new h(g[0].childNodes[i]));b[0].nodeType==d.NodeType.TEXT_NODE?(o=j,b._4e_splitText(e)):
e?e>=b[0].childNodes.length?(b=new h(b[0].appendChild(m.createTextNode(""))),f=j):b=new h(b[0].childNodes[e].previousSibling):(f=new h(m.createTextNode("")),b.prepend(f),b=f,f=j);var H=b._4e_parents(),K=g._4e_parents();H.each(function(a,c){H[c]=a});K.each(function(a,c){K[c]=a});for(var E,N,m=0;m<H.length&&!(E=H[m],N=K[m],!E.equals(N));m++);for(var e=l,B,J,A=m;A<H.length;A++){B=H[A];i=0<c&&!B.equals(b)?e.appendChild(B.clone()[0]):null;B=B[0].nextSibling;J=K[A];for(var n=g[0],s=J&&J[0];B&&!(s==B||n==
B);)J=B.nextSibling,2==c?e.appendChild(B.cloneNode(j)):(d._4e_remove(B),1==c&&e.appendChild(B)),B=J;i&&(e=i)}for(e=l;m<K.length;m++){B=K[m];i=0<c&&!B.equals(g)?e.appendChild(B.clone()[0]):null;if(!H[m]||!B._4e_sameLevel(H[m]))for(B=B[0].previousSibling;B;)J=B.previousSibling,2==c?e.insertBefore(B.cloneNode(j),e.firstChild):(d._4e_remove(B),1==c&&e.insertBefore(B,e.firstChild)),B=J;i&&(e=i)}if(2==c){if(o&&(E=b[0],E.nodeType==d.NodeType.TEXT_NODE&&E.nextSibling&&E.nextSibling.nodeType==d.NodeType.TEXT_NODE&&
(E.data+=E.nextSibling.data,E.parentNode.removeChild(E.nextSibling))),k)k=g[0],k.nodeType==d.NodeType.TEXT_NODE&&k.previousSibling&&k.previousSibling.nodeType==d.NodeType.TEXT_NODE&&(k.previousSibling.data+=k.data,k.parentNode.removeChild(k))}else{if(E&&N&&(!b._4e_sameLevel(E)||!g._4e_sameLevel(N)))k=E._4e_index(),f&&E._4e_sameLevel(b)&&k--,a.setStart(E.parent(),k+1);a.collapse(j)}f&&b.remove();p&&g.remove();return l}function p(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer[0]==
a.endContainer[0]&&a.startOffset==a.endOffset}function u(a){this.endOffset=this.endContainer=this.startOffset=this.startContainer=x;this.collapsed=j;this.document=a}l.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var j=!0,w=!1,x=null,e=l.RANGE,b=l.POSITION,d=f.DOM,s=f.UA,c=l.XHTML_DTD,h=f.Node,g=h.all,i={area:1,base:1,br:1,col:1,hr:1,
img:1,input:1,link:1,meta:1,param:1},o=new r.whitespaces,A=new r.bookmark,C=r.whitespaces(j),y=r.bookmark(!1,!0),D={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};f.augment(u,{toString:function(){var a=[],c=this.startContainer[0],b=this.endContainer[0];a.push((c.id||c.nodeName)+":"+this.startOffset);a.push((b.id||b.nodeName)+":"+this.endOffset);return a.join("<br/>")},optimize:function(){var a=
this.startContainer,c=this.startOffset;a[0].nodeType!=d.NodeType.ELEMENT_NODE&&(c?c>=a[0].nodeValue.length&&this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;c=this.endOffset;a[0].nodeType!=d.NodeType.ELEMENT_NODE&&(c?c>=a[0].nodeValue.length&&this.setEndAfter(a):this.setEndBefore(a))},setStartAfter:function(a){this.setStart(a.parent(),a._4e_index()+1)},setStartBefore:function(a){this.setStart(a.parent(),a._4e_index())},setEndAfter:function(a){this.setEnd(a.parent(),a._4e_index()+
1)},setEndBefore:function(a){this.setEnd(a.parent(),a._4e_index())},optimizeBookmark:function(){var a=this.startContainer,c=this.endContainer;a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setStartBefore(a);c&&"span"==c.nodeName()&&c.attr("_ke_bookmark")&&this.setEndAfter(c)},setStart:function(a,c){a[0].nodeType==d.NodeType.ELEMENT_NODE&&i[a.nodeName()]&&(a=a.parent(),c=a._4e_index());this.startContainer=a;this.startOffset=c;this.endContainer||(this.endContainer=a,this.endOffset=c);p(this)},
setEnd:function(a,c){a[0].nodeType==d.NodeType.ELEMENT_NODE&&i[a.nodeName()]&&(a=a.parent(),c=a._4e_index()+1);this.endContainer=a;this.endOffset=c;this.startContainer||(this.startContainer=a,this.startOffset=c);p(this)},setStartAt:function(a,c){switch(c){case e.POSITION_AFTER_START:this.setStart(a,0);break;case e.POSITION_BEFORE_END:a[0].nodeType==d.NodeType.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);break;case e.POSITION_BEFORE_START:this.setStartBefore(a);
break;case e.POSITION_AFTER_END:this.setStartAfter(a)}p(this)},setEndAt:function(a,c){switch(c){case e.POSITION_AFTER_START:this.setEnd(a,0);break;case e.POSITION_BEFORE_END:a[0].nodeType==d.NodeType.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case e.POSITION_BEFORE_START:this.setEndBefore(a);break;case e.POSITION_AFTER_END:this.setEndAfter(a)}p(this)},cloneContents:function(){return m(this,2)},deleteContents:function(){return m(this,0)},extractContents:function(){return m(this,
1)},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset);this.collapsed=j},clone:function(){var a=new u(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},getEnclosedNode:function(){var a=this.clone();a.optimize();if(a.startContainer[0].nodeType!=d.NodeType.ELEMENT_NODE||
a.endContainer[0].nodeType!=d.NodeType.ELEMENT_NODE)return x;var c=new r(a);c.evaluator=function(a){return C(a)&&y(a)};a=c.next();c.reset();c=c.previous();return a&&a.equals(c)?a:x},shrink:function(a,c){if(!this.collapsed){var a=a||e.SHRINK_TEXT,b=this.clone(),g=this.startContainer,h=this.endContainer,i=this.startOffset,f=this.endOffset,o=j,k,m,l=j;g&&g[0].nodeType==d.NodeType.TEXT_NODE&&(i?i>=g[0].nodeValue.length?b.setStartAfter(g):(b.setStartBefore(g),o=w):b.setStartBefore(g));h&&h[0].nodeType==
d.NodeType.TEXT_NODE&&(f?f>=h[0].nodeValue.length?b.setEndAfter(h):(b.setEndAfter(h),l=w):b.setEndBefore(h));if(o||l)m=new r(b),m.evaluator=function(c){return c.nodeType==(a==e.SHRINK_ELEMENT?d.NodeType.ELEMENT_NODE:d.NodeType.TEXT_NODE)},m.guard=function(c,b){if(a==e.SHRINK_ELEMENT&&c.nodeType==d.NodeType.TEXT_NODE||b&&c==k)return w;!b&&c.nodeType==d.NodeType.ELEMENT_NODE&&(k=c);return j};o&&(b=m[a==e.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(b,c?e.POSITION_AFTER_START:e.POSITION_BEFORE_START);
l&&(m.reset(),(m=m[a==e.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(m,c?e.POSITION_BEFORE_END:e.POSITION_AFTER_END));return o||l}},createBookmark2:function(a){var c=this.startContainer,b=this.endContainer,g=this.startOffset,e=this.endOffset,i,f;if(!c||!b)return{start:0,end:0};if(a){if(c[0].nodeType==d.NodeType.ELEMENT_NODE&&(i=new h(c[0].childNodes[g]))&&i[0]&&i[0].nodeType==d.NodeType.TEXT_NODE&&0<g&&i[0].previousSibling.nodeType==d.NodeType.TEXT_NODE)c=i,g=0;for(;c[0].nodeType==
d.NodeType.TEXT_NODE&&(f=c.prev(void 0,1))&&f[0].nodeType==d.NodeType.TEXT_NODE;)c=f,g+=f[0].nodeValue.length;if(!this.collapsed){if(b[0].nodeType==d.NodeType.ELEMENT_NODE&&(i=new h(b[0].childNodes[e]))&&i[0]&&i[0].nodeType==d.NodeType.TEXT_NODE&&0<e&&i[0].previousSibling.nodeType==d.NodeType.TEXT_NODE)b=i,e=0;for(;b[0].nodeType==d.NodeType.TEXT_NODE&&(f=b.prev(void 0,1))&&f[0].nodeType==d.NodeType.TEXT_NODE;)b=f,e+=f[0].nodeValue.length}}return{start:c._4e_address(a),end:this.collapsed?x:b._4e_address(a),
startOffset:g,endOffset:e,normalized:a,is2:j}},createBookmark:function(a){var c,b,d,g,i=this.collapsed;c=new h("<span>",x,this.document);c.attr("_ke_bookmark",1);c.css("display","none");c.html("&nbsp;");a&&(d=f.guid("ke_bm_"),c.attr("id",d+"S"));i||(b=c.clone(),b.html("&nbsp;"),a&&b.attr("id",d+"E"),g=this.clone(),g.collapse(),g.insertNode(b));g=this.clone();g.collapse(j);g.insertNode(c);b?(this.setStartAfter(c),this.setEndBefore(b)):this.moveToPosition(c,e.POSITION_AFTER_END);return{startNode:a?
d+"S":c,endNode:a?d+"E":b,serializable:a,collapsed:i}},moveToPosition:function(a,c){this.setStartAt(a,c);this.collapse(j)},trim:function(a,c){var b=this.startContainer,g=this.startOffset,h=this.collapsed;if((!a||h)&&b[0]&&b[0].nodeType==d.NodeType.TEXT_NODE){if(g)if(g>=b[0].nodeValue.length)g=b._4e_index()+1,b=b.parent();else{var e=b._4e_splitText(g),g=b._4e_index()+1,b=b.parent();d.equals(this.startContainer,this.endContainer)?this.setEnd(e,this.endOffset-this.startOffset):d.equals(b,this.endContainer)&&
(this.endOffset+=1)}else g=b._4e_index(),b=b.parent();this.setStart(b,g);if(h){this.collapse(j);return}}b=this.endContainer;g=this.endOffset;!c&&!h&&b[0]&&b[0].nodeType==d.NodeType.TEXT_NODE&&(g?(g>=b[0].nodeValue.length||b._4e_splitText(g),g=b._4e_index()+1):g=b._4e_index(),b=b.parent(),this.setEnd(b,g))},insertNode:function(a){this.optimizeBookmark();this.trim(w,j);var c=this.startContainer;c[0].insertBefore(a[0],c[0].childNodes[this.startOffset]||null);c[0]==this.endContainer[0]&&this.endOffset++;
this.setStartBefore(a)},moveToBookmark:function(a){var c=g(this.document);if(a.is2){var b=c._4e_getByAddress(a.start,a.normalized),d=a.startOffset,c=a.end&&c._4e_getByAddress(a.end,a.normalized),a=a.endOffset;this.setStart(b,d);c?this.setEnd(c,a):this.collapse(j)}else b=(d=a.serializable)?f.one("#"+a.startNode,c):a.startNode,a=d?f.one("#"+a.endNode,c):a.endNode,this.setStartBefore(b),b._4e_remove(),a&&a[0]?(this.setEndBefore(a),a._4e_remove()):this.collapse(j)},getCommonAncestor:function(a,c){var b=
this.startContainer,g=this.endContainer,b=b[0]==g[0]?a&&b[0].nodeType==d.NodeType.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new h(b[0].childNodes[this.startOffset]):b:b._4e_commonAncestor(g);return c&&b[0].nodeType==d.NodeType.TEXT_NODE?b.parent():b},enlarge:function(){function a(c,b,h,e){var i=c[b?"startContainer":"endContainer"],f,k=b?0:1,t=0,m=b?"previousSibling":"nextSibling";f=c[b?"startOffset":"endOffset"];if(i[0].nodeType==d.NodeType.TEXT_NODE){if(b){if(f)return}else if(f<i[0].nodeValue.length)return;
f=i[0][m];i=i[0].parentNode}else f=i[0].childNodes[f+(b?-1:1)]||null,i=i[0];for(;i;){for(;f;)if(o(f)||A(f))f=f[m];else break;if(f){if(!t)c[b?"setStartAfter":"setEndBefore"](g(f));break}i=g(i);if("body"==i.nodeName())break;if(t||i.equals(e))h[k]=i,t=1;else c[b?"setStartBefore":"setEndAfter"](i);f=i[0][m];i=i[0].parentNode}}return function(c){switch(c){case e.ENLARGE_ELEMENT:if(this.collapsed)break;var c=this.getCommonAncestor(),b=[];a(this,1,b,c);a(this,0,b,c);b[0]&&b[1]&&(c=b[0].contains(b[1])?b[1]:
b[0],this.setStartBefore(c),this.setEndAfter(c));break;case e.ENLARGE_BLOCK_CONTENTS:case e.ENLARGE_LIST_ITEM_CONTENTS:var i=new u(this.document),b=new h(this.document.body);i.setStartAt(b,e.POSITION_AFTER_START);i.setEnd(this.startContainer,this.startOffset);var i=new r(i),f,o,k=r.blockBoundary(c==e.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:x),m=function(a){var c=k(a);c||(f=g(a));return c},j=function(a){var c=m(a);!c&&"br"==d.nodeName(a)&&(o=g(a));return c};i.guard=m;i=i.lastBackward();f=f||b;this.setStartAt(f,
"br"!=f.nodeName()&&(!i&&this.checkStartOfBlock()||i&&f.contains(i))?e.POSITION_AFTER_START:e.POSITION_AFTER_END);i=this.clone();i.collapse();i.setEndAt(b,e.POSITION_BEFORE_END);i=new r(i);i.guard=c==e.ENLARGE_LIST_ITEM_CONTENTS?j:m;f=x;i=i.lastForward();f=f||b;this.setEndAt(f,!i&&this.checkEndOfBlock()||i&&f.contains(i)?e.POSITION_BEFORE_END:e.POSITION_BEFORE_START);o&&this.setEndAfter(o)}}}(),checkStartOfBlock:function(){var a=this.startContainer,c=this.startOffset;if(c&&a[0].nodeType==d.NodeType.TEXT_NODE&&
f.trim(a[0].nodeValue.substring(0,c)).length)return w;this.trim();a=new n(this.startContainer);c=this.clone();c.collapse(j);c.setStartAt(a.block||a.blockLimit,e.POSITION_AFTER_START);a=new r(c);a.evaluator=k(j);return a.checkBackward()},checkEndOfBlock:function(){var a=this.endContainer,c=this.endOffset;if(a[0].nodeType==d.NodeType.TEXT_NODE&&f.trim(a[0].nodeValue.substring(c)).length)return w;this.trim();a=new n(this.endContainer);c=this.clone();c.collapse(w);c.setEndAt(a.block||a.blockLimit,e.POSITION_BEFORE_END);
a=new r(c);a.evaluator=k(w);return a.checkForward()},checkBoundaryOfElement:function(a,c){var b=this.clone();b[c==e.START?"setStartAt":"setEndAt"](a,c==e.START?e.POSITION_AFTER_START:e.POSITION_BEFORE_END);b=new r(b);b.evaluator=v;return b[c==e.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var a=this.startContainer,c=this.endContainer,h=this.startOffset,i=this.endOffset,e;if(a[0].nodeType==d.NodeType.ELEMENT_NODE)if(e=a[0].childNodes.length,e>h)a=g(a[0].childNodes[h]);else if(0==
e)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=g(a);a=a._4e_nextSourceNode()||a}if(c[0].nodeType==d.NodeType.ELEMENT_NODE)if(e=c[0].childNodes.length,e>i)c=g(c[0].childNodes[i])._4e_previousSourceNode(j);else if(0==e)c=c._4e_previousSourceNode();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=g(c)}a._4e_position(c)&b.POSITION_FOLLOWING&&(a=c);return{startNode:a,endNode:c}},fixBlock:function(a,c){var b=this.createBookmark(),d=g(this.document.createElement(c));this.collapse(a);
this.enlarge(e.ENLARGE_BLOCK_CONTENTS);d[0].appendChild(this.extractContents());d._4e_trim();s.ie||d._4e_appendBogus();this.insertNode(d);this.moveToBookmark(b);return d},splitBlock:function(a){var c=new n(this.startContainer),b=new n(this.endContainer),d=c.block,g=b.block,h=x;if(!c.blockLimit.equals(b.blockLimit))return x;"br"!=a&&(d||(d=this.fixBlock(j,a),g=(new n(this.endContainer)).block),g||(g=this.fixBlock(w,a)));a=d&&this.checkStartOfBlock();c=g&&this.checkEndOfBlock();this.deleteContents();
d&&d[0]==g[0]&&(c?(h=new n(this.startContainer),this.moveToPosition(g,e.POSITION_AFTER_END),g=x):a?(h=new n(this.startContainer),this.moveToPosition(d,e.POSITION_BEFORE_START),d=x):(g=this.splitElement(d),!s.ie&&!f.inArray(d.nodeName(),["ul","ol"])&&d._4e_appendBogus()));return{previousBlock:d,nextBlock:g,wasStartOfBlock:a,wasEndOfBlock:c,elementPath:h}},splitElement:function(a){if(!this.collapsed)return x;this.setEndAt(a,e.POSITION_BEFORE_END);var c=this.extractContents(),b=a.clone(w);b[0].appendChild(c);
b.insertAfter(a);this.moveToPosition(a,e.POSITION_AFTER_END);return b},moveToElementEditablePosition:function(c,b){for(var g=0;c;){if(c[0].nodeType==d.NodeType.TEXT_NODE){this.moveToPosition(c,b?e.POSITION_AFTER_END:e.POSITION_BEFORE_START);g=1;break}c[0].nodeType==d.NodeType.ELEMENT_NODE&&c._4e_isEditable()&&(this.moveToPosition(c,b?e.POSITION_BEFORE_END:e.POSITION_AFTER_START),g=1);var h=c,i=g,f=void 0;h[0].nodeType==d.NodeType.ELEMENT_NODE&&h._4e_isEditable()&&(f=h[b?"last":"first"](a,1));!i&&
!f&&(f=h[b?"prev":"next"](a,1));c=f}return!!g},selectNodeContents:function(a){var c=a[0];this.setStart(a,0);this.setEnd(a,c.nodeType==d.NodeType.TEXT_NODE?c.nodeValue.length:c.childNodes.length)},insertNodeByDtd:function(a){var b,d,g,h=a.nodeName();b=c.$block[h];this.deleteContents();if(b){for(b=this.getCommonAncestor(w,j);(d=c[b.nodeName()])&&(!d||!d[h]);){var i=b.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(b),this.collapse(j),b.remove()):g=b;b=i}g&&this.splitElement(g)}this.insertNode(a)}});
q.injectDom({_4e_breakParent:function(a,c){var c=g(c),a=g(a),b,d=new l.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(c);b=d.extractContents();d.insertNode(a.remove());a.after(b)}});return l.Range=u},{requires:"./base,./utils,./walker,./elementPath,./dom,node".split(",")});
KISSY.add("editor/core/selection",function(f,l){function q(a){this.document=a;this._={cache:{}};if(j)try{var b=this.getNative().createRange();if(!b||b.item&&b.item(0).ownerDocument!=a||b.parentElement&&b.parentElement().ownerDocument!=a)this.isInvalid=n}catch(d){this.isInvalid=n}}function r(a){a=new q(a);return!a||a.isInvalid?v:a}l.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var n=!0,v=null,a=f.UA,k=f.DOM,m=f.Node,p=l.SELECTION,u=l.RANGE,j=a.ie,w=l.Walker,x=l.Range,e={img:1,
hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};f.augment(q,{getNative:!j?function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=k.getWindow(this.document).getSelection())}:function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=this.document.selection)},getType:!j?function(){var a=this._.cache;if(a.type)return a.type;var b=p.SELECTION_TEXT,d=this.getNative();if(d){if(1==d.rangeCount){var d=d.getRangeAt(0),
i=d.startContainer;i==d.endContainer&&i.nodeType==k.NodeType.ELEMENT_NODE&&1==Number(d.endOffset-d.startOffset)&&e[i.childNodes[d.startOffset].nodeName.toLowerCase()]&&(b=p.SELECTION_ELEMENT)}}else b=p.SELECTION_NONE;return a.type=b}:function(){var a=this._.cache;if(a.type)return a.type;var b=p.SELECTION_NONE;try{var d=this.getNative(),i=d.type;"Text"==i&&(b=p.SELECTION_TEXT);"Control"==i&&(b=p.SELECTION_ELEMENT);d.createRange().parentElement&&(b=p.SELECTION_TEXT)}catch(e){}return a.type=b},getRanges:j?
function(){var a=function(a,c){a=a.duplicate();a.collapse(c);for(var b=a.parentElement(),d=b.childNodes,e,f=0;f<d.length;f++){var m=d[f];if(m.nodeType==k.NodeType.ELEMENT_NODE){e=a.duplicate();e.moveToElementText(m);var m=e.compareEndPoints("StartToStart",a),j=e.compareEndPoints("EndToStart",a);e.collapse();if(0<m)break;else{if(!m||1==j&&-1==m)return{container:b,offset:f};if(!j)return{container:b,offset:f+1}}e=v}}e||(e=a.duplicate(),e.moveToElementText(b),e.collapse(!1));e.setEndPoint("StartToStart",
a);e=(""+e.text).replace(/\r\n|\r/g,"\n").length;try{for(;0<e;)e-=d[--f].nodeValue.length}catch(l){e=0}return 0===e?{container:b,offset:f}:{container:d[f],offset:-e}};return function(b){var d=this._.cache;if(d.ranges&&!b)return d.ranges;var e=this.getNative(),b=e&&e.createRange(),f=this.getType();if(!e)return[];if(f==p.SELECTION_TEXT)return e=new x(this.document),f=a(b,n),e.setStart(new m(f.container),f.offset),f=a(b),e.setEnd(new m(f.container),f.offset),d.ranges=[e];if(f==p.SELECTION_ELEMENT){d=
d.ranges=[];for(f=0;f<b.length;f++){for(var k=b.item(f),j=k.parentNode,l=0,e=new x(this.document);l<j.childNodes.length&&j.childNodes[l]!=k;l++);e.setStart(new m(j),l);e.setEnd(new m(j),l+1);d.push(e)}return d}return d.ranges=[]}}():function(a){var b=this._.cache;if(b.ranges&&!a)return b.ranges;var a=[],d=this.getNative();if(!d)return[];for(var e=0;e<d.rangeCount;e++){var f=d.getRangeAt(e),k=new x(this.document);k.setStart(new m(f.startContainer),f.startOffset);k.setEnd(new m(f.endContainer),f.endOffset);
a.push(k)}return b.ranges=a},getStartElement:function(){var a=this._.cache;if(void 0!==a.startElement)return a.startElement;var b,d=this.getNative();switch(this.getType()){case p.SELECTION_ELEMENT:return this.getSelectedElement();case p.SELECTION_TEXT:var e=this.getRanges()[0];if(e&&!e.collapsed){for(e.optimize();n;)if(b=e.startContainer,e.startOffset==(b[0].nodeType===k.NodeType.ELEMENT_NODE?b[0].childNodes.length:b[0].nodeValue.length)&&!b._4e_isBlockBoundary())e.setStartAfter(b);else break;b=e.startContainer;
if(b[0].nodeType!=k.NodeType.ELEMENT_NODE)return b.parent();b=new m(b[0].childNodes[e.startOffset]);if(!b[0]||b[0].nodeType!=k.NodeType.ELEMENT_NODE)return e.startContainer;for(e=b[0].firstChild;e&&e.nodeType==k.NodeType.ELEMENT_NODE;)b=new m(e),e=e.firstChild;return b}if(j)e=d.createRange(),e.collapse(n),b=new m(e.parentElement());else{if((b=d.anchorNode)&&b.nodeType!=k.NodeType.ELEMENT_NODE)b=b.parentNode;b&&(b=new m(b))}}return a.startElement=b},getSelectedElement:function(){var a,b=this._.cache;
if(void 0!==b.selectedElement)return b.selectedElement;j&&(a=this.getNative().createRange(),a=a.item&&a.item(0));var d;if(a)d=new m(a);else{a=this.getRanges()[0];for(var f,o=2;o&&(!(d=a.getEnclosedNode())||!(d[0].nodeType==k.NodeType.ELEMENT_NODE&&e[d.nodeName()]&&(f=d)));o--)a.shrink(u.SHRINK_ELEMENT);d=f}return b.selectedElement=d},reset:function(){this._.cache={}},selectElement:function(a){var b,d=this.document;if(j)try{b=d.body.createControlRange(),b.addElement(a[0]),b.select()}catch(e){b=d.body.createTextRange(),
b.moveToElementText(a[0]),b.select()}finally{}else b=d.createRange(),b.selectNode(a[0]),a=this.getNative(),a.removeAllRanges(),a.addRange(b);this.reset()},selectRanges:function(b){if(j){if(1<b.length){var d=b[b.length-1];b[0].setEnd(d.endContainer,d.endOffset);b.length=1}b[0]&&b[0].select()}else{d=this.getNative();if(!d)return;d.removeAllRanges();for(var e=0;e<b.length;e++){var f=b[e],o=this.document.createRange(),m=f.startContainer;if(f.collapsed&&(a.gecko&&1.09>a.gecko||a.opera||a.webkit)&&m[0].nodeType==
k.NodeType.ELEMENT_NODE&&!m[0].childNodes.length)m[0].appendChild(this.document.createTextNode(a.webkit?"\u200b":"")),f.startOffset++,f.endOffset++;o.setStart(m[0],f.startOffset);o.setEnd(f.endContainer[0],f.endOffset);d.addRange(o)}}this.reset()},createBookmarks2:function(a){for(var b=[],d=this.getRanges(),e=0;e<d.length;e++)b.push(d[e].createBookmark2(a));return b},createBookmarks:function(a,b){for(var d=[],e=this.document,o,b=b||this.getRanges(),m=b.length,j=0;j<m;j++){d.push(o=b[j].createBookmark(a,
n));var l=(a=o.serializable)?f.one("#"+o.startNode,e):o.startNode;o=a?f.one("#"+o.endNode,e):o.endNode;for(var p=j+1;p<m;p++){var s=b[p],q=s.startContainer,r=s.endContainer;k.equals(q,l.parent())&&s.startOffset++;k.equals(q,o.parent())&&s.startOffset++;k.equals(r,l.parent())&&s.endOffset++;k.equals(r,o.parent())&&s.endOffset++}}return d},selectBookmarks:function(a){for(var b=[],d=0;d<a.length;d++){var e=new x(this.document);e.moveToBookmark(a[d]);b.push(e)}this.selectRanges(b);return this},getCommonAncestor:function(){var a=
this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){var a=this.getStartElement();a&&a.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})},removeAllRanges:function(){var a=this.getNative();j?a&&a.clear():a&&a.removeAllRanges()}});var b={table:1,tbody:1,tr:1},d=w.whitespaces(n),s=/\ufeff|\u00a0/;x.prototype.select=x.prototype.select=!j?function(){var b=this.startContainer;this.collapsed&&b[0].nodeType==
k.NodeType.ELEMENT_NODE&&!b[0].childNodes.length&&(b[0].appendChild(this.document.createTextNode(a.webkit?"\u200b":"")),this.startOffset++,this.endOffset++);var d=this.document.createRange();d.setStart(b[0],this.startOffset);try{d.setEnd(this.endContainer[0],this.endOffset)}catch(e){if(0<=e.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(n),d.setEnd(this.endContainer[0],this.endOffset);else throw e;}b=r(this.document).getNative();b.removeAllRanges();b.addRange(d)}:function(a){var e=this.collapsed,
f,i;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var o=this.startContainer[0].childNodes[this.startOffset];if(o.nodeType==k.NodeType.ELEMENT_NODE){(new q(this.document)).selectElement(new m(o));return}}(this.startContainer[0].nodeType==k.NodeType.ELEMENT_NODE&&this.startContainer.nodeName()in b||this.endContainer[0].nodeType==k.NodeType.ELEMENT_NODE&&this.endContainer.nodeName()in b)&&this.shrink(u.SHRINK_ELEMENT,n);var j=this.createBookmark(),o=j.startNode,
l;e||(l=j.endNode);j=this.document.body.createTextRange();j.moveToElementText(o[0]);j.moveStart("character",1);if(l)a=this.document.body.createTextRange(),a.moveToElementText(l[0]),j.setEndPoint("EndToEnd",a),j.moveEnd("character",-1);else{for(f=o[0].nextSibling;f&&!d(f);)f=f.nextSibling;f=!(f&&f.nodeValue&&f.nodeValue.match(s))&&(a||!o[0].previousSibling||o[0].previousSibling&&"br"==k.nodeName(o[0].previousSibling));i=new m(this.document.createElement("span"));i.html("&#65279;");i.insertBefore(o);
f&&k.insertBefore(this.document.createTextNode("\ufeff"),o[0]||o)}this.setStartBefore(o);o._4e_remove();if(e){if(f?(j.moveStart("character",-1),j.select(),this.document.selection.clear()):j.select(),i)this.moveToPosition(i,u.POSITION_BEFORE_START),i._4e_remove()}else this.setEndBefore(l),l._4e_remove(),j.select()};q.getSelection=r;return l.Selection=q},{requires:["./base","./walker","./range","./dom","node"]});
KISSY.add("editor/core/selectionFix",function(f,l){function q(a){function b(a,b){var c=g.body.createTextRange();try{c.moveToPoint(a,b)}catch(d){c=m}return c}function d(){var a=g.selection.createRange();i&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&i.select();u.remove(g,"mouseup",d);u.remove(g,"mousemove",f);i=c=0}function f(a){if(a.button){if(a=b(a.pageX,a.pageY))0<a.compareEndPoints("StartToStart",i)?a.setEndPoint("StartToStart",i):a.setEndPoint("EndToEnd",i),a.select()}else d()}var c,h=a.get("window")[0],
g=a.get("document")[0],i;u.on(g,"mousedown contextmenu",function(a){var e=g.documentElement;if(a.target===e&&(c&&d(),!(e.scrollHeight>e.clientHeight)&&(c=1,i=b(a.pageX,a.pageY))))u.on(g,"mouseup",d),u.on(g,"mousemove",f),h.focus(),i.select()})}function r(e){function b(c){if(g){var f=e.getSelection(),i=f&&f.getType(),k=f&&d.selection;if(c&&k&&i==x.SELECTION_NONE&&!d.queryCommandEnabled("InsertImage"))setTimeout(function(){b(a)},50);else{var j;if(!k||!k.type||!("Control"!=k.type&&(j=k.createRange())&&
(j=j.parentElement())&&(j=j.nodeName)&&j.toLowerCase()in{input:1,textarea:1}))h=k&&f.getRanges()[0],e.checkSelectionChange()}}}var d=e.get("document")[0],f=new w(d.body),c=new w(d.documentElement);if(8>l.Utils.ieEngine)c.on("click",function(a){"html"===(new w(a.target)).nodeName()&&e.getSelection().getNative().createRange().select()});var h,g,i=a;c.on("mousedown",function(){i=k});c.on("mouseup",function(){i=a});f.on("focusin",function(a){if("body"==(new w(a.target)).nodeName()&&h){try{i&&h.select()}catch(b){}h=
m}});f.on("focus",function(){g=a;b()});f.on("beforedeactivate",function(b){b.relatedTarget||(g=k,i=a)});f.on("mousedown",function(){g=k});f.on("mouseup",function(){g=a;setTimeout(function(){b(a)},0)});f.on("keydown",function(){g=k});f.on("keyup",function(){g=a;setTimeout(function(){b()},0)})}function n(a){var b=a.get("document")[0];u.on(b,"mouseup keyup selectionchange",function(){a.checkSelectionChange()})}function v(e){function b(a){var b=l.XHTML_DTD;return a._4e_isBlockBoundary()&&b.$empty[a.nodeName()]}
function d(a){return c(a)&&h(a)}var f=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,c=l.Walker.whitespaces(a),h=l.Walker.bookmark(k,a),g=function(a){return c(a)&&8!=a.nodeType};e.on("selectionChange",function(c){var h=c.path,m=new w(e.get("document")[0].body),c=(c=c.selection)&&c.getRanges()[0],n=h.blockLimit;if(p.gecko){var q=h.block||h.blockLimit,r=q&&q.last(d);q&&q._4e_isBlockBoundary()&&(!r||!(1==r[0].nodeType&&
r._4e_isBlockBoundary()))&&"pre"!=q.nodeName()&&!q._4e_getBogus()&&q._4e_appendBogus()}if(c&&c.collapsed&&!h.block){if("body"==n.nodeName()){if((h=c.fixBlock(a,"p"))&&h[0]!=m[0].lastChild&&h.outerHtml().match(f))if((n=h.next(g,1))&&n[0].nodeType==j.NodeType.ELEMENT_NODE&&!b[n])c.moveToElementEditablePosition(n),h._4e_remove();else if((n=h.prev(g,1))&&n[0].nodeType==j.NodeType.ELEMENT_NODE&&!b[n])c.moveToElementEditablePosition(n,n.outerHtml().match(f)?k:a),h._4e_remove();c.select();e.notifySelectionChange()}h=
e.get("document")[0];c=new l.Range(h);c.moveToElementEditablePosition(m,a);"body"!==(new l.ElementPath(c.startContainer)).blockLimit.nodeName()&&(m=(new w(h.createElement("p"))).appendTo(m),p.ie||m._4e_appendBogus())}})}var a=!0,k=!1,m=null,p=f.UA,u=f.Event,j=f.DOM,w=f.Node,x=l.SELECTION;return{init:function(a){a.docReady(function(){p.ie?(q(a),r(a)):n(a)});v(a)}}},{requires:["./base","./selection","node"]});
KISSY.add("editor/core/styles",function(f,l){function q(a){return!y.attr(a,"_ke_bookmark")}function r(a,b){for(var c in a)"string"==typeof a[c]?a[c]=a[c].replace(S,function(a,c){return b[c]}):r(a[c],b)}function n(a,b){b&&(a=f.clone(a),r(a,b));var c=this.element=this.element=(a.element||"*").toLowerCase();this.type=this.type="#text"==c||R[c]?D.STYLE_BLOCK:P[c]?D.STYLE_OBJECT:D.STYLE_INLINE;this._={definition:a}}function v(a,b){var c=b?this.removeFromRange:this.applyToRange;a.body.focus();for(var d=
new F(a),e=d.getRanges(),f=0;f<e.length;f++)c.call(this,e[f]);d.selectRanges(e)}function a(a,b,c){var d=a.element;"*"==d&&(d="span");b=new G(b.createElement(d));c&&c._4e_copyAttributes(b);c=a._.definition;a=c.attributes;c=n.getStyleText(c);if(a)for(var e in a)b.attr(e,a[e]);c&&(b[0].style.cssText=c);return b}function k(b){var c=b.createBookmark(i),d=b.createIterator();d.enforceRealBlocks=i;d.enlargeBr=i;for(var e,f=b.document;e=d.getNextParagraph();){var g=a(this,f,e),h=g,g="pre"==h.nodeName,k="pre"==
e.nodeName,j=!g&&k;g&&!k?(k=e,j=k.html(),j=m(j,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),j=j.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),j=j.replace(/([ \t\n\r]+|&nbsp;)/g," "),j=j.replace(/<br\b[^>]*>/gi,"\n"),M.ie?(k=k[0].ownerDocument.createElement("div"),k.appendChild(h[0]),h.outerHtml("<pre>"+j+"</pre>"),h=new G(k.firstChild),h._4e_remove()):h.html(j)):j?h=u(p(e),h):e._4e_moveChildren(h);e[0].parentNode.replaceChild(h[0],e[0]);if(g&&(e=h,g=void 0,(g=e._4e_previousSourceNode(i,y.NodeType.ELEMENT_NODE))&&
"pre"==g.nodeName()))h=m(g.html(),/\n$/,"")+"\n\n"+m(e.html(),/^\n/,""),M.ie?e.outerHtml("<pre>"+h+"</pre>"):e.html(h),g._4e_remove()}b.moveToBookmark(c)}function m(a,b,c){var d="",e="",a=a.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(a,b,c){b&&(d=b);c&&(e=c);return""});return d+a.replace(b,c)+e}function p(a){var b=[];m(a.outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(a,b,c){return b+"</pre>"+c+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(a,c){b.push(c)});return b}function u(a,b){for(var c=b[0].ownerDocument.createDocumentFragment(),d=0;d<a.length;d++){var e=a[d],e=e.replace(/(\r\n|\r)/g,"\n"),e=m(e,/^[ \t]*\n/,""),e=m(e,/\n$/,""),e=m(e,/^[ \t]+|[ \t]+$/g,function(a,b){return 1==a.length?"&nbsp;":b?" "+Array(a.length).join("&nbsp;"):Array(a.length).join("&nbsp;")+" "}),e=e.replace(/\n/g,"<br>"),e=e.replace(/[ \t]{2,}/g,function(a){return Array(a.length).join("&nbsp;")+" "}),f=b.clone();f.html(e);c.appendChild(f[0])}return c}
function j(b){var d=b.document;if(b.collapsed)d=a(this,d,void 0),b.insertNode(d),b.moveToPosition(d,t.POSITION_BEFORE_END);else{var e=this.element,f=this._.definition,g,h=L[e];h||(g=i,h=L.span);var k=b.createBookmark();b.enlarge(t.ENLARGE_ELEMENT);b.trim();for(var j=b.createBookmark(),m=j.startNode,j=j.endNode,l=m,n;l&&l[0];){var p=o;if(y.equals(l,j))l=A,p=i;else{var s=l[0].nodeType,r=s==y.NodeType.ELEMENT_NODE?l.nodeName():A;if(r&&l.attr("_ke_bookmark")){l=l._4e_nextSourceNode(i);continue}if(!r||
h[r]&&(l._4e_position(j)|z.POSITION_PRECEDING|z.POSITION_IDENTICAL|z.POSITION_IS_CONTAINED)==z.POSITION_PRECEDING+z.POSITION_IDENTICAL+z.POSITION_IS_CONTAINED&&(!f.childRule||f.childRule(l))){var u=l.parent();if(u&&"a"==e&&u.nodeName()==e)s=a(this,d,void 0),u._4e_moveChildren(s),u[0].parentNode.replaceChild(s[0],u[0]),s._4e_mergeSiblings();else if(u&&u[0]&&((L[u.nodeName()]||L.span)[e]||g)&&(!f.parentRule||f.parentRule(u))){if(!n&&(!r||!L.$removeEmpty[r]||(l._4e_position(j)|z.POSITION_PRECEDING|z.POSITION_IDENTICAL|
z.POSITION_IS_CONTAINED)==z.POSITION_PRECEDING+z.POSITION_IDENTICAL+z.POSITION_IS_CONTAINED))n=new I(d),n.setStartBefore(l);if(s==y.NodeType.TEXT_NODE||s==y.NodeType.ELEMENT_NODE&&!l[0].childNodes.length){u=l;for(s=null;(p=!u.next(q,1))&&(s=u.parent())&&h[s.nodeName()]&&(s._4e_position(m)|z.POSITION_FOLLOWING|z.POSITION_IDENTICAL|z.POSITION_IS_CONTAINED)==z.POSITION_FOLLOWING+z.POSITION_IDENTICAL+z.POSITION_IS_CONTAINED&&(!f.childRule||f.childRule(s));)u=s;n.setEndAfter(u)}}else p=i}else p=i;l=l._4e_nextSourceNode()}if(p&&
n&&!n.collapsed){for(var p=a(this,d,void 0),u=n.getCommonAncestor(),s={},r={},v,w=null,x;p&&u&&p[0]&&u[0];){if(u.nodeName()==e){for(v in f.attributes)if(!r[v]&&(x=u.attr(w)))p.attr(v)==x?p.removeAttr(v):r[v]=1;for(w in f.styles)if(!s[w]&&(x=u.style(w)))p.style(w)==x?p.style(w,""):s[w]=1;if(!p._4e_hasAttributes()){p=A;break}}u=u.parent()}p?(p[0].appendChild(n.extractContents()),c(this,p),n.insertNode(p),p._4e_mergeSiblings(),M.ie||p[0].normalize()):(p=new G(d.createElement("span")),p[0].appendChild(n.extractContents()),
n.insertNode(p),c(this,p),p._4e_remove(!0));n=A}}m._4e_remove();j._4e_remove();b.moveToBookmark(k);b.shrink(t.SHRINK_TEXT)}}function w(a){a.enlarge(t.ENLARGE_ELEMENT);var c=a.createBookmark(),e=c.startNode;if(a.collapsed){for(var f=new O(e.parent()),g,k=0,i;k<f.elements.length&&(i=f.elements[k])&&!(i==f.block||i==f.blockLimit);k++)if(this.checkElementRemovable(i)){var j=a.checkBoundaryOfElement(i,t.END),m=!j&&a.checkBoundaryOfElement(i,t.START);m||j?(g=i,g.match=m?"start":"end"):(i._4e_mergeSiblings(),
i.nodeName()!=this.element?(j=b(this),h(i,j[i.nodeName()]||j["*"])):d(this,i))}if(g){i=e;for(k=0;;k++){j=f.elements[k];if(j.equals(g))break;else if(j.match)continue;else j=j.clone();j[0].appendChild(i[0]);i=j}i["start"==g.match?"insertBefore":"insertAfter"](g);f=g.html();!f||"\u200b"==f?g.remove():M.webkit&&C(a.document.createTextNode("\u200b")).insertBefore(i)}}else{var l=c.endNode,p=this;g=function(){for(var a=new O(e.parent()),b=new O(l.parent()),c=A,d=A,f=0;f<a.elements.length;f++){var g=a.elements[f];
if(g==a.block||g==a.blockLimit)break;p.checkElementRemovable(g)&&(c=g)}for(f=0;f<b.elements.length;f++){g=b.elements[f];if(g==b.block||g==b.blockLimit)break;p.checkElementRemovable(g)&&(d=g)}d&&l._4e_breakParent(d);c&&e._4e_breakParent(c)};g();for(f=new G(e[0].nextSibling);f[0]!==l[0];){k=f._4e_nextSourceNode();if(f[0]&&f[0].nodeType==y.NodeType.ELEMENT_NODE&&this.checkElementRemovable(f)&&(f.nodeName()==this.element?d(this,f):(i=b(this),h(f,i[f.nodeName()]||i["*"])),k[0].nodeType==y.NodeType.ELEMENT_NODE&&
k.contains(e)))g(),k=new G(e[0].nextSibling);f=k}}a.moveToBookmark(c)}function x(a){var b={};(""+a).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,c,d){b[c]=d});return b}function e(a,b){var c="";b!==o?(c=document.createElement("span"),c.style.cssText=a,c=c.style.cssText||""):c=a;return c.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function b(a){if(a._.overrides)return a._.overrides;var b=a._.overrides={},c=a._.definition.overrides;
if(c){f.isArray(c)||(c=[c]);for(var d=0;d<c.length;d++){var e=c[d],g,h,i;"string"==typeof e?g=e.toLowerCase():(g=e.element?e.element.toLowerCase():a.element,h=e.attributes,i=e.styles);e=b[g]||(b[g]={});if(h){g=e.attributes=e.attributes||[];for(var k in h)g.push([k.toLowerCase(),h[k]])}if(i){var e=e.styles=e.styles||[],j;for(j in i)e.push([j.toLowerCase(),i[j]])}}}return b}function d(a,c){var d=a._.definition,e=b(a),h=f.merge(d.attributes,(e[c.nodeName()]||e["*"]||{}).attributes),d=f.merge(d.styles,
(e[c.nodeName()]||e["*"]||{}).styles),e=f.isEmptyObject(h)&&f.isEmptyObject(d),k;for(k in h)("class"==k||a._.definition.fullMatch)&&c.attr(k)!=s(k,h[k])||(e=e||!!c.hasAttr(k),c.removeAttr(k));for(var j in d)a._.definition.fullMatch&&c.style(j)!=s(j,d[j],i)||(e=e||!!c.style(j),c.style(j,""));g(c)}function s(a,b,c){var d=new G("<span>");d[c?"style":"attr"](a,b);return d[c?"style":"attr"](a)}function c(a,c){for(var e=b(a),f=c.all(a.element),g=f.length;0<=--g;)d(a,new G(f[g]));for(var i in e)if(i!=a.element){f=
c.all(i);for(g=f.length-1;0<=g;g--){var k=new G(f[g]);h(k,e[i])}}}function h(a,b){var c,d=b&&b.attributes;if(d)for(c=0;c<d.length;c++){var e=d[c][0],f;if(f=a.attr(e)){var h=d[c][1];(h===A||h.test&&h.test(f)||"string"==typeof h&&f==h)&&a[0].removeAttribute(e)}}if(d=b&&b.styles)for(c=0;c<d.length;c++)if(e=d[c][0],h=a.css(e)){var i=d[c][1];(i===A||i.test&&i.test(f)||"string"==typeof i&&h==i)&&a.css(e,"")}g(a)}function g(a){if(!a._4e_hasAttributes()){var b=a[0].firstChild,c=a[0].lastChild;a._4e_remove(i);
b&&(b.nodeType==y.NodeType.ELEMENT_NODE&&y._4e_mergeSiblings(b),c&&b!=c&&c.nodeType==y.NodeType.ELEMENT_NODE&&y._4e_mergeSiblings(c))}}var i=!0,o=!1,A=null,C=f.all,y=f.DOM,D={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},t=l.RANGE,F=l.Selection,z=l.POSITION,I=l.Range,G=f.Node,M=f.UA,O=l.ElementPath,R={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},L=l.XHTML_DTD,P={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},Q=/\s*(?:;\s*|$)/g,S=/#\((.+?)\)/g;l.STYLE=
D;n.prototype={constructor:n,apply:function(a){v.call(this,a,o)},remove:function(a){v.call(this,a,i)},applyToRange:function(a){return(this.applyToRange=this.type==D.STYLE_INLINE?j:this.type==D.STYLE_BLOCK?k:A).call(this,a)},removeFromRange:function(a){return(this.removeFromRange=this.type==D.STYLE_INLINE?w:A).call(this,a)},checkElementRemovable:function(a,c){if(!a)return o;var d=this._.definition,f;if(a.nodeName()==this.element){if(!c&&!a._4e_hasAttributes())return i;var g=d._AC;if(g)d=g;else{var g=
{},h=0,k=d.attributes;if(k)for(var j in k)h++,g[j]=k[j];if(k=n.getStyleText(d))g.style||h++,g.style=k;g._length=h;d=d._AC=g}if(d._length){for(var m in d)if("_length"!=m){h=a.attr(m)||"";if("style"==m)a:{g=d[m];h=e(h,o);"string"==typeof g&&(g=x(g));"string"==typeof h&&(h=x(h));k=void 0;for(k in g)if(!(k in h&&(h[k]==g[k]||"inherit"==g[k]||"inherit"==h[k]))){g=o;break a}g=i}else g=d[m]==h;if(g){if(!c)return i}else if(c)return o}if(c)return i}else return i}m=b(this);if(m=m[a.nodeName()]||m["*"]){if(!(d=
m.attributes)&&!(f=m.styles))return i;if(d)for(g=0;g<d.length;g++)if(m=d[g][0],m=a.attr(m))if(h=d[g][1],h===A||"string"==typeof h&&m==h||h.test&&h.test(m))return i;if(f)for(g=0;g<f.length;g++)if(m=a.css(f[g][0]))if(d=f[g][1],d===A||"string"==typeof d&&m==d||d.test&&d.test(m))return i}return o},checkActive:function(a){switch(this.type){case D.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,i);case D.STYLE_OBJECT:case D.STYLE_INLINE:for(var b=a.elements,c=0,d;c<b.length;c++)if(d=
b[c],!(this.type==D.STYLE_INLINE&&(y.equals(d,a.block)||y.equals(d,a.blockLimit))))if((this.type!=D.STYLE_OBJECT||d.nodeName()in P)&&this.checkElementRemovable(d,i))return i}return o}};n.getStyleText=function(a){var b=a._ST;if(b)return b;var b=a.styles,c=a.attributes&&a.attributes.style||"",d="";c.length&&(c=c.replace(Q,";"));for(var f in b){var g=b[f],h=(f+":"+g).replace(Q,";");"inherit"==g?d+=h:c+=h}c.length&&(c=e(c));return a._ST=c+d};return l.Style=n},{requires:"./base,./range,./selection,./domIterator,./elementPath,node".split(",")});
KISSY.add("editor/core/utils",function(f,l){var q=f.Node,r=f.DOM,n=f.UA,v={debugUrl:function(a){var k=f.Config;k.debug||(a=a.replace(/\.(js|css)/i,"-min.$1"));-1==a.indexOf("?t")&&(a=-1!=a.indexOf("?")?a+"&":a+"?",a+="t="+encodeURIComponent(k.tag));return k.base+"editor/"+a},lazyRun:function(a,f,m){var l=a[f],n=a[m];a[f]=function(){l.apply(this,arguments);a[f]=a[m];return n.apply(this,arguments)}},getXY:function(a,f){var m=a.left,l=a.top,n=f.get("window")[0],m=m-r.scrollLeft(n),l=l-r.scrollTop(n),
n=f.get("iframe").offset(),m=m+n.left,l=l+n.top;return{left:m,top:l}},tryThese:function(a){for(var f,m=0,l=arguments.length;m<l;m++){var n=arguments[m];try{f=n();break}catch(j){}}return f},arrayCompare:function(a,f){if(!a&&!f)return!0;if(!a||!f||a.length!=f.length)return!1;for(var m=0;m<a.length;m++)if(a[m]!==f[m])return!1;return!0},clearAllMarkers:function(a){for(var f in a)a[f]._4e_clearMarkers(a,!0,void 0)},ltrim:function(a){return a.replace(/^\s+/,"")},rtrim:function(a){return a.replace(/\s+$/,
"")},isNumber:function(a){return/^\d+(.\d+)?$/.test(f.trim(a))},verifyInputs:function(a){for(var k=0;k<a.length;k++){var m=new q(a[k]),l=f.trim(v.valInput(m)),n=m.attr("data-verify"),m=m.attr("data-warning");if(n&&!RegExp(n).test(l))return alert(m),!1}return!0},sourceDisable:function(a,f){a.on("sourceMode",f.disable,f);a.on("wysiwygMode",f.enable,f)},resetInput:function(a){var f=a.attr("placeholder");f&&n.ie?(a.addClass("ks-editor-input-tip"),a.val(f)):n.ie||a.val("")},valInput:function(a,f){if(void 0===
f)return a.hasClass("ks-editor-input-tip")?"":a.val();a.removeClass("ks-editor-input-tip");a.val(f)},placeholder:function(a,k){a.attr("placeholder",k);n.ie&&(a.on("blur",function(){f.trim(a.val())||(a.addClass("ks-editor-input-tip"),a.val(k))}),a.on("focus",function(){a.removeClass("ks-editor-input-tip");f.trim(a.val())==k&&a.val("")}))},htmlEncode:function(a){return!a?a:(""+a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},normParams:function(a){var a=f.clone(a),
k;for(k in a){var m=a[k];"function"===typeof m&&(a[k]=m())}return a},map:function(a,f){for(var m=0;m<a.length;m++)a[m]=f(a[m]);return a},ieEngine:document.documentMode||n.ie,preventFocus:function(a){n.ie?a.unselectable():a.attr("onmousedown","return false;")},injectDom:function(a){f.mix(r,a);for(var k in a)(function(k){q.prototype[k]=function(){var l=[].slice.call(arguments,0);l.unshift(this[0]);return(l=a[k].apply(null,l))&&(l.nodeType||f.isWindow(l))?new q(l):f.isArray(l)&&(l.__IS_NODELIST||l[0]&&
l[0].nodeType)?new q(l):l}})(k)},addRes:function(){var a=this.__res=this.__res||[];a.push.apply(a,f.makeArray(arguments))},destroyRes:function(){for(var a=this.__res||[],f=0;f<a.length;f++){var l=a[f];"function"===typeof l?l():l.destroy?l.destroy():l.remove&&l.remove()}this.__res=[]},getQueryCmd:function(a){return"query"+("-"+a).replace(/-(\w)/g,function(a,f){return f.toUpperCase()})+"Value"}};return l.Utils=v},{requires:["./base","node"]});
KISSY.add("editor/core/walker",function(f,l){function q(b,f){if(this._.end)return k;var c,e=this.range,g,i=this.guard,l=this.type,m=b?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,e.trim(),e.collapsed))return this.end(),k;if(!b&&!this._.guardLTR){var n=e.endContainer[0],q=n.childNodes[e.endOffset];this._.guardLTR=function(a,b){return b&&(n==a||"body"==p.nodeName(a))?!1:a!=q}}if(b&&!this._.guardRTL){var r=e.startContainer[0],t=0<e.startOffset&&r.childNodes[e.startOffset-
1]||null;this._.guardRTL=function(a,b){return b&&(r==a||"body"==p.nodeName(a))?!1:a!=t}}var u=b?this._.guardRTL:this._.guardLTR;g=i?function(b,c){return u(b,c)===a?a:i(b,c)}:u;this.current?c=this.current[m](a,l,g):b?(c=e.endContainer,0<e.endOffset?(c=new j(c[0].childNodes[e.endOffset-1]),g(c[0])===a&&(c=k)):c=g(c,v)===a?k:c._4e_previousSourceNode(v,l,g,void 0)):(c=e.startContainer,c=new j(c[0].childNodes[e.startOffset]),c.length?g(c[0])===a&&(c=k):c=g(e.startContainer,v)===a?k:e.startContainer._4e_nextSourceNode(v,
l,g,void 0));for(;c&&!this._.end;){this.current=c;if(!this.evaluator||this.evaluator(c[0])!==a){if(!f)return c}else if(f&&this.evaluator)return a;c=c[m](a,l,g)}this.end();return this.current=k}function r(a){for(var b,c=k;b=q.call(this,a);)c=b;return c}function n(a){this.range=a;this.guard=this.evaluator=k;this._={}}var v=!0,a=!1,k=null,m=f.UA,p=f.DOM,u=l.XHTML_DTD,j=f.Node;f.augment(n,{end:function(){this._.end=1},next:function(){return q.call(this)},previous:function(){return q.call(this,v)},checkForward:function(){return q.call(this,
a,v)!==a},checkBackward:function(){return q.call(this,v,v)!==a},lastForward:function(){return r.call(this)},lastBackward:function(){return r.call(this,v)},reset:function(){delete this.current;this._={}},_iterator:q});f.mix(n,{blockBoundary:function(a){return function(b){return!(b.nodeType==p.NodeType.ELEMENT_NODE&&p._4e_isBlockBoundary(b,a))}},bookmark:function(a,b){function c(a){return"span"==p.nodeName(a)&&p.attr(a,"_ke_bookmark")}return function(e){var f,i;f=e.nodeType==p.NodeType.TEXT_NODE&&(i=
e.parentNode)&&c(i);f=a?f:f||c(e);return!!(b^f)}},whitespaces:function(a){return function(b){b=b.nodeType==p.NodeType.TEXT_NODE&&!f.trim(b.nodeValue);return!!(a^b)}},invisible:function(a){var b=n.whitespaces();return function(c){c=b(c)||c.nodeType==p.NodeType.ELEMENT_NODE&&!c.offsetHeight;return!!(a^c)}}});var w=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,x=n.whitespaces(),e=n.bookmark(),b=function(a){var b=p.nodeName(a);return e(a)||x(a)||1==a.nodeType&&b in u.$inline&&!(b in u.$empty)};l.Utils.injectDom({_4e_getBogus:function(a){a=
new j(a);do a=a._4e_previousSourceNode();while(a&&b(a[0]));return a&&(!m.ie?"br"==a.nodeName():3==a[0].nodeType&&w.test(a.text()))?a[0]:!1}});return l.Walker=n},{requires:["./base","./utils","./dom","node"]});KISSY.add("editor/core/zIndexManager",function(f,l){var q=l.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};l.baseZIndex=function(f){return(l.Config.baseZIndex||1E4)+f};return q},{requires:["./base"]});
