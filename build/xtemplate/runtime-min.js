/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Aug 27 22:02
*/
KISSY.add("xtemplate/runtime/commands",function(f){var h;return h={each:function(d,a){var b=a.params[0],c="",g;if(b){var m=[0,0].concat(d);if(f.isArray(b)){g=b.length;for(var k=0;k<g;k++)m[0]=b[k],m[1]={xcount:g,xindex:k},c+=a.fn(m)}else for(g in b)m[0]=b[g],m[1]={xindex:g},c+=a.fn(m)}else a.inverse&&(c=a.inverse(d));return c},"with":function(d,a){var b=a.params[0],c=[0].concat(d),g="";b?(c[0]=b,g=a.fn(c)):a.inverse&&(g=a.inverse(d));return g},"if":function(d,a){var b="";a.params[0]?a.fn&&(b=a.fn(d)):
a.inverse&&(b=a.inverse(d));return b},set:function(d,a){for(var b=d.length-1;0<=b;b--)if("object"==typeof d[b]){f.mix(d[b],a.hash);break}return""},include:function(d,a){var b=a.params,d=(a.hash?[a.hash]:[]).concat(d);if(!b||1!=b.length)return"";var c=this.config.name,b=b[0];if("."==b.charAt(0)){if("unspecified"==c)return"";b=f.Path.resolve(c,"../",b)}c=this.config.loader.call(this,b);a=f.merge(this.config);a.name=b;a.commands=this.config.commands;a.macros=this.config.macros;return this.invokeEngine(c,
d,a)},macro:function(d,a){var b=a.params,c=b[0],g=b.slice(1),b=this.config.macros;if(a.fn)b[c]||(b[c]={paramNames:g,fn:a.fn});else{var m={};(b=b[c])||(b=f.require(c));f.each(b.paramNames,function(b,a){m[b]=g[a]});c=d.concat();c.unshift(m);return b.fn.call(this,c)}return""},parse:function(d,a){return h.include.call(this,[],a)}}});
KISSY.add("xtemplate/runtime",function(f,h){function d(g,b){for(var a=b.split("."),c=g,d=a.length,e=0;e<d&&!(c=c[a[e]],!c);e++);return c}function a(g,a){this.tpl=g;a=f.merge(c,a);a.commands=f.merge(a.commands,h);a.utils=b;a.macros=a.macros||{};this.config=a}var b={runBlockCommand:function(a,c,k,l,o){var e=a.config,n=f[e.silent?"log":"error"],i=e.commands,e=d(i,l);if(!e)if(!k.params&&!k.hash){var j=b.getProperty(l,c);!1===j?(n("can not find property: '"+l+"' at line "+o),j=""):j=j[0];e=i["if"];f.isArray(j)?
e=i.each:"object"==typeof j&&(e=i["with"]);k.params=[j]}else return"";l="";try{l=e.call(a,c,k)}catch(h){}return l},getPropertyOrRunCommand:function(a,c,k,l,h,e){var n,i=a.config,j=d(i.commands,l),i=f[i.silent?"log":"error"];if(j)try{n=j.call(a,c,k)}catch(p){return""}else{a=b.getProperty(l,c,h);if(!1===a){i("can not find property: '"+l+"' at line "+e,"warn");return}n=a[0]}return n},getProperty:function(a,b,c){"."===a&&(a="this");var a=a.split("."),d=a.length,f=c||0,e,h,i,j=b.length;"root"==a[0]&&(f=
j-1,a.shift(),d--);for(;f<j;f++){e=b[f];i=1;for(c=0;c<d;c++)if(h=a[c],"this"!==h){if("object"!=typeof e||!(h in e)){i=0;break}e=e[h]}if(i)return"function"==typeof e&&(e=e.call(b[0])),[e]}return!1}},c={silent:!0,name:"unspecified",escapeHtml:!0,loader:function(a){return f.require(a)}};f.mix(a,{commands:h,utils:b,addCommand:function(a,b){h[a]=b},removeCommand:function(a){delete h[a]}});a.prototype={constructor:a,invokeEngine:function(a,b,c){return(new this.constructor(a,c)).render(b,!0)},removeCommand:function(a){delete this.config.commands[a]},
addCommand:function(a,b){this.config.commands[a]=b},render:function(a,b){b||(a=[a]);return this.tpl(a)}};return a},{requires:["./runtime/commands"]});
