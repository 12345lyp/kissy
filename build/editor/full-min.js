/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(i,u,v){u=v.Controller.extend({initializer:function(){this.__commands={};this.__controls={}}},{Config:{},XHTML_DTD:u.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:false},focusable:{value:false},mode:{value:1},data:{getter:function(){return this._getData()},setter:function(s){return this._setData(s)}},formatData:{getter:function(){return this._getData(1)},setter:function(s){return this._setData(s)}},
customStyle:{value:""},customLink:{value:[]}}},{xclass:"editor"});u.HTML_PARSER={textarea:function(s){return s.one("."+this.get("prefixCls")+"editor-textarea")}};i.mix(u,i.EventTarget);return KISSY.Editor=u},{requires:["htmlparser","component/base","core"]});
KISSY.add("editor/core/clipboard",function(i,u,v,s){function k(o){this.editor=o;this._init()}function g(o){var b=o.get("document")[0],a=o.getSelection(),t;if(a.getType()==s.SELECTION_ELEMENT&&(t=a.getSelectedElement())){o=a.getRanges()[0];var d=c(b.createTextNode(""));d.insertBefore(t);o.setStartBefore(d);o.setEndAfter(t);a.selectRanges([o]);setTimeout(function(){if(t.parent()){d.remove();a.selectElement(t)}},0)}}var c=i.all,f=i.UA,e=f.ie?"beforepaste":"paste",n=u.RANGE;i.augment(k,{_init:function(){var o=
this,b=o.editor,a=b.get("document"),t=a.one("body"),d=function(m){this.type=m};d.prototype={exec:function(m){var h=this.type;m.focus();setTimeout(function(){if(f.ie)if(h=="cut")g(m);else if(h=="paste"){o._preventPasteEvent();o._getClipboardDataFromPasteBin()}l(m,h)||alert(y[h])},0)}};t.on(e,o._getClipboardDataFromPasteBin,o);if(f.ie){t.on("paste",o._iePaste,o);a.on("keydown",o._onKeyDown,o);a.on("contextmenu",function(){o._isPreventBeforePaste=1;setTimeout(function(){o._isPreventBeforePaste=0},0)})}b.addCommand("copy",
new d("copy"));b.addCommand("cut",new d("cut"));b.addCommand("paste",new d("paste"))},_onKeyDown:function(o){if(this.editor.get("mode")==u.WYSIWYG_MODE)if(o.ctrlKey&&o.keyCode==86||o.shiftKey&&o.keyCode==45)this._preventPasteEvent()},_stateFromNamedCommand:function(o){var b,a=this.editor;if(o=="paste"){this._isPreventBeforePaste=1;try{b=a.get("document")[0].queryCommandEnabled(o)}catch(t){}this._isPreventBeforePaste=0}else b=(o=(o=a.getSelection())&&o.getRanges())&&!(o.length==1&&o[0].collapsed);
return b},_preventPasteEvent:function(){var o=this;o._preventPasteTimer&&clearTimeout(o._preventPasteTimer);o._isPreventPaste=1;o._preventPasteTimer=setTimeout(function(){o._isPreventPaste=0},70)},_iePaste:function(o){var b=this.editor;if(!this._isPreventPaste){o.preventDefault();b.execCommand("paste")}},_getClipboardDataFromPasteBin:function(){if(!this._isPreventBeforePaste){i.log(e+":  paste event happen");var o=this.editor,b=o.get("document")[0];if(b.getElementById("ke_pastebin"))i.log(e+": trigger more than once ...");
else{var a=o.getSelection(),t=new v(b),d=c(f.webkit?"<body></body>":"<div></div>",b);d.attr("id","ke_pastebin");f.webkit&&d[0].appendChild(b.createTextNode("\u200b"));b.body.appendChild(d[0]);d.css({position:"absolute",top:a.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});d.css("left","-1000px");var m=a.createBookmarks();t.setStartAt(d,n.POSITION_AFTER_START);t.setEndAt(d,n.POSITION_BEFORE_END);t.select(true);setTimeout(function(){var h,r=d;d=f.webkit&&(h=d.first())&&h.hasClass("Apple-style-span")?
h:d;a.selectBookmarks(m);var p=d.html();r.remove();if(p=i.trim(p.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){i.log("paste "+p);h=o.fire("paste",{html:p});if(h!==false){if(h!==undefined)p=h;/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(p)?i.use("editor/plugin/word-filter/dynamic/",function(w,A){o.insertHtml(A.toDataFormat(p,o))}):o.insertHtml(p)}}},0)}}}});var j=function(o,b){var a=o.get("document")[0],t=c(a.body),d=false,m=function(){d=true};t.on(b,m);(f.ie>7?a:a.selection.createRange()).execCommand(b);
t.detach(b,m);return d},l=f.ie?function(o,b){return j(o,b)}:function(o,b){try{return o.get("document")[0].execCommand(b)}catch(a){return false}},y={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},B={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};return{init:function(o){var b;o.docReady(function(){b=new k(o)});var a={copy:1,cut:1,paste:1},t=["copy","cut","paste"];o.on("contextmenu",function(d){var m=
d.contextmenu;if(!m.__copy_fix){m.__copy_fix=1;for(d=0;d<t.length;d++)m.addChild({content:B[t[d]],value:t[d]});m.on("click",function(w){var A=w.target.get("value");if(a[A]){m.hide();setTimeout(function(){o.execCommand("save");o.execCommand(A);setTimeout(function(){o.execCommand("save")},10)},30)}})}var h=m.get("children");for(d=h.length-1;d--;){var r=h[d],p;p=r.get?r.get("value"):r.value;if(a[p]){p=!b._stateFromNamedCommand(p);if(r.set)r.set("disabled",p);else r.disabled=p}}})}}},{requires:["./base",
"./range","./selection","node"]});
KISSY.add("editor/core/dom",function(i,u,v){function s(b,a){var t=b[a?"next":"prev"](k,1);if(t&&t[0].nodeType==f.ELEMENT_NODE){for(var d=[];t.attr("_ke_bookmark")||t._4e_isEmptyInlineRemovable(k);){d.push(t);t=a?t.next(k,1):t.prev(k,1);if(!t)return}if(b._4e_isIdentical(t,k)){for(var m=new n(a?b[0].lastChild:b[0].firstChild);d.length;)d.shift()._4e_move(b,!a,k);t._4e_moveChildren(b,!a,k);t.remove();m[0]&&m[0].nodeType==f.ELEMENT_NODE&&m._4e_mergeSiblings()}}}var k=k,g=u.XHTML_DTD,c=i.DOM,f=c.NodeType,
e=i.UA,n=i.Node,j={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};u.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var l=u.POSITION,y={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,
"table-column":1,"table-cell":1,"table-caption":1},B={hr:1},o=function(b){return b&&(b[0]||b)};v.injectDom({_4e_sameLevel:function(b,a){a=o(a);var t=b.parentNode;return t&&t==a.parentNode},_4e_isBlockBoundary:function(b,a){var t=i.merge(B,a);return!!(y[c.css(b,"display")]||t[c.nodeName(b)])},_4e_index:function(b,a){for(var t=b.parentNode.childNodes,d,m=-1,h=0;h<t.length;h++){d=t[h];if(!(a&&d.nodeType==3&&d.previousSibling&&d.previousSibling.nodeType==3)){m++;if(d===b)return m}}return-1},_4e_move:function(b,
a,t){a=o(a);t?a.insertBefore(b,a.firstChild):a.appendChild(b)},_4e_isIdentical:function(b,a){if(!a)return false;a=o(a);if(c.nodeName(b)!=c.nodeName(a))return false;var t=b.attributes,d=a.attributes,m=t.length,h=d.length;if(m!=h)return false;for(var r=0;r<m;r++){var p=t[r],w=p.name;if(p.specified&&c.attr(b,w)!=c.attr(a,w))return false}if(v.ieEngine<8)for(r=0;r<h;r++){p=d[r];w=p.name;if(p.specified&&c.attr(b,w)!=c.attr(a,w))return false}return true},_4e_isEmptyInlineRemovable:function(b){if(!g.$removeEmpty[c.nodeName(b)])return false;
b=b.childNodes;for(var a=0,t=b.length;a<t;a++){var d=b[a],m=d.nodeType;if(!(m==f.ELEMENT_NODE&&d.getAttribute("_ke_bookmark")))if(m==f.ELEMENT_NODE&&!c._4e_isEmptyInlineRemovable(d)||m==c.NodeType.TEXT_NODE&&i.trim(d.nodeValue))return false}return true},_4e_moveChildren:function(b,a,t){a=o(a);if(b!=a)if(t)for(;t=b.lastChild;)a.insertBefore(b.removeChild(t),a.firstChild);else for(;t=b.firstChild;)a.appendChild(b.removeChild(t))},_4e_mergeSiblings:function(b){b=new n(b);if(j[b.nodeName()]){s(b,true);
s(b)}},_4e_splitText:function(b,a){var t=b.ownerDocument;if(b.nodeType==c.NodeType.TEXT_NODE){if(e.ie&&a==b.nodeValue.length){var d=t.createTextNode("");c.insertAfter(d,b);return d}d=b.splitText(a);if(t.documentMode){t=t.createTextNode("");c.insertAfter(t,d);c.remove(t)}return d}},_4e_parents:function(b,a){var t=[];t.__IS_NODELIST=1;do t[a?"push":"unshift"](b);while(b=b.parentNode);return t},_4e_nextSourceNode:function(b,a,t,d){if(d&&!d.call){var m=o(d);d=function(r){return r!==m}}a=!a&&b.firstChild;
var h=b;if(!a){if(b.nodeType==f.ELEMENT_NODE&&d&&d(b,true)===false)return null;a=b.nextSibling}for(;!a&&(h=h.parentNode);){if(d&&d(h,true)===false)return null;a=h.nextSibling}if(!a)return null;if(d&&d(a)===false)return null;if(t&&t!=a.nodeType)return c._4e_nextSourceNode(a,false,t,d);return a},_4e_previousSourceNode:function(b,a,t,d){if(d&&!d.call){var m=o(d);d=function(r){return r!==m}}a=!a&&b.lastChild;var h=b;if(!a){if(b.nodeType==f.ELEMENT_NODE&&d&&d(b,true)===false)return null;a=b.previousSibling}for(;!a&&
(h=h.parentNode);){if(d&&d(h,true)===false)return null;a=h.previousSibling}if(!a)return null;if(d&&d(a)===false)return null;if(t&&a.nodeType!=t)return c._4e_previousSourceNode(a,false,t,d);return a},_4e_commonAncestor:function(b,a){a=o(a);if(b===a)return b;if(c.contains(a,b))return a;var t=b;do if(c.contains(t,a))return t;while(t=t.parentNode);return null},_4e_hasAttributes:v.ieEngine<9?function(b){for(var a=b.attributes,t=0;t<a.length;t++){var d=a[t];switch(d.name){case "class":if(b.getAttribute("class"))return true;
break;default:if(d.specified)return true}}return false}:function(b){e.gecko&&b.removeAttribute("_moz_dirty");return b.hasAttributes()},_4e_position:function(b,a){var t=o(a);if(b.compareDocumentPosition)return b.compareDocumentPosition(t);if(b==t)return l.POSITION_IDENTICAL;if(b.nodeType==f.ELEMENT_NODE&&t.nodeType==f.ELEMENT_NODE){if(c.contains(b,t))return l.POSITION_CONTAINS+l.POSITION_PRECEDING;if(c.contains(t,b))return l.POSITION_IS_CONTAINED+l.POSITION_FOLLOWING;if("sourceIndex"in b)return b.sourceIndex<
0||t.sourceIndex<0?l.POSITION_DISCONNECTED:b.sourceIndex<t.sourceIndex?l.POSITION_PRECEDING:l.POSITION_FOLLOWING}var d=c._4e_address(b);t=c._4e_address(t);for(var m=Math.min(d.length,t.length),h=0;h<=m-1;h++)if(d[h]!=t[h])return d[h]<t[h]?l.POSITION_PRECEDING:l.POSITION_FOLLOWING;return d.length<t.length?l.POSITION_CONTAINS+l.POSITION_PRECEDING:l.POSITION_IS_CONTAINED+l.POSITION_FOLLOWING},_4e_address:function(b,a){for(var t=[],d=b.ownerDocument.documentElement,m=b;m&&m!=d;){t.unshift(c._4e_index(m,
a));m=m.parentNode}return t},_4e_remove:function(b,a){var t=b.parentNode;if(t){if(a)for(var d;d=b.firstChild;)t.insertBefore(b.removeChild(d),b);t.removeChild(b)}return b},_4e_trim:function(b){c._4e_ltrim(b);c._4e_rtrim(b)},_4e_ltrim:function(b){for(var a;a=b.firstChild;){if(a.nodeType==c.NodeType.TEXT_NODE){var t=v.ltrim(a.nodeValue),d=a.nodeValue.length;if(t){if(t.length<d){c._4e_splitText(a,d-t.length);b.removeChild(b.firstChild)}}else{b.removeChild(a);continue}}break}},_4e_rtrim:function(b){for(var a;a=
b.lastChild;){if(a.type==c.NodeType.TEXT_NODE){var t=v.rtrim(a.nodeValue),d=a.nodeValue.length;if(t){if(t.length<d){c._4e_splitText(a,t.length);b.removeChild(b.lastChild)}}else{b.removeChild(a);continue}}break}if(!e.ie&&!e.opera)(a=b.lastChild)&&a.nodeType==1&&c.nodeName(a)=="br"&&b.removeChild(a)},_4e_appendBogus:function(b){for(var a=b.lastChild;a&&a.nodeType==c.NodeType.TEXT_NODE&&!i.trim(a.nodeValue);)a=a.previousSibling;if(!a||a.nodeType==c.NodeType.TEXT_NODE||c.nodeName(a)!=="br"){a=e.opera?
b.ownerDocument.createTextNode(""):b.ownerDocument.createElement("br");b.appendChild(a)}},_4e_setMarker:function(b,a,t,d){b=new n(b);var m=b.data("list_marker_id")||b.data("list_marker_id",i.guid()).data("list_marker_id"),h=b.data("list_marker_names")||b.data("list_marker_names",{}).data("list_marker_names");a[m]=b;h[t]=1;return b.data(t,d)},_4e_clearMarkers:function(b,a,t){b=new n(b);var d=b.data("list_marker_names"),m=b.data("list_marker_id"),h;for(h in d)b.removeData(h);b.removeData("list_marker_names");
if(t){b.removeData("list_marker_id");delete a[m]}},_4e_copyAttributes:function(b,a,t){a=new n(a);var d=b.attributes;t=t||{};for(var m=0;m<d.length;m++){var h=d[m],r=h.name.toLowerCase(),p;if(!(r in t))if(r=="checked"&&(p=c.attr(b,r)))a.attr(r,p);else if(h.specified||e.ie&&h.value&&r=="value"){p=c.attr(b,r);if(p===null)p=h.nodeValue;a.attr(r,p)}}if(b.style.cssText!=="")a[0].style.cssText=b.style.cssText},_4e_isEditable:function(b){b=c.nodeName(b);return(b=!g.$nonEditable[b]&&(g[b]||g.span))&&b["#text"]},
_4e_getByAddress:function(b,a,t){b=b.documentElement;for(var d=0;b&&d<a.length;d++){var m=a[d];if(t)for(var h=-1,r=0;r<b.childNodes.length;r++){var p=b.childNodes[r];if(!(t===true&&p.nodeType==3&&p.previousSibling&&p.previousSibling.nodeType==3)){h++;if(h==m){b=p;break}}}else b=b.childNodes[m]}return b}})},{requires:["./base","./utils","node"]});
KISSY.add("editor/core/domIterator",function(i,u){function v(B){if(!(arguments.length<1)){this.range=B;this.forceBrBreak=k;this.enlargeBr=s;this.enforceRealBlocks=k;this._||(this._={})}}var s=true,k=false,g=i.UA,c=u.Walker,f=u.Range,e=u.RANGE,n=u.ElementPath,j=i.Node,l=i.DOM,y=/^[\r\n\t ]*$/;i.augment(v,{getNextParagraph:function(B){var o,b,a,t,d;if(!this._.lastNode){b=this.range.clone();b.shrink(e.SHRINK_ELEMENT,s);b.enlarge(this.forceBrBreak||!this.enlargeBr?e.ENLARGE_LIST_ITEM_CONTENTS:e.ENLARGE_BLOCK_CONTENTS);
var m=new c(b),h=c.bookmark(s,s);m.evaluator=h;this._.nextNode=m.next();m=new c(b);m.evaluator=h;m=m.previous();this._.lastNode=m._4e_nextSourceNode(s);if(this._.lastNode&&this._.lastNode[0].nodeType==l.NodeType.TEXT_NODE&&!i.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){h=new f(b.document);h.moveToPosition(this._.lastNode,e.POSITION_AFTER_END);if(h.checkEndOfBlock()){h=new n(h.endContainer);this._.lastNode=(h.block||h.blockLimit)._4e_nextSourceNode(s)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new j(b.document.createTextNode(""));l.insertAfter(this._.lastNode[0],m[0])}b=null}h=this._.nextNode;m=this._.lastNode;for(this._.nextNode=null;h;){var r=k,p=h[0].nodeType!=l.NodeType.ELEMENT_NODE,w=k;if(p){if(h[0].nodeType==l.NodeType.TEXT_NODE)if(y.test(h[0].nodeValue))p=k}else{var A=h.nodeName();if(h._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(A=="br")p=s;else if(!b&&!h[0].childNodes.length&&A!="hr"){o=h;a=h.equals(m);break}if(b){b.setEndAt(h,e.POSITION_BEFORE_START);
if(A!="br")this._.nextNode=h}r=s}else{if(h[0].firstChild){if(!b){b=new f(this.range.document);b.setStartAt(h,e.POSITION_BEFORE_START)}h=new j(h[0].firstChild);continue}p=s}}if(p&&!b){b=new f(this.range.document);b.setStartAt(h,e.POSITION_BEFORE_START)}a=(!r||p)&&h.equals(m);if(b&&!r)for(;!h[0].nextSibling&&!a;){A=h.parent();if(A._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){r=s;a||A.equals(m);break}h=A;p=s;a=h.equals(m);w=s}p&&b.setEndAt(h,e.POSITION_AFTER_END);h=h._4e_nextSourceNode(w,null,m);
if((a=!h)||r&&b)break}if(!o){if(!b){this._.docEndMarker&&this._.docEndMarker._4e_remove();return this._.nextNode=null}o=new n(b.startContainer);h=o.blockLimit;r={div:1,th:1,td:1};o=o.block;if((!o||!o[0])&&!this.enforceRealBlocks&&r[h.nodeName()]&&b.checkStartOfBlock()&&b.checkEndOfBlock())o=h;else if(!o||this.enforceRealBlocks&&o.nodeName()=="li"){o=new j(this.range.document.createElement(B||"p"));o[0].appendChild(b.extractContents());o._4e_trim();b.insertNode(o);t=d=s}else if(o.nodeName()!="li"){if(!b.checkStartOfBlock()||
!b.checkEndOfBlock()){o=o.clone(k);o[0].appendChild(b.extractContents());o._4e_trim();d=b.splitBlock();t=!d.wasStartOfBlock;d=!d.wasEndOfBlock;b.insertNode(o)}}else if(!a)this._.nextNode=o.equals(m)?null:b.getBoundaryNodes().endNode._4e_nextSourceNode(s,null,m)}if(t){b=new j(o[0].previousSibling);if(b[0]&&b[0].nodeType==l.NodeType.ELEMENT_NODE)if(b.nodeName()=="br")b._4e_remove();else b[0].lastChild&&l.nodeName(b[0].lastChild)=="br"&&l._4e_remove(b[0].lastChild)}if(d){b=c.bookmark(k,s);t=new j(o[0].lastChild);
if(t[0]&&t[0].nodeType==l.NodeType.ELEMENT_NODE&&t.nodeName()=="br")if(g.ie||t.prev(b,1)||t.next(b,1))t.remove()}if(!this._.nextNode)this._.nextNode=a||o.equals(m)?null:o._4e_nextSourceNode(s,null,m);return o}});f.prototype.createIterator=function(){return new v(this)};return v},{requires:["./base","./range","./elementPath","./walker","node"]});
KISSY.add("editor",function(i,u,v,s,k,g,c,f,e,n){function j(z,D){var I=z.body;N(function(){z.designMode="on";setTimeout(function(){z.designMode="off";I.focus();if(!arguments.callee.retry)arguments.callee.retry=b},50)},function(){z.designMode="off";p.attr(I,"contentEditable",d);p.attr(I,"contentEditable",b);!D&&j(z,1)})}function l(z){z.get("iframe");var D=z.get("textarea")[0],I=z.get("window")[0],O=z.get("document")[0];if(h.webkit){H.on(O,"click",function(R){var E=new A(R.target);i.inArray(E.nodeName(),
["input","select"])&&R.preventDefault()});H.on(O,"mouseup",function(R){var E=new A(R.target);i.inArray(E.nodeName(),["input","textarea"])&&R.preventDefault()})}if(h.gecko||r||h.opera){var T;T=(new A('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(D);T.on("focus",function(){z.focus()});z.activateGecko=function(){h.gecko&&z.__iframeFocus&&T[0].focus()};z.on("destroy",function(){T.detach();T.remove()})}H.on(I,"focus",function(){if(h.gecko)j(O,d);
else h.opera&&O.body.focus();z.notifySelectionChange()});h.gecko&&H.on(O,"mousedown",function(){z.__iframeFocus||j(O,d)});if(r){H.on(O,"keydown",function(R){if(R.keyCode in{8:1,46:1}){var E=z.getSelection(),K=E.getSelectedElement();if(K){z.execCommand("save");var G=E.getRanges()[0].createBookmark();K.remove();E.selectBookmarks([G]);z.execCommand("save");R.preventDefault()}}});if(O.compatMode=="CSS1Compat"){var S={33:1,34:1};H.on(O,"keydown",function(R){R.keyCode in S&&setTimeout(function(){z.getSelection().scrollIntoView()},
0)})}}h.webkit&&H.on(O,"mousedown",function(R){R=new A(R.target);i.inArray(R.nodeName(),["img","hr","input","textarea","select"])&&z.getSelection().selectElement(R)});h.gecko&&H.on(O,"dragstart",function(R){var E=new A(R.target);E.nodeName()==="img"&&/ke_/.test(E[0].className)&&R.preventDefault()});s.add(z)}function y(z,D,I,O){var T="",S,R=v.debugUrl("theme/editor-iframe.css");for(S=0;S<I.length;S++)T+=i.substitute('<link href="{href}" rel="stylesheet" />',{href:I[S]});return i.substitute(Q,{doctype:m.documentMode===
8?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"${title}",links:T,href:R,style:D,data:O||"&nbsp;",script:z?'<script id="ke_active_script">'+(p.isCustomDomain()?'document.domain="'+m.domain+'";':"")+'parent.KISSY.Editor._initIFrame("'+z+'");<\/script>':""})}function B(z,D){function I(){E=R.document;z.setInternal("document",new A(E));z.setInternal("window",new A(R));O.detach();E.open("text/html","replace");E.write(T);E.close()}var O=z.get("iframe"),T=y(z._UUID,z.get("customStyle"),
z.get("customLink"),D),S=O[0],R=S.contentWindow,E;O.__loaded=1;try{E=R.document}catch(K){S.src=S.src;if(r<7){setTimeout(I,10);return}}I()}function o(z,D){var I=p.getEmptyIframeSrc()||"";if(I)I=' src="'+I+'" ';I=new A(i.substitute(q,{iframeSrc:I}));var O=z.get("textarea");if(O.hasAttr("tabindex"))I.attr("tabIndex",h.webkit?-1:O.attr("tabIndex"));O.parent().prepend(I);z.set("iframe",I);z.__docReady=0;h.gecko&&!I.__loaded?I.on("load",function(){B(z,D)},z):B(z,D)}var b=true,a=a,t=i.all,d=false,m=document,
h=i.UA,r=h.ie,p=i.DOM,w=p.NodeType,A=i.Node,H=i.Event,N=v.tryThese,Q="<!doctype html><html><head>{doctype}<title>{title}</title><link href='{href}' rel='stylesheet' /><style>{style}</style>{links}</head><body class='ks-editor' >{data}{script}</body></html>",q='<iframe style="width:100%;height:100%;border:none;"  frameborder="0"  title="kissy-editor"  allowTransparency="true"  {iframeSrc} ></iframe>',x='<div class="'+".{prefixCls}editor-tools".substring(1)+'"></div><div class="'+".{prefixCls}editor-textarea-wrap".substring(1)+
'" '+(h.mobile?'style="overflow:scroll;-webkit-overflow-scrolling:touch;"':"")+"></div><div class='"+".{prefixCls}editor-status".substring(1)+"'></div>";i.mix(u,{SOURCE_MODE:0,WYSIWYG_MODE:1});var C=u.WYSIWYG_MODE;i.augment(u,{createDom:function(){var z,D=this.get("prefixCls"),I=this.get("textarea"),O;if(I){this.set("textarea",I=t(I));I[0].parentNode&&I[0].parentNode.removeChild(I[0])}else this.set("textarea",I=t("<textarea class='"+D+"-editor-textarea'></textarea>"));O=this.get("el");O.html(i.substitute(x,
{prefixCls:D}));z=O.one(i.substitute(".{prefixCls}editor-textarea-wrap",{prefixCls:D}));this._UUID=i.guid();this.set({toolBarEl:O.one(i.substitute(".{prefixCls}editor-tools",{prefixCls:D})),statusBarEl:O.one(i.substitute(".{prefixCls}editor-status",{prefixCls:D}))},{silent:1});I.css("width","100%");I.css("display","none");z.append(I);s.register(this)},renderUI:function(){c.init(this);f.init(this);e.init(this);n.init(this)},bindUI:function(){function z(){D.detach("docReady",z);if(D.get("focused"))D.focus();
else{var S=D.getSelection();S&&S.removeAllRanges()}}var D=this,I,O=D.get("prefixCls"),T=D.get("textarea");if(D.get("attachForm")&&(I=T[0].form)){H.on(I,"submit",D.sync,D);D.on("destroy",function(){H.detach(I,"submit",D.sync,D)})}D.on("docReady",z);D.on("blur",function(){D.get("el").removeClass(O+"editor-focused")});D.on("focus",function(){D.get("el").addClass(O+"editor-focused")})},_onSetHeight:function(z){var D=this.get("textarea"),I=this.get("toolBarEl"),O=this.get("statusBarEl");z=parseInt(z,10);
z-=(I&&I.outerHeight()||0)+(O&&O.outerHeight()||0);D.parent().css("height",z);D.css("height",z)},_onSetMode:function(z){var D=this,I,O=D.get("rendered"),T=D.get("iframe"),S=D.get("textarea");if(z==C){O&&D.execCommand("save");D.on("docReady",I=function(){O&&D.execCommand("save");D.detach("docReady",I)});D._setData(S.val());S.hide();D.fire("wysiwygMode")}else{if(T){S.val(D._getData(1,C));T.hide()}S.show();D.fire("sourceMode")}},_onSetFocused:function(z){z&&this.__docReady&&this.focus()},destructor:function(){var z=
this.get("document")[0],D=this.get("window");this.sync();s.remove(this);H.remove([z,z.documentElement,z.body,D[0]]);i.each(this.__controls,function(I){I.destroy&&I.destroy()});this.__commands={};this.__controls={}},getControl:function(z){return this.__controls[z]},getControls:function(){return this.__controls},addControl:function(z,D){this.__controls[z]=D},showDialog:function(z,D){z+="/dialog";var I=this.__controls[z];I.show(D);this.fire("dialogShow",{dialog:I.dialog,pluginDialog:I,dialogName:z})},
addCommand:function(z,D){this.__commands[z]=D},hasCommand:function(z){return this.__commands[z]},execCommand:function(z){var D=this.__commands[z],I=i.makeArray(arguments);I.shift();I.unshift(this);if(D)return D.exec.apply(D,I);else{i.log(z+": command not found");return a}},queryCommandValue:function(z){return this.execCommand(v.getQueryCmd(z))},_getData:function(z,D){var I=this.htmlDataProcessor,O;if(D==a)D=this.get("mode");O=D==C?this.get("document")[0].body.innerHTML:I.toDataFormat(this.get("textarea").val());
O=z?I.toHtml(O):I.toServer(O);O=i.trim(O);if(/^(?:<(p)>)?(?:(?:&nbsp;)|\s)*(?:<\/\1>)?$/.test(O))O="";return O},_setData:function(z){var D,I=z;if(this.get("mode")!=C)this.get("textarea").val(z);else{if(D=this.htmlDataProcessor)I=D.toDataFormat(z);if(this.get("iframe")){z=this.get("iframe");D=this.get("window")[0];var O=this.get("document")[0];H.remove([O,O.documentElement,O.body,D]);z.remove()}o(this,I)}},sync:function(){this.get("textarea").val(this.get("data"))},getDocHtml:function(){return y(0,
this.get("customStyle"),this.get("customLink"),this.get("formatData"))},getSelection:function(){return u.Selection.getSelection(this.get("document")[0])},focus:function(){var z=this.get("window");if(z){var D=this.get("document")[0];z=z[0];h.ie||z&&z.parent&&z.parent.focus();z&&z.focus();try{D.body.focus()}catch(I){}this.notifySelectionChange()}},blur:function(){this.get("window")[0].blur();this.get("document")[0].body.blur()},addCustomStyle:function(z,D){var I=this.get("window"),O=this.get("customStyle")||
"";O+="\n"+z;this.set("customStyle",O);I&&p.addStyleSheet(I,z,D)},removeCustomStyle:function(z){p.remove(p.get("#"+z,this.get("window")[0]))},addCustomLink:function(z){var D=this.get("customLink")||[],I=this.get("document")[0];D.push(z);this.set("customLink",D);D=I.createElement("link");D.rel="stylesheet";I.getElementsByTagName("head")[0].appendChild(D);D.href=z},removeCustomLink:function(z){var D=this.get("document")[0];D=p.query("link",D);for(var I=0;I<D.length;I++)p.attr(D[I],"href")==z&&p.remove(D[I]);
D=this.get("customLink")||[];z=i.indexOf(z,D);z!=-1&&D.splice(z,1)},docReady:function(z){this.on("docReady",z);this.__docReady&&z.call(this)},checkSelectionChange:function(){var z=this;z.__checkSelectionChangeId&&clearTimeout(z.__checkSelectionChangeId);z.__checkSelectionChangeId=setTimeout(function(){var D=z.getSelection();if(D&&!D.isInvalid){var I=D.getStartElement(),O=new u.ElementPath(I);if(!z.__previousPath||!z.__previousPath.compare(O)){z.__previousPath=O;z.fire("selectionChange",{selection:D,
path:O,element:I})}}},100)},notifySelectionChange:function(){this.__previousPath=null;this.checkSelectionChange()},insertElement:function(z){if(this.get("mode")!==C)return a;this.focus();var D,I=z.nodeName(),O=u.XHTML_DTD,T=O.$block[I],S=u.RANGE,R=(I=this.getSelection())&&I.getRanges(),E,K,G;if(!R||R.length==0)return a;this.execCommand("save");for(K=R.length-1;K>=0;K--){E=R[K];D=!K&&z||z.clone(b);E.insertNodeByDtd(D);G||(G=D)}if(!G)return a;E.moveToPosition(G,S.POSITION_AFTER_END);if(T){z=u.Walker.whitespaces(true);
(z=(G=G.next(z,1))&&G[0].nodeType==w.ELEMENT_NODE&&G.nodeName())&&O.$block[z]&&O[z]["#text"]&&E.moveToElementEditablePosition(G)}I.selectRanges([E]);this.focus();D&&D[0].nodeType==1&&D.scrollIntoView(a,{alignWithTop:false,allowHorizontalScroll:true,onlyScrollIfNeeded:true});F.call(this);return D},insertHtml:function(z,D){var I=this,O,T=I.get("document")[0];if(I.get("mode")===C){if(O=I.htmlDataProcessor)z=O.toDataFormat(z,D);I.focus();I.execCommand("save");if(r){O=T.selection;O.type=="Control"&&O.clear();
try{O.createRange().pasteHTML(z)}catch(S){i.log("insertHtml error in ie")}}else try{T.execCommand("inserthtml",d,z)}catch(R){setTimeout(function(){if(I.getSelection().getRanges().length==0){var E=new u.Range(T),K=p.first(T.body,function(G){return G.nodeType==1&&p.nodeName(G)!="br"});if(!K){K=new A(T.createElement("p"));K._4e_appendBogus(a);T.body.appendChild(K[0])}E.setStartAt(K,u.RANGE.POSITION_AFTER_START);E.select()}T.execCommand("inserthtml",d,z)},50)}setTimeout(function(){I.getSelection().scrollIntoView()},
50);F.call(I)}},insertHTML:function(z,D){return this.insertHtml(z,D)}});u._initIFrame=function(z){var D=s.getInstance(z),I=D.get("document")[0];z=I.getElementById("ke_active_script");p.remove(z);l(D);var O=I.body;if(r){O.hideFocus=b;O.disabled=b;O.contentEditable=b;O.removeAttribute("disabled")}else setTimeout(function(){if(h.gecko||h.opera)O.contentEditable=b;else if(h.webkit)O.parentNode.contentEditable=b;else I.designMode="on"},0);if(h.gecko||h.opera){var T=I.documentElement;H.on(T,"mousedown",
function(S){if(S.target==T){h.gecko&&j(I,d);D.activateGecko()}})}setTimeout(function(){r&&setTimeout(function(){if(I){O.runtimeStyle.marginBottom="0px";O.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){D.__docReady=1;D.fire("docReady");var S=D.get("disableObjectResizing"),R=D.get("disableInlineTableEditing");if(S||R)try{I.execCommand("enableObjectResizing",d,!S);I.execCommand("enableInlineTableEditing",d,!R)}catch(E){H.on(O,r?"resizestart":"resize",function(K){var G=new A(K.target);
if(S||G.nodeName()==="table"&&R)K.preventDefault()})}},10)};var F=i.buffer(function(){this.execCommand("save")},50);return u},{requires:["editor/core/base","editor/core/utils","editor/core/focusManager","editor/core/styles","editor/core/zIndexManager","editor/core/clipboard","editor/core/enterKey","editor/core/htmlDataProcessor","editor/core/selectionFix"]});
KISSY.add("editor/core/elementPath",function(i,u){function v(e){var n=g,j=g,l=[];for(e=e;e;){if(e[0].nodeType==s.NodeType.ELEMENT_NODE){if(!this.lastElement)this.lastElement=e;var y=e.nodeName();if(!j){if(!n&&c[y])n=e;if(f[y]){var B;if(B=!n){if(B=y=="div"){a:{B=e[0].childNodes;for(var o=0,b=B.length;o<b;o++){var a=B[o];if(a.nodeType==s.NodeType.ELEMENT_NODE&&k.$block[a.nodeName.toLowerCase()]){B=true;break a}}B=false}B=!B}B=B}if(B)n=e;else j=e}}l.push(e);if(y=="body")break}e=e.parent()}this.block=
n;this.blockLimit=j;this.elements=l}var s=i.DOM,k=u.XHTML_DTD,g=null,c={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},f={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};v.prototype={constructor:v,compare:function(e){var n=this.elements;e=e&&e.elements;if(!e||n.length!=e.length)return false;for(var j=0;j<n.length;j++)if(!s.equals(n[j],e[j]))return false;return true},contains:function(e){for(var n=this.elements,j=0;j<n.length;j++)if(n[j].nodeName()in
e)return n[j];return g},toString:function(){var e=this.elements,n,j=[];for(n=0;n<e.length;n++)j.push(e[n].nodeName());return j.toString()}};return u.ElementPath=v},{requires:["./base","./dom","node"]});
KISSY.add("editor/core/enterKey",function(i,u,v,s){function k(l){var y;y=l.getSelection().getRanges();for(var B=y.length-1;B>0;B--)y[B].deleteContents();y=y[0];B=y.document;if(y.checkStartOfBlock()&&y.checkEndOfBlock()){var o=(new s(y.startContainer)).block;if(o&&(o.nodeName()=="li"||o.parent().nodeName()=="li"))if(l.hasCommand("outdent")){l.execCommand("save");l.execCommand("outdent");l.execCommand("save");return true}else return false}var b=y.splitBlock("p");if(!b)return true;l=b.previousBlock;
o=b.nextBlock;var a=b.wasStartOfBlock,t=b.wasEndOfBlock,d;if(o){d=o.parent();if(d.nodeName()=="li"){o._4e_breakParent(d);o._4e_move(o.next(),true)}}else if(l&&(d=l.parent())&&d.nodeName()=="li"){l._4e_breakParent(d);y.moveToElementEditablePosition(l.next());l._4e_move(l.prev())}if(!a&&!t){if(o.nodeName()=="li"&&(d=o.first(v.invisible(true)))&&i.inArray(d.nodeName(),["ul","ol"]))(c.ie?new n(B.createTextNode("\u00a0")):new n(B.createElement("br"))).insertBefore(d);o&&y.moveToElementEditablePosition(o)}else{var m;
if(l){if(l.nodeName()=="li"||!f.test(l.nodeName()))m=l.clone()}else if(o)m=o.clone();m||(m=new n("<p>",null,B));if(d=b.elementPath){b=0;for(var h=d.elements.length;b<h;b++){var r=d.elements[b];if(r.equals(d.block)||r.equals(d.blockLimit))break;if(e.$removeEmpty[r.nodeName()]){r=r.clone();m._4e_moveChildren(r);m.append(r)}}}c.ie||m._4e_appendBogus();y.insertNode(m);if(c.ie&&a&&(!t||!l[0].childNodes.length)){y.moveToElementEditablePosition(t?l:m);y.select()}y.moveToElementEditablePosition(a&&!t?o:m)}if(!c.ie)if(o){m=
new n(B.createElement("span"));m.html("&nbsp;");y.insertNode(m);m.scrollIntoView(undefined,{alignWithTop:false,allowHorizontalScroll:true,onlyScrollIfNeeded:true});y.deleteContents()}else m.scrollIntoView(undefined,{alignWithTop:false,allowHorizontalScroll:true,onlyScrollIfNeeded:true});y.select();return true}function g(l){var y=l.get("document")[0];j.on(y,"keydown",function(B){if(B.keyCode===13)if(!(B.shiftKey||B.ctrlKey||B.metaKey)){l.execCommand("save");var o=l.execCommand("enterBlock");l.execCommand("save");
o!==false&&B.preventDefault()}})}var c=i.UA,f=/^h[1-6]$/,e=u.XHTML_DTD,n=i.Node,j=i.Event;return{init:function(l){l.addCommand("enterBlock",{exec:k});l.docReady(function(){g(l)})}}},{requires:["./base","./walker","./elementPath","node"]});
KISSY.add("editor/core/focusManager",function(i){function u(){var l=this;l.__iframeFocus=e;f=l;c&&clearTimeout(c);c=setTimeout(function(){l.fire("focus")},100)}function v(){var l=this;l.__iframeFocus=n;f=j;c&&clearTimeout(c);c=setTimeout(function(){l.fire("blur")},100)}var s=i.Editor,k=i.Event,g={},c,f;i={refreshAll:function(){for(var l in g){var y=g[l].get("document")[0];y.designMode="off";y.designMode="on"}},currentInstance:function(){return f},getInstance:function(l){return g[l]},add:function(l){var y=
l.get("window")[0];k.on(y,"focus",u,l);k.on(y,"blur",v,l)},register:function(l){g[l._UUID]=l},remove:function(l){delete g[l._UUID];var y=l.get("window")[0];k.remove(y,"focus",u,l);k.remove(y,"blur",v,l)}};var e=true,n=false,j=null;i.refreshAll=i.refreshAll;s.focusManager=i;s.getInstances=function(){return g};return i},{requires:["./base","./dom"]});
KISSY.add("editor/core/htmlDataProcessor",function(i,u,v){return{init:function(s){function k(h){h=h.childNodes;var r,p,w,A=h.length;if(A){w=1;for(r=0;r<A;r++){p=h[r];if(!(p.nodeType==i.DOM.NodeType.TEXT_NODE&&!p.nodeValue)){w=0;break}}return w?false:undefined}else return false}function g(h){return h.replace(y,function(r,p,w){return"<"+p+w.replace(B,function(A,H){if(w.indexOf("_ke_saved_"+H)==-1)return" _ke_saved_"+A+" "+A;return A})+">"})}function c(h){return h.replace(b,function(r){return"<ke:encoded>"+
encodeURIComponent(r)+"</ke:encoded>"})}function f(h){return h.replace(a,function(r,p){return i.urlDecode(p)})}var e=i.Node,n=i.UA,j=new v.Filter,l=new v.Filter;(function(){function h(w){w=v.serialize(w);return new v.Comment(o+encodeURIComponent(w).replace(/--/g,"%2D%2D"))}var r={tagNames:[[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]],tags:{script:h,noscript:h,span:k}},p={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(w){if(w.attributes.length)for(var A=
["name","href","src"],H,N=0;N<A.length;N++){H="_ke_saved_"+A[N];w.getAttribute(H)&&w.removeAttribute(A[N])}return w},embed:function(w){var A=w.parentNode;if(A&&A.nodeName=="object"){var H=A.getAttribute("width");A=A.getAttribute("height");H&&w.setAttribute("width",H);A&&w.setAttribute("width",A)}},a:function(w){if(!w.childNodes.length&&!w.attributes.length)return false},span:k,strong:k,em:k,del:k,u:k},attributes:{style:function(w){if(!i.trim(w))return false}},attributeNames:[[/^_ke_saved_/,""],[/^ke_on/,
"on"],[/^_ke.*/,""],[/^ke:.*$/,""],[/^_ks.*/,""]],comment:function(w){if(w.substr(0,o.length)==o){w=i.trim(i.urlDecode(w.substr(o.length)));return v.parse(w).childNodes[0]}}};if(n.ie)p.attributes.style=function(w){return w.replace(/(^|;)([^:]+)/g,function(A){return A.toLowerCase()})};j.addRules(p);l.addRules(r)})();(function(){function h(C){C=C.childNodes;for(var F=C.length,z=C[F-1];z&&z.nodeType==3&&!i.trim(z.nodeValue);)z=C[--F];return z}function r(C){var F=h(C);if(F)if(F.nodeType==1&&F.nodeName==
"br")C.removeChild(F);else F.nodeType==3&&H.test(F.nodeValue)&&C.removeChild(F)}function p(C){var F=h(C);return!F||C.nodeName=="form"&&F.nodeName=="input"}function w(C){r(C);if(p(C))n.ie||C.appendChild(new v.Tag("br"))}function A(C){r(C);p(C)&&C.appendChild(new v.Text("\u00a0"))}var H=/^[\t\r\n ]*(?:&nbsp;|\xa0)[\t\r\n ]*$/,N=u.XHTML_DTD,Q=i.merge(N.$block,N.$listItem,N.$tableContent),q;for(q in Q)"br"in N[q]||delete Q[q];delete Q.pre;N={tags:{}};var x={tags:{}};for(q in Q){N.tags[q]=w;x.tags[q]=A}l.addRules(N);
j.addRules(x)})();j.addRules({text:function(h){return h.replace(/\xa0/g,"&nbsp;")}});var y=/<(a|area|img|input)\b([^>]*)>/gi,B=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,o="{ke_protected}",b=/(?:<textarea[^>]*>[\s\S]*<\/textarea>)|(?:<style[^>]*>[\s\S]*<\/style>)|(?:<script[^>]*>[\s\S]*<\/script>)|(?:<(:?link|meta|base)[^>]*>)/gi,a=/<ke:encoded>([^<]*)<\/ke:encoded>/gi,t=/(<\/?)((?:object|embed|param|html|body|head|title|noscript)[^>]*>)/gi,d=/(<\/?)ke:((?:object|embed|param|html|body|head|title|noscript)[^>]*>)/gi,
m=/<ke:(param|embed)([^>]*?)\/?>(?!\s*<\/ke:\1)/gi;s.htmlDataProcessor={dataFilter:l,htmlFilter:j,toHtml:function(h){if(n.webkit)h=h.replace(/\u200b/g,"");var r=new v.BeautifyWriter;(new v.Parser(h)).parse().writeHtml(r,j);return h=r.getHtml()},toDataFormat:function(h,r){r=r||l;h=c(h);h=g(h);h=h.replace(t,"$1ke:$2");h=h.replace(m,"<ke:$1$2></ke:$1>");var p=new e("<div>");p.html("a"+h);h=p.html().substr(1);h=h.replace(d,"$1$2");h=f(h);p=new v.BasicWriter;(new v.Parser(h)).parse().writeHtml(p,r);return h=
p.getHtml()},toServer:function(h){var r=new v.MinifyWriter;(new v.Parser(h)).parse().writeHtml(r,j);return r.getHtml()}}}}},{requires:["./base","htmlparser"]});
KISSY.config("modules",{"editor/plugin/heading/cmd":{requires:["editor"]},"editor/plugin/page-break/index":{requires:["editor","editor/plugin/fake-objects/"]},"editor/plugin/italic/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/font-size/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/image/dialog":{requires:["ajax","editor","editor/plugin/overlay/","tabs","editor/plugin/menubutton/"]},"editor/plugin/underline/index":{requires:["editor","editor/plugin/font/ui",
"editor/plugin/underline/cmd"]},"editor/plugin/maximize/cmd":{requires:["editor"]},"editor/plugin/contextmenu/index":{requires:["editor","menu","editor/plugin/focus-fix/"]},"editor/plugin/heading/index":{requires:["editor","editor/plugin/heading/cmd"]},"editor/plugin/drag-upload/index":{requires:["editor"]},"editor/plugin/color/cmd":{requires:["editor"]},"editor/plugin/code/index":{requires:["editor","editor/plugin/dialog-loader/"]},"editor/plugin/flash/dialog":{requires:["editor","editor/plugin/flash-common/utils",
"editor/plugin/overlay/","editor/plugin/menubutton/"]},"editor/plugin/strike-through/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/unordered-list/index":{requires:["editor","editor/plugin/list-utils/btn","editor/plugin/unordered-list/cmd"]},"editor/plugin/outdent/cmd":{requires:["editor","editor/plugin/dent-utils/cmd"]},"editor/plugin/italic/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/italic/cmd"]},"editor/plugin/remove-format/cmd":{requires:["editor"]},
"editor/plugin/font-size/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/font-size/cmd"]},"editor/plugin/indent/cmd":{requires:["editor","editor/plugin/dent-utils/cmd"]},"editor/plugin/table/index":{requires:["editor","editor/plugin/dialog-loader/","editor/plugin/contextmenu/"]},"editor/plugin/word-filter/dynamic/index":{requires:["htmlparser"]},"editor/plugin/justify-left/cmd":{requires:["editor/plugin/justify-utils/cmd"]},"editor/plugin/resize/index":{requires:["editor","dd/base"]},
"editor/plugin/video/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton/"]},"editor/plugin/focus-fix/index":{requires:["editor"]},"editor/plugin/xiami-music/index":{requires:["editor","editor/plugin/flash-common/baseClass","editor/plugin/flash-common/utils","editor/plugin/fake-objects/"]},"editor/plugin/maximize/index":{requires:["editor","editor/plugin/maximize/cmd"]},"editor/plugin/color/color-picker/dialog":{requires:["editor","editor/plugin/overlay/"]},"editor/plugin/smiley/index":{requires:["editor",
"editor/plugin/overlay/"]},"editor/plugin/separator/index":{requires:["editor"]},"editor/plugin/video/index":{requires:["editor","editor/plugin/flash-common/utils","editor/plugin/flash-common/baseClass","editor/plugin/fake-objects/"]},"editor/plugin/multiple-upload/index":{requires:["editor","editor/plugin/dialog-loader/"]},"editor/plugin/undo/btn":{requires:["editor","editor/plugin/button/"]},"editor/plugin/menubutton/index":{requires:["editor","menubutton"]},"editor/plugin/flash/index":{requires:["editor",
"editor/plugin/flash-common/baseClass","editor/plugin/flash-common/utils","editor/plugin/fake-objects/"]},"editor/plugin/overlay/index":{requires:["editor","overlay","editor/plugin/focus-fix/","dd/plugin/constrain","component/plugin/drag"]},"editor/plugin/link/utils":{requires:["editor"]},"editor/plugin/xiami-music/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton/"]},"editor/plugin/list-utils/cmd":{requires:["editor","editor/plugin/list-utils/"]},"editor/plugin/button/index":{requires:["editor",
"button"]},"editor/plugin/checkbox-source-area/index":{requires:["editor"]},"editor/plugin/strike-through/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/strike-through/cmd"]},"editor/plugin/fore-color/index":{requires:["editor","editor/plugin/color/btn","editor/plugin/fore-color/cmd"]},"editor/plugin/flash-bridge/index":{requires:["swf","editor"]},"editor/plugin/fore-color/cmd":{requires:["editor/plugin/color/cmd"]},"editor/plugin/table/dialog":{requires:["editor","editor/plugin/overlay/",
"editor/plugin/menubutton/"]},"editor/plugin/justify-utils/cmd":{requires:["editor"]},"editor/plugin/undo/index":{requires:["editor","editor/plugin/undo/btn","editor/plugin/undo/cmd"]},"editor/plugin/justify-right/cmd":{requires:["editor/plugin/justify-utils/cmd"]},"editor/plugin/image/index":{requires:["editor","editor/plugin/button/","editor/plugin/bubble/","editor/plugin/contextmenu/","editor/plugin/dialog-loader/"]},"editor/plugin/dent-utils/cmd":{requires:["editor","editor/plugin/list-utils/"]},
"editor/plugin/ordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]},"editor/plugin/list-utils/index":{requires:["editor"]},"editor/plugin/dialog-loader/index":{requires:["overlay","editor"]},"editor/plugin/flash-common/utils":{requires:["swf"]},"editor/plugin/font-family/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/font-family/cmd"]},"editor/plugin/undo/cmd":{requires:["editor"]},"editor/plugin/indent/index":{requires:["editor","editor/plugin/indent/cmd"]},"editor/plugin/font/cmd":{requires:["editor"]},
"editor/plugin/ordered-list/index":{requires:["editor","editor/plugin/list-utils/btn","editor/plugin/ordered-list/cmd"]},"editor/plugin/color/btn":{requires:["editor","editor/plugin/button/","editor/plugin/overlay/","editor/plugin/dialog-loader/"]},"editor/plugin/bold/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/local-storage/index":{requires:["editor","overlay","editor/plugin/flash-bridge/"]},"editor/plugin/bubble/index":{requires:["overlay","editor"]},"editor/plugin/underline/cmd":{requires:["editor",
"editor/plugin/font/cmd"]},"editor/plugin/bold/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/bold/cmd"]},"editor/plugin/back-color/index":{requires:["editor","editor/plugin/color/btn","editor/plugin/back-color/cmd"]},"editor/plugin/draft/index":{requires:["editor","editor/plugin/local-storage/","overlay","editor/plugin/menubutton/"]},"editor/plugin/link/index":{requires:["editor","editor/plugin/bubble/","editor/plugin/link/utils","editor/plugin/dialog-loader/","editor/plugin/button/"]},
"editor/plugin/remove-format/index":{requires:["editor","editor/plugin/remove-format/cmd","editor/plugin/button/"]},"editor/plugin/font/ui":{requires:["editor","editor/plugin/button/","editor/plugin/menubutton/"]},"editor/plugin/element-path/index":{requires:["editor"]},"editor/plugin/source-area/index":{requires:["editor","editor/plugin/button/"]},"editor/plugin/justify-right/index":{requires:["editor","editor/plugin/justify-right/cmd"]},"editor/plugin/list-utils/btn":{requires:["editor","editor/plugin/button/",
"editor/plugin/menubutton/"]},"editor/plugin/justify-left/index":{requires:["editor","editor/plugin/justify-left/cmd"]},"editor/plugin/outdent/index":{requires:["editor","editor/plugin/outdent/cmd"]},"editor/plugin/fake-objects/index":{requires:["editor"]},"editor/plugin/font-family/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/back-color/cmd":{requires:["editor/plugin/color/cmd"]},"editor/plugin/link/dialog":{requires:["editor","editor/plugin/overlay/","editor/plugin/link/utils"]},
"editor/plugin/multiple-upload/dialog":{requires:["editor","component/plugin/drag","editor/plugin/progressbar/","editor/plugin/overlay/","editor/plugin/flash-bridge/","editor/plugin/local-storage/","swf"]},"editor/plugin/code/dialog":{requires:["editor","editor/plugin/overlay/","menubutton"]},"editor/plugin/justify-center/cmd":{requires:["editor/plugin/justify-utils/cmd"]},"editor/plugin/flash-common/baseClass":{requires:["editor","editor/plugin/contextmenu/","editor/plugin/bubble/","editor/plugin/dialog-loader/",
"editor/plugin/flash-common/utils"]},"editor/plugin/justify-center/index":{requires:["editor","editor/plugin/justify-center/cmd"]},"editor/plugin/unordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});
KISSY.add("editor/core/range",function(i,u,v,s,k){function g(q){var x=q.nodeType!=a.NodeType.TEXT_NODE&&a.nodeName(q)in d.$removeEmpty,C=q.nodeType==a.NodeType.TEXT_NODE&&!i.trim(q.nodeValue);q=!!q.parentNode.getAttribute("_ke_bookmark");return x||C||q}function c(q){return!w(q)&&!A(q)}function f(q){var x=y;return function(C){if(A(C))return l;if(C.nodeType==a.NodeType.TEXT_NODE){if(i.trim(C.nodeValue).length)return y}else if(C.nodeType==a.NodeType.ELEMENT_NODE){C=a.nodeName(C);if(!Q[C])if(!q&&!t.ie&&
C=="br"&&!x)x=l;else return y}return l}}function e(q,x){var C=q.startContainer,F=q.endContainer,z=q.startOffset,D=q.endOffset,I,O=y,T=y,S=undefined,R=q.document,E;if(x>0)S=R.createDocumentFragment();if(q.collapsed)return S;q.optimizeBookmark();if(F[0].nodeType==a.NodeType.TEXT_NODE){T=l;F=F._4e_splitText(D)}else if(F[0].childNodes.length>0)if(D>=F[0].childNodes.length){F=new m(F[0].appendChild(R.createTextNode("")));E=l}else F=new m(F[0].childNodes[D]);if(C[0].nodeType==a.NodeType.TEXT_NODE){O=l;
C._4e_splitText(z)}else if(z)if(z>=C[0].childNodes.length){C=new m(C[0].appendChild(R.createTextNode("")));I=l}else C=new m(C[0].childNodes[z].previousSibling);else{I=new m(R.createTextNode(""));C.prepend(I);C=I;I=l}var K=C._4e_parents(),G=F._4e_parents();K.each(function(W,X){K[X]=W});G.each(function(W,X){G[X]=W});var J,L;for(R=0;R<K.length;R++){J=K[R];L=G[R];if(!J.equals(L))break}z=S;for(var M,P,U=R;U<K.length;U++){M=K[U];D=x>0&&!M.equals(C)?z.appendChild(M.clone()[0]):null;M=M[0].nextSibling;P=
G[U];for(var V=F[0],Y=P&&P[0];M;){if(Y==M||V==M)break;P=M.nextSibling;if(x==2)z.appendChild(M.cloneNode(l));else{if(r[M.nodeName.toLowerCase()]){var $=M.cloneNode(l);M.innerHTML="";M=$}else a._4e_remove(M);x==1&&z.appendChild(M)}M=P}if(D)z=D}z=S;for(R=R;R<G.length;R++){M=G[R];D=x>0&&!M.equals(F)?z.appendChild(M.clone()[0]):null;if(!K[R]||!M._4e_sameLevel(K[R]))for(M=M[0].previousSibling;M;){P=M.previousSibling;if(x==2)z.insertBefore(M.cloneNode(l),z.firstChild);else{a._4e_remove(M);x==1&&z.insertBefore(M,
z.firstChild)}M=P}if(D)z=D}if(x==2){if(O){J=C[0];if(J.nodeType==a.NodeType.TEXT_NODE&&J.nextSibling&&J.nextSibling.nodeType==a.NodeType.TEXT_NODE){J.data+=J.nextSibling.data;J.parentNode.removeChild(J.nextSibling)}}if(T){T=F[0];if(T.nodeType==a.NodeType.TEXT_NODE&&T.previousSibling&&T.previousSibling.nodeType==a.NodeType.TEXT_NODE){T.previousSibling.data+=T.data;T.parentNode.removeChild(T)}}}else{if(J&&L&&(!C._4e_sameLevel(J)||!F._4e_sameLevel(L))){T=J._4e_index();I&&J._4e_sameLevel(C)&&T--;q.setStart(J.parent(),
T+1)}q.collapse(l)}I&&C.remove();E&&F.remove();return S}function n(q){q.collapsed=q.startContainer&&q.endContainer&&q.startContainer[0]==q.endContainer[0]&&q.startOffset==q.endOffset}function j(q){this.endOffset=this.endContainer=this.startOffset=this.startContainer=B;this.collapsed=l;this.document=q}u.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,
SHRINK_TEXT:2};var l=true,y=false,B=null,o=u.RANGE,b=u.POSITION,a=i.DOM,t=i.UA,d=u.XHTML_DTD,m=i.Node,h=m.all,r={td:1},p={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},w=new s.whitespaces,A=new s.bookmark,H=s.whitespaces(l),N=s.bookmark(false,true),Q={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};i.augment(j,{toString:function(){var q=[],x=this.startContainer[0],
C=this.endContainer[0];q.push((x.id||x.nodeName)+":"+this.startOffset);q.push((C.id||C.nodeName)+":"+this.endOffset);return q.join("<br/>")},optimize:function(){var q=this.startContainer,x=this.startOffset;if(q[0].nodeType!=a.NodeType.ELEMENT_NODE)if(x)x>=q[0].nodeValue.length&&this.setStartAfter(q);else this.setStartBefore(q);q=this.endContainer;x=this.endOffset;if(q[0].nodeType!=a.NodeType.ELEMENT_NODE)if(x)x>=q[0].nodeValue.length&&this.setEndAfter(q);else this.setEndBefore(q)},setStartAfter:function(q){this.setStart(q.parent(),
q._4e_index()+1)},setStartBefore:function(q){this.setStart(q.parent(),q._4e_index())},setEndAfter:function(q){this.setEnd(q.parent(),q._4e_index()+1)},setEndBefore:function(q){this.setEnd(q.parent(),q._4e_index())},optimizeBookmark:function(){var q=this.startContainer,x=this.endContainer;q&&q.nodeName()=="span"&&q.attr("_ke_bookmark")&&this.setStartBefore(q);x&&x.nodeName()=="span"&&x.attr("_ke_bookmark")&&this.setEndAfter(x)},setStart:function(q,x){if(q[0].nodeType==a.NodeType.ELEMENT_NODE&&p[q.nodeName()]){q=
q.parent();x=q._4e_index()}this.startContainer=q;this.startOffset=x;if(!this.endContainer){this.endContainer=q;this.endOffset=x}n(this)},setEnd:function(q,x){if(q[0].nodeType==a.NodeType.ELEMENT_NODE&&p[q.nodeName()]){q=q.parent();x=q._4e_index()+1}this.endContainer=q;this.endOffset=x;if(!this.startContainer){this.startContainer=q;this.startOffset=x}n(this)},setStartAt:function(q,x){switch(x){case o.POSITION_AFTER_START:this.setStart(q,0);break;case o.POSITION_BEFORE_END:q[0].nodeType==a.NodeType.TEXT_NODE?
this.setStart(q,q[0].nodeValue.length):this.setStart(q,q[0].childNodes.length);break;case o.POSITION_BEFORE_START:this.setStartBefore(q);break;case o.POSITION_AFTER_END:this.setStartAfter(q)}n(this)},setEndAt:function(q,x){switch(x){case o.POSITION_AFTER_START:this.setEnd(q,0);break;case o.POSITION_BEFORE_END:q[0].nodeType==a.NodeType.TEXT_NODE?this.setEnd(q,q[0].nodeValue.length):this.setEnd(q,q[0].childNodes.length);break;case o.POSITION_BEFORE_START:this.setEndBefore(q);break;case o.POSITION_AFTER_END:this.setEndAfter(q)}n(this)},
cloneContents:function(){return e(this,2)},deleteContents:function(){return e(this,0)},extractContents:function(){return e(this,1)},collapse:function(q){if(q){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=l},clone:function(){var q=new j(this.document);q.startContainer=this.startContainer;q.startOffset=this.startOffset;q.endContainer=this.endContainer;q.endOffset=this.endOffset;q.collapsed=
this.collapsed;return q},getEnclosedNode:function(){var q=this.clone();q.optimize();if(q.startContainer[0].nodeType!=a.NodeType.ELEMENT_NODE||q.endContainer[0].nodeType!=a.NodeType.ELEMENT_NODE)return B;var x=new s(q);x.evaluator=function(C){return H(C)&&N(C)};q=x.next();x.reset();x=x.previous();return q&&q.equals(x)?q:B},shrink:function(q,x){if(!this.collapsed){q=q||o.SHRINK_TEXT;var C=this.clone(),F=this.startContainer,z=this.endContainer,D=this.startOffset,I=this.endOffset,O=l,T,S,R=l;if(F&&F[0].nodeType==
a.NodeType.TEXT_NODE)if(D)if(D>=F[0].nodeValue.length)C.setStartAfter(F);else{C.setStartBefore(F);O=y}else C.setStartBefore(F);if(z&&z[0].nodeType==a.NodeType.TEXT_NODE)if(I)if(I>=z[0].nodeValue.length)C.setEndAfter(z);else{C.setEndAfter(z);R=y}else C.setEndBefore(z);if(O||R){S=new s(C);S.evaluator=function(E){return E.nodeType==(q==o.SHRINK_ELEMENT?a.NodeType.ELEMENT_NODE:a.NodeType.TEXT_NODE)};S.guard=function(E,K){if(q==o.SHRINK_ELEMENT&&E.nodeType==a.NodeType.TEXT_NODE)return y;if(K&&E==T)return y;
if(!K&&E.nodeType==a.NodeType.ELEMENT_NODE)T=E;return l}}if(O)if(C=S[q==o.SHRINK_ELEMENT?"lastForward":"next"]())this.setStartAt(C,x?o.POSITION_AFTER_START:o.POSITION_BEFORE_START);if(R){S.reset();if(S=S[q==o.SHRINK_ELEMENT?"lastBackward":"previous"]())this.setEndAt(S,x?o.POSITION_BEFORE_END:o.POSITION_AFTER_END)}return O||R}},createBookmark2:function(q){var x=this.startContainer,C=this.endContainer,F=this.startOffset,z=this.endOffset,D,I;if(!x||!C)return{start:0,end:0};if(q){if(x[0].nodeType==a.NodeType.ELEMENT_NODE)if((D=
new m(x[0].childNodes[F]))&&D[0]&&D[0].nodeType==a.NodeType.TEXT_NODE&&F>0&&D[0].previousSibling.nodeType==a.NodeType.TEXT_NODE){x=D;F=0}for(;x[0].nodeType==a.NodeType.TEXT_NODE&&(I=x.prev(undefined,1))&&I[0].nodeType==a.NodeType.TEXT_NODE;){x=I;F+=I[0].nodeValue.length}if(!this.collapsed){if(C[0].nodeType==a.NodeType.ELEMENT_NODE)if((D=new m(C[0].childNodes[z]))&&D[0]&&D[0].nodeType==a.NodeType.TEXT_NODE&&z>0&&D[0].previousSibling.nodeType==a.NodeType.TEXT_NODE){C=D;z=0}for(;C[0].nodeType==a.NodeType.TEXT_NODE&&
(I=C.prev(undefined,1))&&I[0].nodeType==a.NodeType.TEXT_NODE;){C=I;z+=I[0].nodeValue.length}}}return{start:x._4e_address(q),end:this.collapsed?B:C._4e_address(q),startOffset:F,endOffset:z,normalized:q,is2:l}},createBookmark:function(q){var x,C,F,z,D=this.collapsed;x=new m("<span>",B,this.document);x.attr("_ke_bookmark",1);x.css("display","none");x.html("&nbsp;");if(q){F=i.guid("ke_bm_");x.attr("id",F+"S")}if(!D){C=x.clone();C.html("&nbsp;");q&&C.attr("id",F+"E");z=this.clone();z.collapse();z.insertNode(C)}z=
this.clone();z.collapse(l);z.insertNode(x);if(C){this.setStartAfter(x);this.setEndBefore(C)}else this.moveToPosition(x,o.POSITION_AFTER_END);return{startNode:q?F+"S":x,endNode:q?F+"E":C,serializable:q,collapsed:D}},moveToPosition:function(q,x){this.setStartAt(q,x);this.collapse(l)},trim:function(q,x){var C=this.startContainer,F=this.startOffset,z=this.collapsed;if((!q||z)&&C[0]&&C[0].nodeType==a.NodeType.TEXT_NODE){if(F)if(F>=C[0].nodeValue.length){F=C._4e_index()+1;C=C.parent()}else{var D=C._4e_splitText(F);
F=C._4e_index()+1;C=C.parent();if(a.equals(this.startContainer,this.endContainer))this.setEnd(D,this.endOffset-this.startOffset);else if(a.equals(C,this.endContainer))this.endOffset+=1}else{F=C._4e_index();C=C.parent()}this.setStart(C,F);if(z){this.collapse(l);return}}C=this.endContainer;F=this.endOffset;if(!(x||z)&&C[0]&&C[0].nodeType==a.NodeType.TEXT_NODE){if(F){F>=C[0].nodeValue.length||C._4e_splitText(F);F=C._4e_index()+1}else F=C._4e_index();C=C.parent();this.setEnd(C,F)}},insertNode:function(q){this.optimizeBookmark();
this.trim(y,l);var x=this.startContainer;x[0].insertBefore(q[0],x[0].childNodes[this.startOffset]||null);x[0]==this.endContainer[0]&&this.endOffset++;this.setStartBefore(q)},moveToBookmark:function(q){var x=h(this.document);if(q.is2){var C=x._4e_getByAddress(q.start,q.normalized),F=q.startOffset;x=q.end&&x._4e_getByAddress(q.end,q.normalized);q=q.endOffset;this.setStart(C,F);x?this.setEnd(x,q):this.collapse(l)}else{C=(F=q.serializable)?i.one("#"+q.startNode,x):q.startNode;q=F?i.one("#"+q.endNode,
x):q.endNode;this.setStartBefore(C);C._4e_remove();if(q&&q[0]){this.setEndBefore(q);q._4e_remove()}else this.collapse(l)}},getCommonAncestor:function(q,x){var C=this.startContainer,F=this.endContainer;C=C[0]==F[0]?q&&C[0].nodeType==a.NodeType.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new m(C[0].childNodes[this.startOffset]):C:C._4e_commonAncestor(F);return x&&C[0].nodeType==a.NodeType.TEXT_NODE?C.parent():C},enlarge:function(){function q(x,C,F,z){var D=x[C?"startContainer":"endContainer"],
I,O=C?0:1,T=0,S=C?"previousSibling":"nextSibling";I=x[C?"startOffset":"endOffset"];if(D[0].nodeType==a.NodeType.TEXT_NODE){if(C){if(I)return}else if(I<D[0].nodeValue.length)return;I=D[0][S];D=D[0].parentNode}else{I=D[0].childNodes[I+(C?-1:1)]||null;D=D[0]}for(;D;){for(;I;)if(w(I)||A(I))I=I[S];else break;if(I){T||x[C?"setStartAfter":"setEndBefore"](h(I));break}D=h(D);if(D.nodeName()=="body")break;if(T||D.equals(z)){F[O]=D;T=1}else x[C?"setStartBefore":"setEndAfter"](D);I=D[0][S];D=D[0].parentNode}}
return function(x){switch(x){case o.ENLARGE_ELEMENT:if(this.collapsed)break;x=this.getCommonAncestor();var C=[];q(this,1,C,x);q(this,0,C,x);if(C[0]&&C[1]){x=C[0].contains(C[1])?C[1]:C[0];this.setStartBefore(x);this.setEndAfter(x)}break;case o.ENLARGE_BLOCK_CONTENTS:case o.ENLARGE_LIST_ITEM_CONTENTS:var F=new j(this.document);C=new m(this.document.body);F.setStartAt(C,o.POSITION_AFTER_START);F.setEnd(this.startContainer,this.startOffset);F=new s(F);var z,D,I=s.blockBoundary(x==o.ENLARGE_LIST_ITEM_CONTENTS?
{br:1}:B),O=function(S){var R=I(S);R||(z=h(S));return R},T=function(S){var R=O(S);if(!R&&a.nodeName(S)=="br")D=h(S);return R};F.guard=O;F=F.lastBackward();z=z||C;this.setStartAt(z,z.nodeName()!="br"&&(!F&&this.checkStartOfBlock()||F&&z.contains(F))?o.POSITION_AFTER_START:o.POSITION_AFTER_END);F=this.clone();F.collapse();F.setEndAt(C,o.POSITION_BEFORE_END);F=new s(F);F.guard=x==o.ENLARGE_LIST_ITEM_CONTENTS?T:O;z=B;F=F.lastForward();z=z||C;this.setEndAt(z,!F&&this.checkEndOfBlock()||F&&z.contains(F)?
o.POSITION_BEFORE_END:o.POSITION_BEFORE_START);D&&this.setEndAfter(D)}}}(),checkStartOfBlock:function(){var q=this.startContainer,x=this.startOffset;if(x&&q[0].nodeType==a.NodeType.TEXT_NODE)if(i.trim(q[0].nodeValue.substring(0,x)).length)return y;this.trim();q=new k(this.startContainer);x=this.clone();x.collapse(l);x.setStartAt(q.block||q.blockLimit,o.POSITION_AFTER_START);q=new s(x);q.evaluator=f(l);return q.checkBackward()},checkEndOfBlock:function(){var q=this.endContainer,x=this.endOffset;if(q[0].nodeType==
a.NodeType.TEXT_NODE)if(i.trim(q[0].nodeValue.substring(x)).length)return y;this.trim();q=new k(this.endContainer);x=this.clone();x.collapse(y);x.setEndAt(q.block||q.blockLimit,o.POSITION_BEFORE_END);q=new s(x);q.evaluator=f(y);return q.checkForward()},checkBoundaryOfElement:function(q,x){var C=this.clone();C[x==o.START?"setStartAt":"setEndAt"](q,x==o.START?o.POSITION_AFTER_START:o.POSITION_BEFORE_END);C=new s(C);C.evaluator=g;return C[x==o.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var q=
this.startContainer,x=this.endContainer,C=this.startOffset,F=this.endOffset,z;if(q[0].nodeType==a.NodeType.ELEMENT_NODE){z=q[0].childNodes.length;if(z>C)q=h(q[0].childNodes[C]);else if(z==0)q=q._4e_previousSourceNode();else{for(q=q[0];q.lastChild;)q=q.lastChild;q=h(q);q=q._4e_nextSourceNode()||q}}if(x[0].nodeType==a.NodeType.ELEMENT_NODE){z=x[0].childNodes.length;if(z>F)x=h(x[0].childNodes[F])._4e_previousSourceNode(l);else if(z==0)x=x._4e_previousSourceNode();else{for(x=x[0];x.lastChild;)x=x.lastChild;
x=h(x)}}if(q._4e_position(x)&b.POSITION_FOLLOWING)q=x;return{startNode:q,endNode:x}},fixBlock:function(q,x){var C=this.createBookmark(),F=h(this.document.createElement(x));this.collapse(q);this.enlarge(o.ENLARGE_BLOCK_CONTENTS);F[0].appendChild(this.extractContents());F._4e_trim();t.ie||F._4e_appendBogus();this.insertNode(F);this.moveToBookmark(C);return F},splitBlock:function(q){var x=new k(this.startContainer),C=new k(this.endContainer),F=x.block,z=C.block,D=B;if(!x.blockLimit.equals(C.blockLimit))return B;
if(q!="br"){if(!F){F=this.fixBlock(l,q);z=(new k(this.endContainer)).block}z||(z=this.fixBlock(y,q))}q=F&&this.checkStartOfBlock();x=z&&this.checkEndOfBlock();this.deleteContents();if(F&&F[0]==z[0])if(x){D=new k(this.startContainer);this.moveToPosition(z,o.POSITION_AFTER_END);z=B}else if(q){D=new k(this.startContainer);this.moveToPosition(F,o.POSITION_BEFORE_START);F=B}else{z=this.splitElement(F);!t.ie&&!i.inArray(F.nodeName(),["ul","ol"])&&F._4e_appendBogus()}return{previousBlock:F,nextBlock:z,wasStartOfBlock:q,
wasEndOfBlock:x,elementPath:D}},splitElement:function(q){if(!this.collapsed)return B;this.setEndAt(q,o.POSITION_BEFORE_END);var x=this.extractContents(),C=q.clone(y);C[0].appendChild(x);C.insertAfter(q);this.moveToPosition(q,o.POSITION_AFTER_END);return C},moveToElementEditablePosition:function(q,x){function C(z,D){var I;if(z[0].nodeType==a.NodeType.ELEMENT_NODE&&z._4e_isEditable())I=z[x?"last":"first"](c,1);if(!D&&!I)I=z[x?"prev":"next"](c,1);return I}for(var F=0;q;){if(q[0].nodeType==a.NodeType.TEXT_NODE){this.moveToPosition(q,
x?o.POSITION_AFTER_END:o.POSITION_BEFORE_START);F=1;break}if(q[0].nodeType==a.NodeType.ELEMENT_NODE&&q._4e_isEditable()){this.moveToPosition(q,x?o.POSITION_BEFORE_END:o.POSITION_AFTER_START);F=1}q=C(q,F)}return!!F},selectNodeContents:function(q){var x=q[0];this.setStart(q,0);this.setEnd(q,x.nodeType==a.NodeType.TEXT_NODE?x.nodeValue.length:x.childNodes.length)},insertNodeByDtd:function(q){var x,C,F,z=q.nodeName();x=d.$block[z];this.deleteContents();if(x){for(x=this.getCommonAncestor(y,l);(C=d[x.nodeName()])&&
!(C&&C[z]);){var D=x.parent();if(this.checkStartOfBlock()&&this.checkEndOfBlock()){this.setStartBefore(x);this.collapse(l);x.remove()}else F=x;x=D}F&&this.splitElement(F)}this.insertNode(q)}});v.injectDom({_4e_breakParent:function(q,x){x=h(x);q=h(q);var C,F=new u.Range(q[0].ownerDocument);F.setStartAfter(q);F.setEndAfter(x);C=F.extractContents();F.insertNode(q.remove());q.after(C)}});return u.Range=j},{requires:["./base","./utils","./walker","./elementPath","./dom","node"]});
KISSY.add("editor/core/selection",function(i,u){function v(d){this.document=d;this._={cache:{}};if(l)try{var m=this.getNative().createRange();if(!m||m.item&&m.item(0).ownerDocument!=d||m.parentElement&&m.parentElement().ownerDocument!=d)this.isInvalid=k}catch(h){this.isInvalid=k}}function s(d){d=new v(d);return!d||d.isInvalid?g:d}u.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var k=true,g=null,c=i.UA,f=i.DOM,e=i.Node,n=u.SELECTION,j=u.RANGE,l=c.ie,y=u.Walker,B=u.Range,o={img:1,
hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};i.augment(v,{getNative:!l?function(){var d=this._.cache;return d.nativeSel||(d.nativeSel=f.getWindow(this.document).getSelection())}:function(){var d=this._.cache;return d.nativeSel||(d.nativeSel=this.document.selection)},getType:!l?function(){var d=this._.cache;if(d.type)return d.type;var m=n.SELECTION_TEXT,h=this.getNative();if(h){if(h.rangeCount==1){h=h.getRangeAt(0);
var r=h.startContainer;if(r==h.endContainer&&r.nodeType==f.NodeType.ELEMENT_NODE&&Number(h.endOffset-h.startOffset)==1&&o[r.childNodes[h.startOffset].nodeName.toLowerCase()])m=n.SELECTION_ELEMENT}}else m=n.SELECTION_NONE;return d.type=m}:function(){var d=this._.cache;if(d.type)return d.type;var m=n.SELECTION_NONE;try{var h=this.getNative(),r=h.type;if(r=="Text")m=n.SELECTION_TEXT;if(r=="Control")m=n.SELECTION_ELEMENT;if(h.createRange().parentElement)m=n.SELECTION_TEXT}catch(p){}return d.type=m},getRanges:l?
function(){var d=function(m,h){m=m.duplicate();m.collapse(h);for(var r=m.parentElement(),p=r.childNodes,w,A=0;A<p.length;A++){var H=p[A];if(H.nodeType==f.NodeType.ELEMENT_NODE){w=m.duplicate();w.moveToElementText(H);H=w.compareEndPoints("StartToStart",m);var N=w.compareEndPoints("EndToStart",m);w.collapse();if(H>0)break;else if(!H||N==1&&H==-1)return{container:r,offset:A};else if(!N)return{container:r,offset:A+1};w=g}}if(!w){w=m.duplicate();w.moveToElementText(r);w.collapse(false)}w.setEndPoint("StartToStart",
m);w=String(w.text).replace(/\r\n|\r/g,"\n").length;try{for(;w>0;)w-=p[--A].nodeValue.length}catch(Q){w=0}return w===0?{container:r,offset:A}:{container:p[A],offset:-w}};return function(m){var h=this._.cache;if(h.ranges&&!m)return h.ranges;var r=this.getNative();m=r&&r.createRange();var p=this.getType();if(!r)return[];if(p==n.SELECTION_TEXT){r=new B(this.document);p=d(m,k);r.setStart(new e(p.container),p.offset);p=d(m);r.setEnd(new e(p.container),p.offset);return h.ranges=[r]}else if(p==n.SELECTION_ELEMENT){h=
h.ranges=[];for(p=0;p<m.length;p++){var w=m.item(p),A=w.parentNode,H=0;for(r=new B(this.document);H<A.childNodes.length&&A.childNodes[H]!=w;H++);r.setStart(new e(A),H);r.setEnd(new e(A),H+1);h.push(r)}return h}return h.ranges=[]}}():function(d){var m=this._.cache;if(m.ranges&&!d)return m.ranges;d=[];var h=this.getNative();if(!h)return[];for(var r=0;r<h.rangeCount;r++){var p=h.getRangeAt(r),w=new B(this.document);w.setStart(new e(p.startContainer),p.startOffset);w.setEnd(new e(p.endContainer),p.endOffset);
d.push(w)}return m.ranges=d},getStartElement:function(){var d=this._.cache;if(d.startElement!==undefined)return d.startElement;var m,h=this.getNative();switch(this.getType()){case n.SELECTION_ELEMENT:return this.getSelectedElement();case n.SELECTION_TEXT:var r=this.getRanges()[0];if(r)if(!r.collapsed){for(r.optimize();k;){m=r.startContainer;if(r.startOffset==(m[0].nodeType===f.NodeType.ELEMENT_NODE?m[0].childNodes.length:m[0].nodeValue.length)&&!m._4e_isBlockBoundary())r.setStartAfter(m);else break}m=
r.startContainer;if(m[0].nodeType!=f.NodeType.ELEMENT_NODE)return m.parent();m=new e(m[0].childNodes[r.startOffset]);if(!m[0]||m[0].nodeType!=f.NodeType.ELEMENT_NODE)return r.startContainer;for(r=m[0].firstChild;r&&r.nodeType==f.NodeType.ELEMENT_NODE;){m=new e(r);r=r.firstChild}return m}if(l){r=h.createRange();r.collapse(k);m=new e(r.parentElement())}else{if((m=h.anchorNode)&&m.nodeType!=f.NodeType.ELEMENT_NODE)m=m.parentNode;if(m)m=new e(m)}}return d.startElement=m},getSelectedElement:function(){var d=
this,m,h=d._.cache;if(h.selectedElement!==undefined)return h.selectedElement;if(l){m=d.getNative().createRange();m=m.item&&m.item(0)}m=m?new e(m):function(){for(var r=d.getRanges()[0],p,w,A=2;A&&!((p=r.getEnclosedNode())&&p[0].nodeType==f.NodeType.ELEMENT_NODE&&o[p.nodeName()]&&(w=p));A--)r.shrink(j.SHRINK_ELEMENT);return w}();return h.selectedElement=m},reset:function(){this._.cache={}},selectElement:function(d){var m,h=this.document;if(l)try{m=h.body.createControlRange();m.addElement(d[0]);m.select()}catch(r){m=
h.body.createTextRange();m.moveToElementText(d[0]);m.select()}finally{}else{m=h.createRange();m.selectNode(d[0]);d=this.getNative();d.removeAllRanges();d.addRange(m)}this.reset()},selectRanges:function(d){if(l){if(d.length>1){var m=d[d.length-1];d[0].setEnd(m.endContainer,m.endOffset);d.length=1}d[0]&&d[0].select()}else{m=this.getNative();if(!m)return;m.removeAllRanges();for(var h=0;h<d.length;h++){var r=d[h],p=this.document.createRange(),w=r.startContainer;if(r.collapsed&&(c.gecko&&c.gecko<1.09||
c.opera||c.webkit)&&w[0].nodeType==f.NodeType.ELEMENT_NODE&&!w[0].childNodes.length){w[0].appendChild(this.document.createTextNode(c.webkit?"\u200b":""));r.startOffset++;r.endOffset++}p.setStart(w[0],r.startOffset);p.setEnd(r.endContainer[0],r.endOffset);m.addRange(p)}}this.reset()},createBookmarks2:function(d){for(var m=[],h=this.getRanges(),r=0;r<h.length;r++)m.push(h[r].createBookmark2(d));return m},createBookmarks:function(d,m){var h=[],r=this.document,p;m=m||this.getRanges();for(var w=m.length,A=
0;A<w;A++){h.push(p=m[A].createBookmark(d,k));var H=(d=p.serializable)?i.one("#"+p.startNode,r):p.startNode;p=d?i.one("#"+p.endNode,r):p.endNode;for(var N=A+1;N<w;N++){var Q=m[N],q=Q.startContainer,x=Q.endContainer;f.equals(q,H.parent())&&Q.startOffset++;f.equals(q,p.parent())&&Q.startOffset++;f.equals(x,H.parent())&&Q.endOffset++;f.equals(x,p.parent())&&Q.endOffset++}}return h},selectBookmarks:function(d){for(var m=[],h=0;h<d.length;h++){var r=new B(this.document);r.moveToBookmark(d[h]);m.push(r)}this.selectRanges(m);
return this},getCommonAncestor:function(){var d=this.getRanges();return d[0].startContainer._4e_commonAncestor(d[d.length-1].endContainer)},scrollIntoView:function(){var d=this.getStartElement();d&&d.scrollIntoView(undefined,{alignWithTop:false,allowHorizontalScroll:true,onlyScrollIfNeeded:true})},removeAllRanges:function(){var d=this.getNative();if(l)d&&d.clear();else d&&d.removeAllRanges()}});var b={table:1,tbody:1,tr:1},a=y.whitespaces(k),t=/\ufeff|\u00a0/;B.prototype.select=B.prototype.select=
!l?function(){var d=this.startContainer;if(this.collapsed&&d[0].nodeType==f.NodeType.ELEMENT_NODE&&!d[0].childNodes.length){d[0].appendChild(this.document.createTextNode(c.webkit?"\u200b":""));this.startOffset++;this.endOffset++}var m=this.document.createRange();m.setStart(d[0],this.startOffset);try{m.setEnd(this.endContainer[0],this.endOffset)}catch(h){if(h.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){this.collapse(k);m.setEnd(this.endContainer[0],this.endOffset)}else throw h;}d=s(this.document).getNative();
d.removeAllRanges();d.addRange(m)}:function(d){var m=this.collapsed,h,r;if(this.startContainer[0]===this.endContainer[0]&&this.endOffset-this.startOffset==1){var p=this.startContainer[0].childNodes[this.startOffset];if(p.nodeType==f.NodeType.ELEMENT_NODE){(new v(this.document)).selectElement(new e(p));return}}if(this.startContainer[0].nodeType==f.NodeType.ELEMENT_NODE&&this.startContainer.nodeName()in b||this.endContainer[0].nodeType==f.NodeType.ELEMENT_NODE&&this.endContainer.nodeName()in b)this.shrink(j.SHRINK_ELEMENT,
k);var w=this.createBookmark();p=w.startNode;var A;if(!m)A=w.endNode;w=this.document.body.createTextRange();w.moveToElementText(p[0]);w.moveStart("character",1);if(A){d=this.document.body.createTextRange();d.moveToElementText(A[0]);w.setEndPoint("EndToEnd",d);w.moveEnd("character",-1)}else{for(h=p[0].nextSibling;h&&!a(h);)h=h.nextSibling;h=!(h&&h.nodeValue&&h.nodeValue.match(t))&&(d||!p[0].previousSibling||p[0].previousSibling&&f.nodeName(p[0].previousSibling)=="br");r=new e(this.document.createElement("span"));
r.html("&#65279;");r.insertBefore(p);if(h)f.insertBefore(this.document.createTextNode("\ufeff"),p[0]||p)}this.setStartBefore(p);p._4e_remove();if(m){if(h){w.moveStart("character",-1);w.select();this.document.selection.clear()}else w.select();if(r){this.moveToPosition(r,j.POSITION_BEFORE_START);r._4e_remove()}}else{this.setEndBefore(A);A._4e_remove();w.select()}};v.getSelection=s;return u.Selection=v},{requires:["./base","./walker","./range","./dom","node"]});
KISSY.add("editor/core/selectionFix",function(i,u){function v(o){function b(p,w){var A=h.body.createTextRange();try{A.moveToPoint(p,w)}catch(H){A=e}return A}function a(){var p=h.selection.createRange();r&&!p.item&&p.compareEndPoints("StartToEnd",p)===0&&r.select();j.remove(h,"mouseup",a);j.remove(h,"mousemove",t);r=d=0}function t(p){if(p.button){if(p=b(p.pageX,p.pageY)){p.compareEndPoints("StartToStart",r)>0?p.setEndPoint("StartToStart",r):p.setEndPoint("EndToEnd",r);p.select()}}else a()}var d,m=
o.get("window")[0],h=o.get("document")[0],r;j.on(h,"mousedown contextmenu",function(p){var w=h.documentElement;if(p.target===w){d&&a();if(!(w.scrollHeight>w.clientHeight)){d=1;if(r=b(p.pageX,p.pageY)){j.on(h,"mouseup",a);j.on(h,"mousemove",t);m.focus();r.select()}}}})}function s(o){function b(p){if(h){var w=o.getSelection(),A=w&&w.getType(),H=w&&a.selection;if(p&&H&&A==B.SELECTION_NONE)if(!a.queryCommandEnabled("InsertImage")){setTimeout(function(){b(c)},50);return}var N;if(!(H&&H.type&&H.type!="Control"&&
(N=H.createRange())&&(N=N.parentElement())&&(N=N.nodeName)&&N.toLowerCase()in{input:1,textarea:1})){m=H&&w.getRanges()[0];o.checkSelectionChange()}}}var a=o.get("document")[0],t=new y(a.body),d=new y(a.documentElement);u.Utils.ieEngine<8&&d.on("click",function(p){(new y(p.target)).nodeName()==="html"&&o.getSelection().getNative().createRange().select()});var m,h,r=c;d.on("mousedown",function(){r=f});d.on("mouseup",function(){r=c});t.on("focusin",function(p){if((new y(p.target)).nodeName()=="body")if(m){try{r&&
m.select()}catch(w){}m=e}});t.on("focus",function(){h=c;b()});t.on("beforedeactivate",function(p){if(!p.relatedTarget){h=f;r=c}});t.on("mousedown",function(){h=f});t.on("mouseup",function(){h=c;setTimeout(function(){b(c)},0)});t.on("keydown",function(){h=f});t.on("keyup",function(){h=c;setTimeout(function(){b()},0)})}function k(o){var b=o.get("document")[0];j.on(b,"mouseup keyup selectionchange",function(){o.checkSelectionChange()})}function g(o){function b(r){var p=u.XHTML_DTD;return r._4e_isBlockBoundary()&&
p.$empty[r.nodeName()]}function a(r){return d(r)&&m(r)}var t=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,d=u.Walker.whitespaces(c),m=u.Walker.bookmark(f,c),h=function(r){return d(r)&&r.nodeType!=8};o.on("selectionChange",function(r){var p=r.path,w=new y(o.get("document")[0].body);r=(r=r.selection)&&r.getRanges()[0];var A=p.blockLimit;if(n.gecko){var H=p.block||p.blockLimit,N=H&&H.last(a);H&&H._4e_isBlockBoundary()&&
!(N&&N[0].nodeType==1&&N._4e_isBlockBoundary())&&H.nodeName()!="pre"&&!H._4e_getBogus()&&H._4e_appendBogus()}if(!(!r||!r.collapsed||p.block)){if(A.nodeName()=="body"){if((p=r.fixBlock(c,"p"))&&p[0]!=w[0].lastChild)if(p.outerHtml().match(t))if((A=p.next(h,1))&&A[0].nodeType==l.NodeType.ELEMENT_NODE&&!b[A]){r.moveToElementEditablePosition(A);p._4e_remove()}else if((A=p.prev(h,1))&&A[0].nodeType==l.NodeType.ELEMENT_NODE&&!b[A]){r.moveToElementEditablePosition(A,A.outerHtml().match(t)?f:c);p._4e_remove()}r.select();
o.notifySelectionChange()}p=o.get("document")[0];r=new u.Range(p);r.moveToElementEditablePosition(w,c);if((new u.ElementPath(r.startContainer)).blockLimit.nodeName()!=="body"){w=(new y(p.createElement("p"))).appendTo(w);n.ie||w._4e_appendBogus()}}})}var c=true,f=false,e=null,n=i.UA,j=i.Event,l=i.DOM,y=i.Node,B=u.SELECTION;return{init:function(o){o.docReady(function(){if(n.ie){v(o);s(o)}else k(o)});g(o)}}},{requires:["./base","./selection","node"]});
KISSY.add("editor/core/styles",function(i,u){function v(E){return!H.attr(E,"_ke_bookmark")}function s(E,K){for(var G in E)if(typeof E[G]=="string")E[G]=E[G].replace(R,function(J,L){return K[L]});else s(E[G],K)}function k(E,K){if(K){E=i.clone(E);s(E,K)}var G=this.element=this.element=(E.element||"*").toLowerCase();this.type=this.type=G=="#text"||I[G]?N.STYLE_BLOCK:T[G]?N.STYLE_OBJECT:N.STYLE_INLINE;this._={definition:E}}function g(E,K){var G=K?this.removeFromRange:this.applyToRange;E.body.focus();
for(var J=new q(E),L=J.getRanges(),M=0;M<L.length;M++)G.call(this,L[M]);J.selectRanges(L)}function c(E,K,G){var J=E.element;if(J=="*")J="span";K=new F(K.createElement(J));G&&G._4e_copyAttributes(K);G=E._.definition;E=G.attributes;G=k.getStyleText(G);if(E)for(var L in E)K.attr(L,E[L]);if(G)K[0].style.cssText=G;return K}function f(E){var K=E.createBookmark(r),G=E.createIterator();G.enforceRealBlocks=r;G.enlargeBr=r;for(var J,L=E.document;J=G.getNextParagraph();){var M=c(this,L,J);J=J;var P=M;M=P.nodeName==
"pre";var U=J.nodeName=="pre",V=!M&&U;if(M&&!U){U=J;P=P;V=U.html();V=e(V,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");V=V.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");V=V.replace(/([ \t\n\r]+|&nbsp;)/g," ");V=V.replace(/<br\b[^>]*>/gi,"\n");if(z.ie){U=U[0].ownerDocument.createElement("div");U.appendChild(P[0]);P.outerHtml("<pre>"+V+"</pre>");P=new F(U.firstChild);P._4e_remove()}else P.html(V);P=P}else if(V)P=j(n(J),P);else J._4e_moveChildren(P);J[0].parentNode.replaceChild(P[0],J[0]);if(M){J=P;M=void 0;
if((M=J._4e_previousSourceNode(r,H.NodeType.ELEMENT_NODE))&&M.nodeName()=="pre"){P=e(M.html(),/\n$/,"")+"\n\n"+e(J.html(),/^\n/,"");z.ie?J.outerHtml("<pre>"+P+"</pre>"):J.html(P);M._4e_remove()}}}E.moveToBookmark(K)}function e(E,K,G){var J="",L="";E=E.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(M,P,U){P&&(J=P);U&&(L=U);return""});return J+E.replace(K,G)+L}function n(E){var K=[];e(E.outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,
function(G,J,L){return J+"</pre>"+L+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(G,J){K.push(J)});return K}function j(E,K){for(var G=K[0].ownerDocument.createDocumentFragment(),J=0;J<E.length;J++){var L=E[J];L=L.replace(/(\r\n|\r)/g,"\n");L=e(L,/^[ \t]*\n/,"");L=e(L,/\n$/,"");L=e(L,/^[ \t]+|[ \t]+$/g,function(P,U){return P.length==1?"&nbsp;":U?" "+Array(P.length).join("&nbsp;"):Array(P.length).join("&nbsp;")+" "});L=L.replace(/\n/g,"<br>");L=L.replace(/[ \t]{2,}/g,function(P){return Array(P.length).join("&nbsp;")+
" "});var M=K.clone();M.html(L);G.appendChild(M[0])}return G}function l(E){var K=E.document;if(E.collapsed){K=c(this,K,undefined);E.insertNode(K);E.moveToPosition(K,Q.POSITION_BEFORE_END)}else{var G=this.element,J=this._.definition,L,M=O[G];if(!M){L=r;M=O.span}var P=E.createBookmark();E.enlarge(Q.ENLARGE_ELEMENT);E.trim();var U=E.createBookmark(),V=U.startNode;U=U.endNode;for(var Y=V,$;Y&&Y[0];){var W=p;if(H.equals(Y,U)){Y=w;W=r}else{var X=Y[0].nodeType,aa=X==H.NodeType.ELEMENT_NODE?Y.nodeName():
w;if(aa&&Y.attr("_ke_bookmark")){Y=Y._4e_nextSourceNode(r);continue}if(!aa||M[aa]&&(Y._4e_position(U)|x.POSITION_PRECEDING|x.POSITION_IDENTICAL|x.POSITION_IS_CONTAINED)==x.POSITION_PRECEDING+x.POSITION_IDENTICAL+x.POSITION_IS_CONTAINED&&(!J.childRule||J.childRule(Y))){var Z=Y.parent();if(Z&&G=="a"&&Z.nodeName()==G){X=c(this,K,undefined);Z._4e_moveChildren(X);Z[0].parentNode.replaceChild(X[0],Z[0]);X._4e_mergeSiblings()}else if(Z&&Z[0]&&((O[Z.nodeName()]||O.span)[G]||L)&&(!J.parentRule||J.parentRule(Z))){if(!$&&
(!aa||!O.$removeEmpty[aa]||(Y._4e_position(U)|x.POSITION_PRECEDING|x.POSITION_IDENTICAL|x.POSITION_IS_CONTAINED)==x.POSITION_PRECEDING+x.POSITION_IDENTICAL+x.POSITION_IS_CONTAINED)){$=new C(K);$.setStartBefore(Y)}if(X==H.NodeType.TEXT_NODE||X==H.NodeType.ELEMENT_NODE&&!Y[0].childNodes.length){Z=Y;for(X=null;(W=!Z.next(v,1))&&(X=Z.parent())&&M[X.nodeName()]&&(X._4e_position(V)|x.POSITION_FOLLOWING|x.POSITION_IDENTICAL|x.POSITION_IS_CONTAINED)==x.POSITION_FOLLOWING+x.POSITION_IDENTICAL+x.POSITION_IS_CONTAINED&&
(!J.childRule||J.childRule(X));)Z=X;$.setEndAfter(Z)}}else W=r}else W=r;Y=Y._4e_nextSourceNode()}if(W&&$&&!$.collapsed){W=c(this,K,undefined);Z=$.getCommonAncestor();X={styles:{},attrs:{},blockedStyles:{},blockedAttrs:{}};var ca;aa=null;for(var ba;W&&Z&&W[0]&&Z[0];){if(Z.nodeName()==G){for(ca in J.attributes)if(!(X.blockedAttrs[ca]||!(ba=Z.attr(aa))))if(W.attr(ca)==ba)W.removeAttr(ca);else X.blockedAttrs[ca]=1;for(aa in J.styles)if(!(X.blockedStyles[aa]||!(ba=Z.style(aa))))if(W.style(aa)==ba)W.style(aa,
"");else X.blockedStyles[aa]=1;if(!W._4e_hasAttributes()){W=w;break}}Z=Z.parent()}if(W){W[0].appendChild($.extractContents());d(this,W);$.insertNode(W);W._4e_mergeSiblings();z.ie||W[0].normalize()}else{W=new F(K.createElement("span"));W[0].appendChild($.extractContents());$.insertNode(W);d(this,W);W._4e_remove(true)}$=w}}V._4e_remove();U._4e_remove();E.moveToBookmark(P);E.shrink(Q.SHRINK_TEXT)}}function y(E){E.enlarge(Q.ENLARGE_ELEMENT);var K=E.createBookmark(),G=K.startNode;if(E.collapsed){for(var J=
new D(G.parent()),L,M=0,P;M<J.elements.length&&(P=J.elements[M]);M++){if(P==J.block||P==J.blockLimit)break;if(this.checkElementRemovable(P)){var U=E.checkBoundaryOfElement(P,Q.END),V=!U&&E.checkBoundaryOfElement(P,Q.START);if(V||U){L=P;L.match=V?"start":"end"}else{P._4e_mergeSiblings();if(P.nodeName()!=this.element){U=b(this);m(P,U[P.nodeName()]||U["*"])}else a(this,P)}}}if(L){P=G;for(M=0;;M++){U=J.elements[M];if(U.equals(L))break;else if(U.match)continue;else U=U.clone();U[0].appendChild(P[0]);P=
U}P[L.match=="start"?"insertBefore":"insertAfter"](L);J=L.html();if(!J||J=="\u200b")L.remove();else z.webkit&&A(E.document.createTextNode("\u200b")).insertBefore(P)}}else{var Y=K.endNode,$=this;L=function(){for(var W=new D(G.parent()),X=new D(Y.parent()),aa=w,Z=w,ca=0;ca<W.elements.length;ca++){var ba=W.elements[ca];if(ba==W.block||ba==W.blockLimit)break;if($.checkElementRemovable(ba))aa=ba}for(ca=0;ca<X.elements.length;ca++){ba=X.elements[ca];if(ba==X.block||ba==X.blockLimit)break;if($.checkElementRemovable(ba))Z=
ba}Z&&Y._4e_breakParent(Z);aa&&G._4e_breakParent(aa)};L();for(J=new F(G[0].nextSibling);J[0]!==Y[0];){M=J._4e_nextSourceNode();if(J[0]&&J[0].nodeType==H.NodeType.ELEMENT_NODE&&this.checkElementRemovable(J)){if(J.nodeName()==this.element)a(this,J);else{P=b(this);m(J,P[J.nodeName()]||P["*"])}if(M[0].nodeType==H.NodeType.ELEMENT_NODE&&M.contains(G)){L();M=new F(G[0].nextSibling)}}J=M}}E.moveToBookmark(K)}function B(E){E=String(E);var K={};E.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,
function(G,J,L){K[J]=L});return K}function o(E,K){var G="";if(K!==p){G=document.createElement("span");G.style.cssText=E;G=G.style.cssText||""}else G=E;return G.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function b(E){if(E._.overrides)return E._.overrides;var K=E._.overrides={},G=E._.definition.overrides;if(G){i.isArray(G)||(G=[G]);for(var J=0;J<G.length;J++){var L=G[J],M,P,U;if(typeof L=="string")M=L.toLowerCase();else{M=L.element?L.element.toLowerCase():
E.element;P=L.attributes;U=L.styles}L=K[M]||(K[M]={});if(P){M=L.attributes=L.attributes||[];for(var V in P)M.push([V.toLowerCase(),P[V]])}if(U){L=L.styles=L.styles||[];for(var Y in U)L.push([Y.toLowerCase(),U[Y]])}}}return K}function a(E,K){var G=E._.definition,J=b(E),L=i.merge(G.attributes,(J[K.nodeName()]||J["*"]||{}).attributes);G=i.merge(G.styles,(J[K.nodeName()]||J["*"]||{}).styles);J=i.isEmptyObject(L)&&i.isEmptyObject(G);for(var M in L)if(!((M=="class"||E._.definition.fullMatch)&&K.attr(M)!=
t(M,L[M]))){J=J||!!K.hasAttr(M);K.removeAttr(M)}for(var P in G)if(!(E._.definition.fullMatch&&K.style(P)!=t(P,G[P],r))){J=J||!!K.style(P);K.style(P,"")}h(K)}function t(E,K,G){var J=new F("<span>");J[G?"style":"attr"](E,K);return J[G?"style":"attr"](E)}function d(E,K){for(var G=b(E),J=K.all(E.element),L=J.length;--L>=0;)a(E,new F(J[L]));for(var M in G)if(M!=E.element){J=K.all(M);for(L=J.length-1;L>=0;L--){var P=new F(J[L]);m(P,G[M])}}}function m(E,K){var G,J=K&&K.attributes;if(J)for(G=0;G<J.length;G++){var L=
J[G][0],M;if(M=E.attr(L)){var P=J[G][1];if(P===w||P.test&&P.test(M)||typeof P=="string"&&M==P)E[0].removeAttribute(L)}}if(J=K&&K.styles)for(G=0;G<J.length;G++){L=J[G][0];if(P=E.css(L)){var U=J[G][1];if(U===w||U.test&&U.test(M)||typeof U=="string"&&P==U)E.css(L,"")}}h(E)}function h(E){if(!E._4e_hasAttributes()){var K=E[0].firstChild,G=E[0].lastChild;E._4e_remove(r);if(K){K.nodeType==H.NodeType.ELEMENT_NODE&&H._4e_mergeSiblings(K);G&&K!=G&&G.nodeType==H.NodeType.ELEMENT_NODE&&H._4e_mergeSiblings(G)}}}
var r=true,p=false,w=null,A=i.all,H=i.DOM,N={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},Q=u.RANGE,q=u.Selection,x=u.POSITION,C=u.Range,F=i.Node,z=i.UA,D=u.ElementPath,I={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},O=u.XHTML_DTD,T={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},S=/\s*(?:;\s*|$)/g,R=/#\((.+?)\)/g;u.STYLE=N;k.prototype={constructor:k,apply:function(E){g.call(this,E,p)},remove:function(E){g.call(this,E,r)},applyToRange:function(E){return(this.applyToRange=
this.type==N.STYLE_INLINE?l:this.type==N.STYLE_BLOCK?f:this.type==N.STYLE_OBJECT?w:w).call(this,E)},removeFromRange:function(E){return(this.removeFromRange=this.type==N.STYLE_INLINE?y:w).call(this,E)},checkElementRemovable:function(E,K){if(!E)return p;var G=this._.definition,J;if(E.nodeName()==this.element){if(!K&&!E._4e_hasAttributes())return r;var L=G._AC;if(L)G=L;else{L={};var M=0,P=G.attributes;if(P)for(var U in P){M++;L[U]=P[U]}if(P=k.getStyleText(G)){L.style||M++;L.style=P}L._length=M;G=G._AC=
L}if(G._length){for(var V in G)if(V!="_length"){M=E.attr(V)||"";if(V=="style")a:{L=G[V];M=o(M,p);typeof L=="string"&&(L=B(L));typeof M=="string"&&(M=B(M));P=void 0;for(P in L)if(!(P in M&&(M[P]==L[P]||L[P]=="inherit"||M[P]=="inherit"))){L=p;break a}L=r}else L=G[V]==M;if(L){if(!K)return r}else if(K)return p}if(K)return r}else return r}V=b(this);if(V=V[E.nodeName()]||V["*"]){if(!(G=V.attributes)&&!(J=V.styles))return r;if(G)for(L=0;L<G.length;L++){V=G[L][0];if(V=E.attr(V)){M=G[L][1];if(M===w||typeof M==
"string"&&V==M||M.test&&M.test(V))return r}}if(J)for(L=0;L<J.length;L++)if(V=E.css(J[L][0])){G=J[L][1];if(G===w||typeof G=="string"&&V==G||G.test&&G.test(V))return r}}return p},checkActive:function(E){switch(this.type){case N.STYLE_BLOCK:return this.checkElementRemovable(E.block||E.blockLimit,r);case N.STYLE_OBJECT:case N.STYLE_INLINE:for(var K=E.elements,G=0,J;G<K.length;G++){J=K[G];if(!(this.type==N.STYLE_INLINE&&(H.equals(J,E.block)||H.equals(J,E.blockLimit))))if(!(this.type==N.STYLE_OBJECT&&!(J.nodeName()in
T)))if(this.checkElementRemovable(J,r))return r}}return p}};k.getStyleText=function(E){var K=E._ST;if(K)return K;K=E.styles;var G=E.attributes&&E.attributes.style||"",J="";if(G.length)G=G.replace(S,";");for(var L in K){var M=K[L],P=(L+":"+M).replace(S,";");if(M=="inherit")J+=P;else G+=P}if(G.length)G=o(G);G+=J;return E._ST=G};return u.Style=k},{requires:["./base","./range","./selection","./domIterator","./elementPath","node"]});
KISSY.add("editor/core/utils",function(i,u){var v=i.Node,s=i.DOM,k=i.UA,g={debugUrl:function(c){var f=i.Config;f.debug||(c=c.replace(/\.(js|css)/i,"-min.$1"));if(c.indexOf("?t")==-1){c+=c.indexOf("?")!=-1?"&":"?";c+="t="+encodeURIComponent(f.tag)}return f.base+"editor/"+c},lazyRun:function(c,f,e){var n=c[f],j=c[e];c[f]=function(){n.apply(this,arguments);c[f]=c[e];return j.apply(this,arguments)}},getXY:function(c,f){var e=c.left,n=c.top,j=f.get("window")[0];e-=s.scrollLeft(j);n-=s.scrollTop(j);j=f.get("iframe").offset();
e+=j.left;n+=j.top;return{left:e,top:n}},tryThese:function(){for(var c,f=0,e=arguments.length;f<e;f++){var n=arguments[f];try{c=n();break}catch(j){}}return c},arrayCompare:function(c,f){if(!c&&!f)return true;if(!c||!f||c.length!=f.length)return false;for(var e=0;e<c.length;e++)if(c[e]!==f[e])return false;return true},clearAllMarkers:function(c){for(var f in c)c[f]._4e_clearMarkers(c,true,undefined)},ltrim:function(c){return c.replace(/^\s+/,"")},rtrim:function(c){return c.replace(/\s+$/,"")},isNumber:function(c){return/^\d+(.\d+)?$/.test(i.trim(c))},
verifyInputs:function(c){for(var f=0;f<c.length;f++){var e=new v(c[f]),n=i.trim(g.valInput(e)),j=e.attr("data-verify");e=e.attr("data-warning");if(j&&!RegExp(j).test(n)){alert(e);return false}}return true},sourceDisable:function(c,f){c.on("sourceMode",f.disable,f);c.on("wysiwygMode",f.enable,f)},resetInput:function(c){var f=c.attr("placeholder");if(f&&k.ie){c.addClass("ks-editor-input-tip");c.val(f)}else k.ie||c.val("")},valInput:function(c,f){if(f===undefined)return c.hasClass("ks-editor-input-tip")?
"":c.val();else{c.removeClass("ks-editor-input-tip");c.val(f)}},placeholder:function(c,f){c.attr("placeholder",f);if(k.ie){c.on("blur",function(){if(!i.trim(c.val())){c.addClass("ks-editor-input-tip");c.val(f)}});c.on("focus",function(){c.removeClass("ks-editor-input-tip");i.trim(c.val())==f&&c.val("")})}},htmlEncode:function(c){return!c?c:String(c).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},normParams:function(c){c=i.clone(c);for(var f in c){var e=c[f];
if(typeof e==="function")c[f]=e()}return c},map:function(c,f){for(var e=0;e<c.length;e++)c[e]=f(c[e]);return c},ieEngine:document.documentMode||k.ie,preventFocus:function(c){k.ie?c.unselectable():c.attr("onmousedown","return false;")},injectDom:function(c){i.mix(s,c);for(var f in c)(function(e){v.prototype[e]=function(){var n=[].slice.call(arguments,0);n.unshift(this[0]);if((n=c[e].apply(null,n))&&(n.nodeType||i.isWindow(n)))return new v(n);else{if(i.isArray(n))if(n.__IS_NODELIST||n[0]&&n[0].nodeType)return new v(n);
return n}}})(f)},addRes:function(){var c=this.__res=this.__res||[];c.push.apply(c,i.makeArray(arguments))},destroyRes:function(){for(var c=this.__res||[],f=0;f<c.length;f++){var e=c[f];if(typeof e==="function")e();else if(e.destroy)e.destroy();else e.remove&&e.remove()}this.__res=[]},getQueryCmd:function(c){return"query"+("-"+c).replace(/-(\w)/g,function(f,e){return e.toUpperCase()})+"Value"}};return u.Utils=g},{requires:["./base","node"]});
KISSY.add("editor/core/walker",function(i,u){function v(a,t){if(this._.end)return f;var d,m=this.range,h,r=this.guard,p=this.type,w=a?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;m.trim();if(m.collapsed){this.end();return f}}if(!a&&!this._.guardLTR){var A=m.endContainer[0],H=A.childNodes[m.endOffset];this._.guardLTR=function(x,C){if(C&&(A==x||n.nodeName(x)=="body"))return false;return x!=H}}if(a&&!this._.guardRTL){var N=m.startContainer[0],Q=m.startOffset>0&&N.childNodes[m.startOffset-
1]||null;this._.guardRTL=function(x,C){if(C&&(N==x||n.nodeName(x)=="body"))return false;return x!=Q}}var q=a?this._.guardRTL:this._.guardLTR;h=r?function(x,C){if(q(x,C)===c)return c;return r(x,C)}:q;if(this.current)d=this.current[w](c,p,h);else if(a){d=m.endContainer;if(m.endOffset>0){d=new l(d[0].childNodes[m.endOffset-1]);if(h(d[0])===c)d=f}else d=h(d,g)===c?f:d._4e_previousSourceNode(g,p,h,undefined)}else{d=m.startContainer;d=new l(d[0].childNodes[m.startOffset]);if(d.length){if(h(d[0])===c)d=
f}else d=h(m.startContainer,g)===c?f:m.startContainer._4e_nextSourceNode(g,p,h,undefined)}for(;d&&!this._.end;){this.current=d;if(!this.evaluator||this.evaluator(d[0])!==c){if(!t)return d}else if(t&&this.evaluator)return c;d=d[w](c,p,h)}this.end();return this.current=f}function s(a){for(var t,d=f;t=v.call(this,a);)d=t;return d}function k(a){this.range=a;this.guard=this.evaluator=f;this._={}}var g=true,c=false,f=null,e=i.UA,n=i.DOM,j=u.XHTML_DTD,l=i.Node;i.augment(k,{end:function(){this._.end=1},next:function(){return v.call(this)},
previous:function(){return v.call(this,g)},checkForward:function(){return v.call(this,c,g)!==c},checkBackward:function(){return v.call(this,g,g)!==c},lastForward:function(){return s.call(this)},lastBackward:function(){return s.call(this,g)},reset:function(){delete this.current;this._={}},_iterator:v});i.mix(k,{blockBoundary:function(a){return function(t){return!(t.nodeType==n.NodeType.ELEMENT_NODE&&n._4e_isBlockBoundary(t,a))}},bookmark:function(a,t){function d(m){return n.nodeName(m)=="span"&&n.attr(m,
"_ke_bookmark")}return function(m){var h,r;h=m.nodeType==n.NodeType.TEXT_NODE&&(r=m.parentNode)&&d(r);h=a?h:h||d(m);return!!(t^h)}},whitespaces:function(a){return function(t){t=t.nodeType==n.NodeType.TEXT_NODE&&!i.trim(t.nodeValue);return!!(a^t)}},invisible:function(a){var t=k.whitespaces();return function(d){d=t(d)||d.nodeType==n.NodeType.ELEMENT_NODE&&!d.offsetHeight;return!!(a^d)}}});var y=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,B=k.whitespaces(),o=k.bookmark(),b=function(a){var t=n.nodeName(a);return o(a)||
B(a)||a.nodeType==1&&t in j.$inline&&!(t in j.$empty)};u.Utils.injectDom({_4e_getBogus:function(a){a=new l(a);do a=a._4e_previousSourceNode();while(a&&b(a[0]));a=a&&(!e.ie?a.nodeName()=="br":a[0].nodeType==3&&y.test(a.text()))?a[0]:false;return a}});return u.Walker=k},{requires:["./base","./utils","./dom","node"]});
KISSY.add("editor/core/zIndexManager",function(i,u){var v=u.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};u.baseZIndex=function(s){return(u.Config.baseZIndex||1E4)+s};return v},{requires:["./base"]});
KISSY.add("editor/plugin/back-color/cmd",function(i,u){var v={element:"span",styles:{"background-color":"#(color)"},overrides:[{element:"*",styles:{"background-color":null}}],childRule:function(){return false}};return{init:function(s){s.hasCommand("backColor")||s.addCommand("backColor",{exec:function(k,g){k.execCommand("save");u.applyColor(k,g,v);k.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/back-color/index",function(i,u,v,s){function k(g){this.config=g||{}}i.augment(k,{pluginRenderUI:function(g){s.init(g);v.init(g,{defaultColor:"rgb(255, 217, 102)",cmdType:"backColor",tooltip:"\u80cc\u666f\u989c\u8272"})}});return k},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/bold/cmd",function(i,u,v){var s=new u.Style({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]});return{init:function(k){v.addButtonCmd(k,"bold",s)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/bold/index",function(i,u,v,s){function k(){}i.augment(k,{pluginRenderUI:function(g){s.init(g);g.addButton("bold",{cmdType:"bold",tooltip:"\u7c97\u4f53 "},v.Button);g.docReady(function(){g.get("document").on("keydown",function(c){if(c.ctrlKey&&c.keyCode==i.Node.KeyCodes.B){g.execCommand("bold");c.preventDefault()}})})}});return k},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/bubble/index",function(i,u,v){function s(f){var e=null,n=f.get("editor").getControls();i.each(n,function(j){var l;if(l=j.get){if(l=(j.get("elCls")||"").indexOf("bubble")!=-1){if(l=j!==f){if(l=j.get("visible")){l=f.get("y");var y=l+f.get("el").outerHeight(),B=j.get("y"),o=B+j.get("el").outerHeight();l=l<=o&&y>=o||l<=B&&y>=B}l=l}l=l}l=l}if(l)if(e){if(e.get("y")<j.get("y"))e=j}else e=j});return e}function k(f){var e=f.get("editorSelectedEl");if(!e)return g;var n=f.get("editor"),
j=n.get("window"),l=n.get("iframe").offset();f=l.top;l=l.left;var y=l+j.width();j=f+j.height();var B=e.offset();B=v.Utils.getXY(B,n);n=B.top;B=B.left;var o=B+e.width(),b=n+e.height(),a,t;if(i.UA.ie&&e[0].nodeName.toLowerCase()=="img"&&b>j)return g;if(b>j&&n<j)t=j-30;else if(b>f&&b<j)t=b;if(o>l&&B<l)a=l;else if(B>l&&B<y)a=B;if(a!==g&&t!==g)return[a,t];return g}var g={}.a,c={zIndex:v.baseZIndex(v.zIndexManager.BUBBLE_VIEW),elCls:"{prefixCls}editor-bubble",prefixCls:"{prefixCls}editor-",effect:{effect:"fade",
duration:0.3}};v.prototype.addBubble=function(f,e,n){function j(){a.hide();var d=o.get("window");if(d){d.detach("scroll",y);t.stop()}}function l(){var d=k(a);if(d){a.set("xy",d);var m=s(a);if(m){d[1]=m.get("y")+m.get("el").outerHeight();a.set("xy",d)}a.get("visible")?i.log("already show by selectionChange"):a.show()}}function y(){if(a.get("editorSelectedEl")){a.get("el");a.hide();t()}}function B(){o.get("window").on("scroll",y);l()}var o=this,b=o.get("prefixCls"),a;n=n||{};n.editor=o;i.mix(n,c);n.elCls=
i.substitute(n.elCls,{prefixCls:b});n.prefixCls=i.substitute(n.prefixCls,{prefixCls:b});a=new u(n);o.addControl(f+"/bubble",a);o.on("selectionChange",function(d){d=d.path;var m=d.elements;if(d&&m)if(d=d.lastElement)if(d=e(d)){a.set("editorSelectedEl",d);a.hide();i.later(B,10)}else j()});o.on("sourceMode",j);var t=i.buffer(l,350)}},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/button/index",function(i,u,v){u.prototype.addButton=function(s,k,g){if(g===undefined)g=v;var c=this.get("prefixCls")+"editor-toolbar-";if(k.elCls)k.elCls=c+k.elCls;k.elCls=c+"button "+(k.elCls||"");var f=(new g(i.mix({render:this.get("toolBarEl"),content:'<span class="'+c+"item "+c+s+'"></span>',prefixCls:this.get("prefixCls")+"editor-",editor:this},k))).render();f.get("el").unselectable();if(!k.content){var e=f.get("el").one("span");f.on("afterContentClsChange",function(n){e[0].className=
c+"item "+c+n.newVal})}if(f.get("mode")==u.WYSIWYG_MODE){this.on("wysiwygMode",function(){f.set("disabled",false)});this.on("sourceMode",function(){f.set("disabled",true)})}this.addControl(s+"/button",f);return f};return v},{requires:["editor","button"]});
KISSY.add("editor/plugin/checkbox-source-area/index",function(i,u){function v(f){this.editor=f;this._init()}function s(){}var k=i.Node,g=u.SOURCE_MODE,c=u.WYSIWYG_MODE;i.augment(v,{_init:function(){var f=this.editor,e=f.get("statusBarEl");this.holder=(new k("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(e);(this.el=this.holder.one("input")).on("click",
this._check,this);f.on("wysiwygMode",this._wysiwygmode,this);f.on("sourceMode",this._sourcemode,this)},_sourcemode:function(){this.el.attr("checked",true)},_wysiwygmode:function(){this.el.attr("checked",false)},_check:function(){var f=this.editor;this.el.attr("checked")?f.set("mode",g):f.set("mode",c)},destroy:function(){this.holder.remove()}});i.augment(s,{pluginRenderUI:function(f){var e=new v(f);f.on("destroy",function(){e.destroy()})}});return s},{requires:["editor"]});
KISSY.add("editor/plugin/code/index",function(i,u,v){function s(){}i.augment(s,{pluginRenderUI:function(k){k.addButton("code",{tooltip:"\u63d2\u5165\u4ee3\u7801",listeners:{click:function(){v.useDialog(k,"code")}},mode:u.WYSIWYG_MODE})}});return s},{requires:["editor","../dialog-loader/"]});
KISSY.add("editor/plugin/color/btn",function(i,u,v,s,k){function g(j,l,y){setTimeout(function(){j.execCommand(l,y)},0)}var c=i.Node,f=[["000","444","666","999","CCC","EEE","F3F3F3","FFF"],["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6",
"674EA7","A64D79","990000","B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04","7F6000","274E13","0C343D","073763","20124D","4C1130"]],e;(function(){e="<div class='{prefixCls}editor-color-panel'><a class='{prefixCls}editor-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";for(var j=0;j<3;j++){e+="<div class='{prefixCls}editor-color-palette'><table>";for(var l=f[j],y=l.length/8,B=0;B<y;B++){e+="<tr>";for(var o=0;o<8;o++){var b="#"+l[8*B+o];e+="<td>";e+="<a href='javascript:void(0);' class='{prefixCls}editor-color-a' style='background-color:"+
b+"'></a>";e+="</td>"}e+="</tr>"}e+="</table></div>"}e+="<div><a class='{prefixCls}editor-button {prefixCls}editor-color-others ks-inline-block'>\u5176\u4ed6\u989c\u8272</a></div></div>"})();var n=v.extend({initializer:function(){var j=this;j.on("blur",function(){setTimeout(function(){j.colorWin&&j.colorWin.hide()},150)});j.on("click",function(){if(j.get("checked"))j._prepare();else j.colorWin&&j.colorWin.hide()})},_prepare:function(){var j=this,l=j.get("editor"),y=l.get("prefixCls"),B;j.colorWin=(new s({elAttrs:{tabindex:0},
elCls:y+"editor-popup",content:i.substitute(e,{prefixCls:y}),width:172,zIndex:u.baseZIndex(u.zIndexManager.POPUP_MENU)})).render();var o=j.colorWin;B=o.get("contentEl");B.on("click",j._selectColor,j);o.on("hide",function(){j.set("checked",false)});B.one("."+y+"editor-color-others").on("click",function(b){b.halt();o.hide();k.useDialog(l,"color/color-picker",undefined,j)});j._prepare=j._show;j._show()},_show:function(){var j=this.get("el"),l=this.colorWin;l.set("align",{node:j,points:["bl","tl"],offset:[0,
2],overflow:{adjustX:1,adjustY:1}});l.show()},_selectColor:function(j){j.halt();var l=this.get("editor").get("prefixCls");j=new c(j.target);if(j.hasClass(l+"editor-color-a"))this.fire("selectColor",{color:j.style("background-color")});else j.hasClass(l+"editor-color-remove")&&this.fire("selectColor",{color:null})},destructor:function(){this.colorWin&&this.colorWin.destroy()}},{ATTRS:{checkable:{value:true},mode:{value:u.WYSIWYG_MODE}}});n.init=function(j,l){var y=j.get("prefixCls")+"editor-toolbar-",
B=l.cmdType,o=l.defaultColor,b=l.tooltip,a=j.addButton(B,{elCls:B+"Btn",content:i.substitute('<div class="{icon}"></div><div style="background-color:{defaultColor}" class="{indicator}"></div>',{defaultColor:o,icon:y+"item "+y+B,indicator:y+"color-indicator"}),mode:u.WYSIWYG_MODE,tooltip:"\u8bbe\u7f6e"+b});b=j.addButton(B+"Arrow",{tooltip:"\u9009\u62e9\u5e76\u8bbe\u7f6e"+b,elCls:B+"ArrowBtn"},n);var t=a.get("el").one("."+y+"color-indicator");b.on("selectColor",function(d){t.css("background-color",d.color||o);g(j,B,d.color)});a.on("click",
function(){g(j,B,t.style("background-color"))})};return n},{requires:["editor","../button/","../overlay/","../dialog-loader/"]});KISSY.add("editor/plugin/color/cmd",function(i,u){return{applyColor:function(v,s,k){var g=v.get("document")[0];v.execCommand("save");s?(new u.Style(k,{color:s})).apply(g):(new u.Style(k,{color:"inherit"})).remove(g);v.execCommand("save")}}},{requires:["editor"]});
KISSY.add("editor/plugin/contextmenu/index",function(i,u,v,s){u.prototype.addContextMenu=function(k,g,c){var f=this;c=c||{};c.prefixCls=f.get("prefixCls")+"editor-";c.editor=f;c.focusable=1;c.zIndex=u.baseZIndex(u.zIndexManager.POPUP_MENU);var e=new v.PopupMenu(c);s.init(e);e.on("afterRenderUI",function(){e.get("el").on("keydown",function(n){n.keyCode==i.Event.KeyCodes.ESC&&e.hide()})});f.docReady(function(){var n=f.get("document");n.on("mousedown",function(j){j.which==1&&e.hide()});n.delegate("contextmenu",
g,function(j){var l=i.all(j.target);j.halt();var y=j.pageX,B=j.pageY;if(y){j=u.Utils.getXY({left:y,top:B},f);y=j.left;B=j.top;setTimeout(function(){e.set("editorSelectedEl",l,{silent:1});e.set("xy",[y,B]);e.show();f.fire("contextmenu",{contextmenu:e});window.focus();document.body.focus();e.get("el")[0].focus()},30)}})});f.addControl(k+"/contextmenu",e);return e}},{requires:["editor","menu","../focus-fix/"]});
KISSY.add("editor/plugin/dent-utils/cmd",function(i,u,v){function s(a){return a.nodeType==e.NodeType.ELEMENT_NODE&&e.nodeName(a)=="li"}function k(a,t,d){for(var m=a.startContainer,h=a.endContainer;m&&!m.parent().equals(t);)m=m.parent();for(;h&&!h.parent().equals(t);)h=h.parent();if(m&&h){var r=m;m=[];for(var p=false;!p;){if(r.equals(h))p=true;m.push(r);r=r.next()}if(!(m.length<1)){var w=t._4e_parents(true,undefined);w.each(function(x,C){w[C]=x});for(h=0;h<w.length;h++)if(c[w[h].nodeName()]){t=w[h];
break}r=d=="indent"?1:-1;h=m[0];p=m[m.length-1];m={};var A=v.listToArray(t,m),H=A[p.data("listarray_index")].indent;for(h=h.data("listarray_index");h<=p.data("listarray_index");h++){A[h].indent+=r;var N=A[h].parent;A[h].parent=new n(N[0].ownerDocument.createElement(N.nodeName()))}for(h=p.data("listarray_index")+1;h<A.length&&A[h].indent>H;h++)A[h].indent+=r;p=v.arrayToList(A,m,null,"p");r=[];if(d=="outdent"){var Q;if((Q=t.parent())&&Q.nodeName()=="li"){d=p.listNode.childNodes;var q;for(h=d.length-
1;h>=0;h--)if((q=new n(d[h]))&&q.nodeName()=="li")r.push(q)}}if(p){e.insertBefore(p.listNode[0]||p.listNode,t[0]||t);t.remove()}if(r&&r.length)for(h=0;h<r.length;h++){for(q=t=r[h];(q=q.next())&&q.nodeName()in c;){j.ie&&!t.first(function(x){return l(x)&&b(x)},1)&&t[0].appendChild(a.document.createTextNode("\u00a0"));t[0].appendChild(q[0])}e.insertAfter(t[0],Q[0])}u.Utils.clearAllMarkers(m)}}}function g(a,t){var d=parseInt(a.style(y),10);if(isNaN(d))d=0;d+=(t=="indent"?1:-1)*B;if(d<0)return false;d=Math.max(d,
0);d=Math.ceil(d/B)*B;a.css(y,d?d+o:"");a[0].style.cssText===""&&a.removeAttr("style");return true}var c={ol:1,ul:1},f=u.Walker,e=i.DOM,n=i.Node,j=i.UA,l=f.whitespaces(true),y="margin-left",B=40,o="px",b=f.bookmark(false,true);return{checkOutdentActive:function(a){var t=a.blockLimit;if(a.contains(c))return true;else return(a=a.block||t)&&a.style(y)},addCommand:function(a,t){a.hasCommand(t)||a.addCommand(t,{exec:function(d){d.execCommand("save");var m=d.getSelection(),h=m&&m.getRanges()[0];if(h){for(var r=
h.startContainer,p=h.endContainer,w=h.getCommonAncestor();w&&!(w[0].nodeType==e.NodeType.ELEMENT_NODE&&c[w.nodeName()]);)w=w.parent();if(w&&r[0].nodeType==e.NodeType.ELEMENT_NODE&&r.nodeName()in c){r=new f(h);r.evaluator=s;h.startContainer=r.next()}if(w&&p[0].nodeType==e.NodeType.ELEMENT_NODE&&p.nodeName()in c){r=new f(h);r.evaluator=s;h.endContainer=r.previous()}p=m.createBookmarks(true);if(w){for(r=w.first();r&&r.nodeName()!="li";)r=r.next();var A=h.startContainer;(r[0]==A[0]||r.contains(A))&&g(w,
t)||k(h,w,t)}else{h=h.createIterator();h.enforceRealBlocks=true;for(h.enlargeBr=true;w=h.getNextParagraph();)g(w,t)}m.selectBookmarks(p)}d.execCommand("save");d.notifySelectionChange()}})}}},{requires:["editor","../list-utils/"]});
KISSY.add("editor/plugin/dialog-loader/index",function(i,u,v){var s,k={loading:function(g){s||(s=new u({x:0,width:i.UA.ie==6?i.DOM.docWidth():"100%",y:0,zIndex:v.baseZIndex(v.zIndexManager.LOADING),prefixCls:g+"editor-",elCls:g+"editor-global-loading"}));s.set("height",i.DOM.docHeight());s.show();s.loading()},unloading:function(){s.hide()}};return{useDialog:function(g,c,f,e){g.focus();var n=g.get("prefixCls");if(g.getControl(c+"/dialog"))setTimeout(function(){g.showDialog(c,e)},0);else{k.loading(n);
i.use("editor/plugin/"+c+"/dialog",function(j,l){k.unloading();g.addControl(c+"/dialog",new l(g,f));g.showDialog(c,e)})}}}},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/draft/index",function(i,u,v,s,k){function g(b,a,t){for(b+="";b.length<a;)b=t+b;return b}function c(b){if(i.isNumber(b))b=new Date(b);return b instanceof Date?[b.getFullYear(),"-",g(b.getMonth()+1,2,"0"),"-",g(b.getDate(),2,"0")," ",g(b.getHours(),2,"0"),":",g(b.getMinutes(),2,"0"),":",g(b.getSeconds(),2,"0")].join(""):b}function f(b,a){this.editor=b;this.config=a;this._init()}function e(b,a){var t=new f(b,a);b.on("destroy",function(){t.destroy()})}function n(b){this.config=
b||{}}var j=i.Node,l=i.Event,y=i.JSON,B=u.Utils.addRes,o=u.Utils.destroyRes;i.augment(f,{_getSaveKey:function(){var b=this.config;return b.draft&&b.draft.saveKey||"ks-editor-draft-save20110503"},_getDrafts:function(){if(!this.drafts){var b=v.getItem(this._getSaveKey()),a=[];if(b)a=v==window.localStorage?y.parse(i.urlDecode(b)):b;this.drafts=a}return this.drafts},_init:function(){var b=this,a=b.editor,t=a.get("prefixCls"),d=a.get("statusBarEl"),m=this.config;m.draft=m.draft||{};b.draftInterval=m.draft.interval=
m.draft.interval||5;b.draftLimit=m.draft.limit=m.draft.limit||5;d=(new j("<div class='"+t+"editor-draft'><span class='"+t+"editor-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+m.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(d);b.timeTip=(new j("<span class='"+t+"editor-draft-time'/>")).appendTo(d);var h=(new j(i.substitute("<a href='#' onclick='return false;' class='{prefixCls}editor-button {prefixCls}editor-draft-save-btn ks-inline-block' style='vertical-align:middle;padding:1px 9px;'><span class='{prefixCls}editor-draft-save'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>",
{prefixCls:t}))).unselectable(undefined).appendTo(d),r=(new k({render:d,collapseOnClick:true,width:"100px",prefixCls:t+"editor-",menu:{width:"225px",align:{points:["tr","br"]}},matchElWidth:false,content:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"})).render();b.versions=r;r.on("beforeCollapsedChange",function(A){if(!A.newValue){r.detach("beforeCollapsedChange",arguments.callee);b.sync()}});h.on("click",function(A){b.save(false);A.halt()});B.call(b,h);a.get("textarea")[0].form&&function(){function A(){b.save(true)}var H=a.get("textarea")[0].form;
l.on(H,"submit",A);B.call(b,function(){l.remove(H,"submit",A)})}();var p=setInterval(function(){b.save(true)},b.draftInterval*60*1E3);B.call(b,function(){clearInterval(p)});r.on("click",b.recover,b);B.call(b,r);b.holder=d;if(m.draft.helpHtml){var w=(new j('<a tabindex="0" hidefocus="hidefocus" class="'+t+'editor-draft-help" title="\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9" href="javascript:void(\'\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9 \')">\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9</a>')).unselectable(undefined).appendTo(d);w.on("click",function(){w[0].focus();b.helpPopup&&b.helpPopup.get("visible")?
b.helpPopup.hide():b._prepareHelp()});w.on("blur",function(){b.helpPopup&&b.helpPopup.hide()});b.helpBtn=w;B.call(b,w);u.Utils.lazyRun(b,"_prepareHelp","_realHelp")}B.call(b,d)},_prepareHelp:function(){var b=this.editor.get("prefixCls"),a=new j(this.config.draft.helpHtml||""),t=new j("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
a.append(t);a.css({border:"1px solid #ACB4BE","text-align":"left"});this.helpPopup=(new s({content:a,prefixCls:b+"editor-",width:a.width()+"px",zIndex:u.baseZIndex(u.zIndexManager.OVERLAY),mask:false})).render();this.helpPopup.get("el").css("border","none");this.helpPopup.arrow=t},_realHelp:function(){var b=this.helpPopup,a=this.helpBtn,t=b.arrow;b.show();a=a.offset();b.get("el").offset({left:a.left-b.get("el").width()+17,top:a.top-b.get("el").height()-7});t.offset({left:a.left-2,top:a.top-8})},disable:function(){this.holder.css("visibility",
"hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var b;b=this.draftLimit;var a=this.timeTip,t=this.versions,d=this._getDrafts(),m;d.length>b&&d.splice(0,d.length-b);t.removeItems(true);for(b=0;b<d.length;b++){m=d[b];m=(m.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+c(m.date);t.addItem({xclass:"menuitem",content:m,value:b})}a.html(m);v.setItem(this._getSaveKey(),v==window.localStorage?encodeURIComponent(y.stringify(d)):d)},save:function(b){var a=this._getDrafts(),t=this.editor.get("formatData");
if(t){if(a[a.length-1]&&t==a[a.length-1].content)a.length-=1;this.drafts=a.concat({content:t,date:(new Date).getTime(),auto:b});this.sync()}},recover:function(b){var a=this.editor,t=this._getDrafts(),d=b.target.get("value");if(confirm("\u786e\u8ba4\u6062\u590d "+c(t[d].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")){a.execCommand("save");a.set("data",t[d].content);a.execCommand("save")}b.halt()},destroy:function(){o.call(this)}});i.augment(n,{pluginRenderUI:function(b){var a=this.config;v.ready?v.ready(function(){e(b,a)}):e(b,a)}});return n},{requires:["editor",
"../local-storage/","overlay","../menubutton/"]});
KISSY.add("editor/plugin/drag-upload/index",function(i,u){function v(f){this.config=f||{}}var s=i.Node,k=i.Event,g=u.Utils,c=i.DOM;i.augment(v,{pluginRenderUI:function(f){function e(d){d=d.originalEvent.target;if(c.nodeName(d)=="img"&&d.src.match(/^file:\/\//))a[d.src]=d}function n(d,m){var h=new window.FileReader;h.onload=function(r){var p=d.name;r=r.target.result;var w=new XMLHttpRequest;w.open("POST",o,true);w.onreadystatechange=function(){if(w.readyState==4){if(w.status==200||w.status==304){if(w.responseText!=
""){var N=window.JSON.parse(w.responseText);m[0].src=N.imgUrl}}else{alert("\u670d\u52a1\u5668\u7aef\u51fa\u9519\uff01");m.remove();i.log(w)}w.onreadystatechange=null}};var A="\r\n------kissy-editor-yiminghe\r\n";A+='Content-Disposition: form-data; name="'+l+'"; filename="'+encodeURIComponent(p)+'"\r\n';A+="Content-Type: "+(d.type||"application/octet-stream")+"\r\n\r\n";A+=r+"\r\n";B=u.Utils.normParams(B);for(var H in B){A+="------kissy-editor-yiminghe\r\n";A+='Content-Disposition: form-data; name="'+H+'"\r\n\r\n';A+=B[H]+"\r\n"}A+=
"------kissy-editor-yiminghe--";w.setRequestHeader("Content-Type","multipart/form-data, boundary=----kissy-editor-yiminghe");w.sendAsBinary("Content-Type: multipart/form-data; boundary=----kissy-editor-yiminghe\r\nContent-Length: "+A.length+"\r\n"+A+"\r\n");h.onload=null};h.readAsBinaryString(d)}var j=this.config,l=j.fileInput||"Filedata",y=j.sizeLimit||Number.MAX_VALUE,B=j.serverParams||{},o=j.serverUrl||"",b=RegExp((j.suffix||"png,jpg,jpeg,gif").split(/,/).join("|")+"$","i"),a={},t=false;f.docReady(function(){var d=
f.get("document")[0];k.on(d,"dragenter",function(){if(!t){k.on(d,"DOMNodeInserted",e);t=true}});k.on(d,"drop",function(m){k.remove(d,"DOMNodeInserted",e);t=false;m.halt();m=m.originalEvent;var h,r;if(i.isEmptyObject(a)){r=d.elementFromPoint(m.clientX,m.clientY);h=r.lastChild}else{i.each(a,function(Q){if(c.nodeName(Q)=="img"){h=Q.nextSibling;r=Q.parentNode;c.remove(Q)}});a={}}m=m.dataTransfer;m.dropEffect="copy";if(m=m.files)for(var p=0;p<m.length;p++){var w=m[p],A=w.size;if(w.name.match(b))if(!(A/
1E3>y)){A=new s("<img src='"+g.debugUrl("theme/tao-loading.gif")+"'/>");var H=A[0];r.insertBefore(H,h);var N=c.nodeName(H.parentNode);if(N=="head"||N=="html")c.insertBefore(H,d.body.firstChild);n(w,A)}}})});if(window.XMLHttpRequest&&!XMLHttpRequest.prototype.sendAsBinary)XMLHttpRequest.prototype.sendAsBinary=function(d,m){for(var h=new (window.BlobBuilder||window.WebKitBlobBuilder),r=d.length,p=new window.Uint8Array(r),w=0;w<r;w++)p[w]=d.charCodeAt(w);h.append(p.buffer);this.send(h.getBlob(m))}}});
return v},{requires:["editor"]});
KISSY.add("editor/plugin/element-path/index",function(i,u){function v(g){this.cfg=g;this._cache=[];this._init()}function s(){}var k=i.Node;i.augment(v,{_init:function(){var g=this.cfg.editor;this.holder=new k("<span>");this.holder.appendTo(g.get("statusBarEl"),undefined);g.on("selectionChange",this._selectionChange,this);u.Utils.sourceDisable(g,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(g){var c=this.cfg.editor,
f=c.get("prefixCls"),e=this.holder;g=g.path.elements;var n,j;n=this._cache;for(j=0;j<n.length;j++)n[j].remove();this._cache=[];for(j=0;j<g.length;j++){n=g[j];var l=n.attr("_ke_real_element_type")||n.nodeName(),y=new k("<a href='javascript(\""+l+"\")' class='"+f+"editor-element-path'>"+l+"</a>");this._cache.push(y);(function(B){y.on("click",function(o){o.halt();c.focus();setTimeout(function(){c.getSelection().selectElement(B)},50)})})(n);e.prepend(y)}},destroy:function(){this.holder.remove()}});i.augment(s,
{pluginRenderUI:function(g){var c=new v({editor:g});g.on("destroy",function(){c.destroy()})}});return s},{requires:["editor"]});
KISSY.add("editor/plugin/fake-objects/index",function(i,u){var v=i.Node,s=i.DOM,k=u.Utils.debugUrl("theme/spacer.gif"),g=i.require("htmlparser");i.augment(u,{createFakeElement:function(f,e,n,j,l,y){var B=f.attr("style")||"";if(f.attr("width"))B="width:"+f.attr("width")+"px;"+B;if(f.attr("height"))B="height:"+f.attr("height")+"px;"+B;var o=i.trim(f.attr("class"));f={"class":e+" "+o,src:k,_ke_realelement:encodeURIComponent(l||f._4e_outerHtml(undefined)),_ke_real_node_type:f[0].nodeType,style:B};if(y){delete y.width;
delete y.height;i.mix(f,y,false)}if(n)f._ke_real_element_type=n;if(j)f._ke_resizable=j;return new v("<img/>",f,this.get("document")[0])},restoreRealElement:function(f){if(f.attr("_ke_real_node_type")!=s.NodeType.ELEMENT_NODE)return null;f=i.urlDecode(f.attr("_ke_realelement"));var e=new v("<div>",null,this.get("document")[0]);e.html(f);return e.first().remove()}});var c={tags:{$:function(f){var e=f.getAttribute("_ke_realelement"),n;if(e)n=(new g.Parser(i.urlDecode(e))).parse();if(e=n&&n.childNodes[0]){if(n=
f.getAttribute("style")){var j=/(?:^|\s)width\s*:\s*(\d+)/i.exec(n);f=j&&j[1];n=(j=/(?:^|\s)height\s*:\s*(\d+)/i.exec(n))&&j[1];f&&e.setAttribute("width",f);n&&e.setAttribute("height",n)}return e}}}};return{init:function(f){var e=f.htmlDataProcessor,n=e&&e.htmlFilter;if(!e.createFakeParserElement){n&&n.addRules(c);i.mix(e,{restoreRealElement:function(j){if(j.attr("_ke_real_node_type")!=s.NodeType.ELEMENT_NODE)return null;j=i.urlDecode(j.attr("_ke_realelement"));var l=new v("<div>",null,f.get("document")[0]);
l.html(j);return l.first().remove()},createFakeParserElement:function(j,l,y,B,o){var b=g.serialize(j),a=j.getAttribute("style")||"";if(j.getAttribute("width"))a="width:"+j.getAttribute("width")+"px;"+a;if(j.getAttribute("height"))a="height:"+j.getAttribute("height")+"px;"+a;var t=i.trim(j.getAttribute("class"));j={"class":l+" "+t,src:k,_ke_realelement:encodeURIComponent(b),_ke_real_node_type:j.nodeType+"",style:a,align:j.getAttribute("align")||""};if(o){delete o.width;delete o.height;i.mix(j,o,false)}if(y)j._ke_real_element_type=
y;if(B)j._ke_resizable="_ke_resizable";return new g.Tag("img",j)}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/flash-bridge/index",function(i,u,v){function s(g){this._init(g)}var k={};i.augment(s,i.EventTarget,{_init:function(g){var c=i.guid("flashbridge-");g.id=c;g.attrs=g.attrs||{};g.params=g.params||{};var f=g.attrs,e=g.params,n=e.flashVars=e.flashVars||{};i.mix(f,{width:1,height:1},false);i.mix(e,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},false);i.mix(n,{shareData:false,useCompression:false},false);f={YUISwfId:c,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};
if(g.ajbridge)f={swfID:c,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"};i.mix(n,f);k[c]=this;this.id=c;this.swf=new u(g);this._expose(g.methods)},_expose:function(g){for(var c=this,f=0;f<g.length;f++)(function(e){c[e]=function(){return c._callSWF(e,i.makeArray(arguments))}})(g[f])},_callSWF:function(g,c){return this.swf.callSWF(g,c)},_eventHandler:function(g){var c=g.type;if(c==="log")i.log(g.message);else c&&this.fire(c,g)},ready:function(g){this._ready?g.call(this):this.on("contentReady",g)},
destroy:function(){this.swf.destroy();delete k[this.id]}});s.EventHandler=function(g,c){i.log("flash fire event : "+c.type);var f=k[g];f&&setTimeout(function(){f._eventHandler.call(f,c)},100)};return v.FlashBridge=s},{requires:["swf","editor"]});
KISSY.add("editor/plugin/flash-common/baseClass",function(i,u,v,s,k,g){function c(){c.superclass.constructor.apply(this,arguments);this._init()}var f=i.Node;c.ATTRS={cls:{},type:{},label:{value:"\u5728\u65b0\u7a97\u53e3\u67e5\u770b"},bubbleId:{},contextMenuId:{},contextMenuHandlers:{}};i.extend(c,i.Base,{_init:function(){var e=this,n=e.get("cls"),j=e.get("editor"),l=j.get("prefixCls"),y=[],B=e.get("bubbleId"),o=e.get("contextMenuId"),b=e.get("contextMenuHandlers");i.each(b,function(a,t){y.push({content:t})});j.addContextMenu(o,
"."+n,{width:"120px",children:y,listeners:{click:function(a){a=a.target.get("content");b[a]&&b[a].call(this)}}});j.addBubble(B,function(a){return a.hasClass(n,undefined)&&a},{listeners:{afterRenderUI:function(){var a=this,t=a.get("contentEl");t.html(i.substitute(' <a class="{prefixCls}editor-bubble-url" target="_blank" href="#">{label}</a>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change">\u7f16\u8f91</span>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove">\u5220\u9664</span>',
{label:e.get("label"),prefixCls:l}));var d=t.one("."+l+"editor-bubble-url"),m=t.one("."+l+"editor-bubble-change"),h=t.one("."+l+"editor-bubble-remove");u.Utils.preventFocus(t);m.on("click",function(r){e.show(a.get("editorSelectedEl"));r.halt()});h.on("click",function(r){if(i.UA.webkit){var p=j.getSelection().getRanges();if(p=p&&p[0]){p.collapse(true);p.select()}}a.get("editorSelectedEl").remove();a.hide();j.notifySelectionChange();r.halt()});a.on("show",function(){var r=a.get("editorSelectedEl");
r&&e._updateTip(d,r)})}}});j.docReady(function(){j.get("document").on("dblclick",e._dbClick,e)})},_getFlashUrl:function(e){return g.getUrl(e)},_updateTip:function(e,n){var j=this.get("editor").restoreRealElement(n);if(j){j=this._getFlashUrl(j);e.attr("href",j)}},_dbClick:function(e){var n=new f(e.target);if(n.nodeName()==="img"&&n.hasClass(this.get("cls"),undefined)){this.show(n);e.halt()}},show:function(e){var n=this.get("editor");k.useDialog(n,this.get("type"),this.get("pluginConfig"),e)}});return c},
{requires:["editor","../contextmenu/","../bubble/","../dialog-loader/","./utils"]});
KISSY.add("editor/plugin/flash-common/utils",function(i,u){var v=i.DOM,s={insertFlash:function(k,g,c,f,e){g=s.createSWF({src:g,attrs:c,document:k.get("document")[0]});c=k.createFakeElement(g.el,f||"ke_flash",e||"flash",true,g.html,c);k.insertElement(c);return c},isFlashEmbed:function(k){return v.attr(k,"type")=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(v.attr(k,"src")||"")},getUrl:function(k){return u.getSrc(k)},createSWF:function(k){var g=v.create('<div style="position:absolute;left:-9999px;top:-9999px;"></div>',
undefined,k.document);k.htmlMode="full";v.append(g,k.document.body);k.render=g;k=new u(k);v.remove(g);return{el:i.all(k.get("el")),html:k.get("html")}}};return s},{requires:["swf"]});
KISSY.add("editor/plugin/flash/index",function(i,u,v,s,k){function g(c){this.config=c||{}}i.augment(g,{pluginRenderUI:function(c){k.init(c);var f=c.htmlDataProcessor;f.dataFilter.addRules({tags:{object:function(n){var j;if(!n.getAttribute("classid")){var l=n.childNodes;for(j=0;j<l.length;j++)if(l[j].nodeName=="embed")if(s.isFlashEmbed(l[j][j]))break;else return f.createFakeParserElement(n,"ke_flash","flash",true);return null}return f.createFakeParserElement(n,"ke_flash","flash",true)},embed:function(n){return s.isFlashEmbed(n)?
f.createFakeParserElement(n,"ke_flash","flash",true):null}}},5);var e=new v({editor:c,cls:"ke_flash",type:"flash",pluginConfig:this.config,bubbleId:"flash",contextMenuId:"flash",contextMenuHandlers:{"Flash\u5c5e\u6027":function(){var n=this.get("editorSelectedEl");n&&e.show(n)}}});this.flashControl=e;c.addButton("flash",{tooltip:"\u63d2\u5165Flash",listeners:{click:function(){e.show()}},mode:u.WYSIWYG_MODE})}});return g},{requires:["editor","../flash-common/baseClass","../flash-common/utils","../fake-objects/"]});
KISSY.add("editor/plugin/focus-fix/index",function(i,u){function v(){var c=this._focusEditor=g.currentInstance();if(k.ie&&c){window.focus();document.body.focus();var f=c.get("document")[0].selection,e;try{e=f.createRange()}catch(n){e=0}if(e)if(e.item&&e.item(0).ownerDocument==c.get("document")[0]){c=document.body.createTextRange();c.moveToElementText(this.get("el").first()[0]);c.collapse(true);c.select()}}}function s(){var c=this._focusEditor;c&&c.focus()}var k=i.UA,g=u.focusManager;return{init:function(c){c.on("beforeVisibleChange",
function(f){f.newVal&&v.call(c)});c.on("hide",function(){s.call(c)})}}},{requires:["editor"]});KISSY.add("editor/plugin/font-family/cmd",function(i,u,v){var s={element:"span",styles:{"font-family":"#(value)"},overrides:[{element:"font",attributes:{face:null}}]};return{init:function(k){v.addSelectCmd(k,"fontFamily",s)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/font-family/index",function(i,u,v,s){function k(g){this.config=g||{}}i.augment(k,{pluginRenderUI:function(g){s.init(g);var c=this.config,f={};i.mix(f,{children:[{content:"\u5b8b\u4f53",value:"SimSun"},{content:"\u9ed1\u4f53",value:"SimHei"},{content:"\u96b6\u4e66",value:"LiSu"},{content:"\u6977\u4f53",value:"KaiTi_GB2312"},{content:"\u5fae\u8f6f\u96c5\u9ed1",value:"'Microsoft YaHei'"},{content:"Georgia",value:"Georgia"},{content:"Times New Roman",value:"'Times New Roman'"},{content:"Impact",value:"Impact"},{content:"Courier New",value:"'Courier New'"},
{content:"Arial",value:"Arial"},{content:"Verdana",value:"Verdana"},{content:"Tahoma",value:"Tahoma"}],width:"130px"});i.each(f.children,function(e){var n=e.elAttrs||{},j=e.value;n.style=n.style||"";n.style+=";font-family:"+j;e.elAttrs=n});c.menu=i.mix(f,c.menu);g.addSelect("fontFamily",i.mix({cmdType:"fontFamily",defaultCaption:"\u5b57\u4f53",width:130,mode:u.WYSIWYG_MODE},c),v.Select)}});return k},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/font-size/cmd",function(i,u,v){var s={element:"span",styles:{"font-size":"#(value)"},overrides:[{element:"font",attributes:{size:null}}]};return{init:function(k){v.addSelectCmd(k,"fontSize",s)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/font-size/index",function(i,u,v,s){function k(g){this.config=g||{}}i.augment(k,{pluginRenderUI:function(g){s.init(g);var c=this.config;c.menu=i.mix({children:function(f){var e=[];i.each(f,function(n){e.push({content:n,value:n})});return e}(["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px"])},c.menu);g.addSelect("fontSize",i.mix({cmdType:"fontSize",defaultCaption:"\u5927\u5c0f",width:"70px",mode:u.WYSIWYG_MODE},c),v.Select)}});return k},{requires:["editor",
"../font/ui","./cmd"]});
KISSY.add("editor/plugin/font/cmd",function(i,u){function v(k,g){var c=k.nodeName();if(g.element!=c)return false;var f=g.styles,e,n;for(n in f)if(e=k.style(n))return e;f=g.overrides;for(n=0;n<f.length;n++){e=f[n];if(e.element==c){var j=e.attributes,l;for(l in j)if(e=k.attr(l))return e}}return false}var s=u.Utils.getQueryCmd;return{addButtonCmd:function(k,g,c){var f=s(g);if(!k.hasCommand(g)){k.addCommand(g,{exec:function(e){var n=e.get("document")[0];e.execCommand("save");e.queryCommandValue(g)?c.remove(n):
c.apply(n);e.execCommand("save");e.notifySelectionChange()}});k.addCommand(f,{exec:function(e){if((e=e.getSelection())&&!e.isInvalid){e=e.getStartElement();e=new u.ElementPath(e);return c.checkActive(e)}}})}},addSelectCmd:function(k,g,c){var f=s(g);if(!k.hasCommand(g)){k.addCommand(g,{exec:function(e,n){e.focus();var j=e.queryCommandValue(g)||"",l=new u.Style(c,{value:n}),y=e.get("document")[0];e.execCommand("save");n.toLowerCase()==j.toLowerCase()?l.remove(y):l.apply(y);e.execCommand("save")}});
k.addCommand(f,{exec:function(e){if((e=e.getSelection())&&!e.isInvalid){e=e.getStartElement();e=new u.ElementPath(e);var n=e.elements,j,l,y;for(l=0;l<n.length;l++){j=n[l];if(!(e.block&&j[0]==e.block[0]||e.blockLimit&&j[0]==e.blockLimit[0])){y=v(j,c);if(y!==false)break}}return y}}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/font/ui",function(i,u,v,s){i=s.Select.extend({initializer:function(){var k=this,g=k.get("editor");k.on("click",function(c){c=c.target.get("value");var f=k.get("cmdType");g.execCommand(f,c)});g.on("selectionChange",function(){if(g.get("mode")!=u.SOURCE_MODE){var c=k.get("cmdType"),f=k.get("menu");if(f=f.get&&f.get("children")){c=g.queryCommandValue(c);if(c!==false){c=(c+"").toLowerCase();for(var e=0;e<f.length;e++){var n=f[e].get("value");if(c==n.toLowerCase()){k.set("value",
n);return}}}k.set("value",null)}}})}});return{Button:v.extend({initializer:function(){var k=this,g=k.get("editor"),c=k.get("cmdType");k.on("click",function(){k.get("checked")?g.execCommand(c):g.execCommand(c,false);g.focus()});g.on("selectionChange",function(){if(g.get("mode")!=u.SOURCE_MODE){var f=k.get("cmdType");g.queryCommandValue(f)?k.set("checked",true):k.set("checked",false)}})}},{ATTRS:{checkable:{value:true},mode:{value:u.WYSIWYG_MODE}}}),Select:i}},{requires:["editor","../button/","../menubutton/"]});
KISSY.add("editor/plugin/fore-color/cmd",function(i,u){var v={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}],childRule:function(s){return!(s.nodeName()=="a"||s.all("a").length)}};return{init:function(s){s.hasCommand("foreColor")||s.addCommand("foreColor",{exec:function(k,g){k.execCommand("save");u.applyColor(k,g,v);k.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/fore-color/index",function(i,u,v,s){function k(g){this.config=g||{}}i.augment(k,{pluginRenderUI:function(g){s.init(g);v.init(g,{cmdType:"foreColor",defaultColor:"rgb(204, 0, 0)",tooltip:"\u6587\u672c\u989c\u8272"})}});return k},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/heading/cmd",function(i,u){return{init:function(v){if(!v.hasCommand("heading")){v.addCommand("heading",{exec:function(k,g){k.execCommand("save");if(g!="p")var c=k.queryCommandValue("heading");if(g==c)g="p";(new u.Style({element:g})).apply(k.get("document")[0]);k.execCommand("save")}});var s=u.Utils.getQueryCmd("heading");v.addCommand(s,{exec:function(k){if((k=k.getSelection())&&!k.isInvalid){k=k.getStartElement();k=new u.ElementPath(k);k=(k=k.block||k.blockLimit)&&k.nodeName()||
"";if(k.match(/^h\d$/)||k=="p")return k}}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/heading/index",function(i,u,v){function s(){}i.augment(s,{pluginRenderUI:function(k){v.init(k);var g=[],c={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},f={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},e;for(e in c)g.push({content:e,value:c[e],elAttrs:{style:"font-size:"+f[c[e]]}});k.addSelect("heading",{defaultCaption:"\u6807\u9898",width:"120px",menu:{children:g},mode:u.WYSIWYG_MODE,listeners:{click:function(n){n=n.target.get("value");
k.execCommand("heading",n)},afterSyncUI:function(){var n=this;k.on("selectionChange",function(){if(k.get("mode")!=u.SOURCE_MODE){var j=k.queryCommandValue("heading"),l;for(l in f)if(l==j){n.set("value",l);return}n.set("value",null)}})}}})}});return s},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/image/index",function(i,u,v,s,k,g){function c(y){this.config=y||{}}var f=i.UA,e=KISSY.NodeList,n=i.all,j=i.Event,l=function(y){y=n(y);if(y.nodeName()==="img"&&!/(^|\s+)ke_/.test(y[0].className))return y};i.augment(c,{pluginRenderUI:function(y){function B(d){g.useDialog(y,"image",o.config,d)}var o=this,b=y.get("prefixCls");y.addButton("image",{tooltip:"\u63d2\u5165\u56fe\u7247",listeners:{click:function(){B(null)}},mode:u.WYSIWYG_MODE});var a=[{content:"\u56fe\u7247\u5c5e\u6027",fn:function(){var d=l(this.get("editorSelectedEl"));
if(d){this.hide();B(n(d))}}},{content:"\u63d2\u5165\u65b0\u884c",fn:function(){this.hide();var d=y.get("document")[0],m=new e(d.createElement("p"));f.ie||m._4e_appendBogus(undefined);d=new u.Range(d);d.setStartAfter(this.get("editorSelectedEl"));d.select();y.insertElement(m);d.moveToElementEditablePosition(m,1);d.select()}}],t=[];i.each(a,function(d){t.push({content:d.content})});y.addContextMenu("image",l,{width:120,children:t,listeners:{click:function(d){var m=this,h=d.target.get("content");i.each(a,function(r){r.content==
h&&r.fn.call(m)})}}});y.docReady(function(){j.on(y.get("document")[0],"dblclick",function(d){d.halt();d=n(d.target);l(d)&&B(d)})});y.addBubble("image",l,{listeners:{afterRenderUI:function(){var d=this,m=d.get("contentEl");m.html(i.substitute('<a class="{prefixCls}editor-bubble-url" target="_blank" href="#">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  |  <a class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change" href="#">\u7f16\u8f91</a>  |  <a class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove" href="#">\u5220\u9664</a>',
{prefixCls:b}));var h=m.one("."+b+"editor-bubble-url"),r=m.one("."+b+"editor-bubble-change"),p=m.one("."+b+"editor-bubble-remove");u.Utils.preventFocus(m);r.on("click",function(w){B(d.get("editorSelectedEl"));w.halt()});p.on("click",function(w){if(f.webkit){var A=y.getSelection().getRanges();if(A&&A[0]){A[0].collapse();A[0].select()}}d.get("editorSelectedEl").remove();d.hide();y.notifySelectionChange();w.halt()});d.on("show",function(){var w=d.get("editorSelectedEl");if(w){w=w.attr("_ke_saved_src")||
w.attr("src");h.attr("href",w)}})}}})}});return c},{requires:["editor","../button/","../bubble/","../contextmenu/","../dialog-loader/"]});KISSY.add("editor/plugin/indent/cmd",function(i,u,v){var s=v.addCommand;return{init:function(k){s(k,"indent")}}},{requires:["editor","../dent-utils/cmd"]});
KISSY.add("editor/plugin/indent/index",function(i,u,v){function s(){}i.augment(s,{pluginRenderUI:function(k){v.init(k);k.addButton("indent",{tooltip:"\u589e\u52a0\u7f29\u8fdb\u91cf ",listeners:{click:function(){k.execCommand("indent");k.focus()}},mode:u.WYSIWYG_MODE})}});return s},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/italic/cmd",function(i,u,v){var s=new u.Style({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]});return{init:function(k){v.addButtonCmd(k,"italic",s)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/italic/index",function(i,u,v,s){function k(){}i.augment(k,{pluginRenderUI:function(g){s.init(g);g.addButton("italic",{cmdType:"italic",tooltip:"\u659c\u4f53 "},v.Button);g.docReady(function(){g.get("document").on("keydown",function(c){if(c.ctrlKey&&c.keyCode==i.Node.KeyCodes.I){g.execCommand("italic");c.preventDefault()}})})}});return k},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/justify-center/cmd",function(i,u){return{init:function(v){u.addCommand(v,"justifyCenter","center")}}},{requires:["../justify-utils/cmd"]});
KISSY.add("editor/plugin/justify-center/index",function(i,u,v){function s(){var g=this.get("editor");g.execCommand("justifyCenter");g.focus()}function k(){}i.augment(k,{pluginRenderUI:function(g){v.init(g);g.addButton("justifyCenter",{tooltip:"\u5c45\u4e2d\u5bf9\u9f50",checkable:true,listeners:{click:s,afterSyncUI:function(){var c=this;g.on("selectionChange",function(){if(g.get("mode")!=u.SOURCE_MODE)g.queryCommandValue("justifyCenter")?c.set("checked",true):c.set("checked",false)})}},mode:u.WYSIWYG_MODE});g.docReady(function(){g.get("document").on("keydown",
function(c){if(c.ctrlKey&&c.keyCode==i.Node.KeyCodes.E){g.execCommand("justifyCenter");c.preventDefault()}})})}});return k},{requires:["editor","./cmd"]});KISSY.add("editor/plugin/justify-left/cmd",function(i,u){return{init:function(v){u.addCommand(v,"justifyLeft","left")}}},{requires:["../justify-utils/cmd"]});
KISSY.add("editor/plugin/justify-left/index",function(i,u,v){function s(){var g=this.get("editor");g.execCommand("justifyLeft");g.focus()}function k(){}i.augment(k,{pluginRenderUI:function(g){v.init(g);g.addButton("justifyLeft",{tooltip:"\u5de6\u5bf9\u9f50",checkable:true,listeners:{click:s,afterSyncUI:function(){var c=this;g.on("selectionChange",function(){if(g.get("mode")!=u.SOURCE_MODE)g.queryCommandValue("justifyLeft")?c.set("checked",true):c.set("checked",false)})}},mode:u.WYSIWYG_MODE});g.docReady(function(){g.get("document").on("keydown",
function(c){if(c.ctrlKey&&c.keyCode==i.Node.KeyCodes.L){g.execCommand("justifyLeft");c.preventDefault()}})})}});return k},{requires:["editor","./cmd"]});KISSY.add("editor/plugin/justify-right/cmd",function(i,u){return{init:function(v){u.addCommand(v,"justifyRight","right")}}},{requires:["../justify-utils/cmd"]});
KISSY.add("editor/plugin/justify-right/index",function(i,u,v){function s(){var g=this.get("editor");g.execCommand("justifyRight");g.focus()}function k(){}i.augment(k,{pluginRenderUI:function(g){v.init(g);g.addButton("justifyRight",{tooltip:"\u53f3\u5bf9\u9f50",checkable:true,listeners:{click:s,afterSyncUI:function(){var c=this;g.on("selectionChange",function(){if(g.get("mode")!=u.SOURCE_MODE)g.queryCommandValue("justifyRight")?c.set("checked",true):c.set("checked",false)})}},mode:u.WYSIWYG_MODE});g.docReady(function(){g.get("document").on("keydown",
function(c){if(c.ctrlKey&&c.keyCode==i.Node.KeyCodes.R){g.execCommand("justifyRight");c.preventDefault()}})})}});return k},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justify-utils/cmd",function(i,u){var v=/(-moz-|-webkit-|start|auto)/gi;return{addCommand:function(s,k,g){if(!s.hasCommand(k)){s.addCommand(k,{exec:function(c){c.focus();c.execCommand("save");for(var f=c.getSelection(),e=f.createBookmarks(),n=f.getRanges(),j,l,y=n.length-1;y>=0;y--){j=n[y].createIterator();for(j.enlargeBr=true;l=j.getNextParagraph();){l.removeAttr("align");(l.css("text-align").replace(v,"")||"left")==g?l.css("text-align",""):l.css("text-align",g)}}f.selectBookmarks(e);
c.execCommand("save");c.notifySelectionChange()}});s.addCommand(u.Utils.getQueryCmd(k),{exec:function(c){if((c=c.getSelection())&&!c.isInvalid){c=c.getStartElement();c=new u.ElementPath(c);c=c.block||c.blockLimit;if(!c||c.nodeName()==="body")return false;return(c.css("text-align").replace(v,"")||"left")==g}}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/link/index",function(i,u,v,s,k){function g(e){e=f(e);return e.closest("a",undefined)}function c(e){this.config=e||{}}var f=i.all;i.augment(c,{pluginRenderUI:function(e){var n=e.get("prefixCls");e.addButton("link",{tooltip:"\u63d2\u5165\u94fe\u63a5",listeners:{click:function(){k.useDialog(e,"link",j.config,void 0)}},mode:u.WYSIWYG_MODE});var j=this;e.addBubble("link",g,{listeners:{afterRenderUI:function(){var l=this,y=l.get("contentEl");y.html(i.substitute('<a href=""  target="_blank" class="{prefixCls}editor-bubble-url">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  \u2013   <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change">\u7f16\u8f91</span>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove">\u53bb\u9664</span>',
{prefixCls:n}));var B=y.one("."+n+"editor-bubble-url"),o=y.one("."+n+"editor-bubble-change"),b=y.one("."+n+"editor-bubble-remove");u.Utils.preventFocus(y);o.on("click",function(a){var t=l.get("editorSelectedEl");k.useDialog(e,"link",j.config,t);a.halt()});b.on("click",function(a){s.removeLink(e,l.get("editorSelectedEl"));a.halt()});l.on("show",function(){var a=l.get("editorSelectedEl");if(a){a=a.attr(s._ke_saved_href)||a.attr("href");B.html(a);B.attr("href",a)}})}}})}});return c},{requires:["editor",
"../bubble/","./utils","../dialog-loader/","../button/"]});
KISSY.add("editor/plugin/link/utils",function(i,u){var v=i.Node,s=u.Style,k={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};return{removeLink:function(g,c){g.execCommand("save");var f=g.getSelection(),e=f.getRanges()[0];if(e&&e.collapsed){e=f.createBookmarks();c._4e_remove(true);f.selectBookmarks(e)}else if(e){f=c[0];e=f.attributes;for(var n={},j=0;j<e.length;j++){var l=e[j];if(l.specified)n[l.name]=l.value}if(f.style.cssText)n.style=
f.style.cssText;(new s(k,n)).remove(g.get("document")[0])}g.execCommand("save");g.notifySelectionChange()},applyLink:function(g,c,f){c._ke_saved_href=c.href;if(f){g.execCommand("save");f.attr(c)}else{f=(f=g.getSelection())&&f.getRanges()[0];if(!f||f.collapsed){c=new v("<a>"+c.href+"</a>",c,g.get("document")[0]);g.insertElement(c)}else{g.execCommand("save");(new s(k,c)).apply(g.get("document")[0])}}g.execCommand("save");g.notifySelectionChange()},_ke_saved_href:"_ke_saved_href"}},{requires:["editor"]});
KISSY.add("editor/plugin/list-utils/btn",function(i,u){return{init:function(v,s){var k=s.buttonId,g=s.cmdType,c=s.tooltip,f=v.addButton(k,{elCls:k+"Btn",mode:u.WYSIWYG_MODE,tooltip:"\u8bbe\u7f6e"+c});v.on("selectionChange",function(){var n;if(n=v.queryCommandValue(g)){f.set("checked",true);e.set("value",n)}else f.set("checked",false)});var e=v.addSelect(k+"Arrow",{tooltip:"\u9009\u62e9\u5e76\u8bbe\u7f6e"+c,mode:u.WYSIWYG_MODE,menu:s.menu,matchElWidth:false,elCls:"toolbar-"+k+"ArrowBtn"});e.on("click",function(n){n=n.target.get("value");
f.listValue=n;v.execCommand(g,n);v.focus()});f.on("click",function(){var n=f.listValue;if(f.get("checked"))n=e.get("value");v.execCommand(g,n);v.focus()})}}},{requires:["editor","../button/","../menubutton/"]});
KISSY.add("editor/plugin/list-utils/cmd",function(i,u,v,s){function k(o){this.type=o}function g(o,b){var a,t,d,m=b.blockLimit,h=b.elements;if(!m)return false;if(h)for(d=0;d<h.length&&(a=h[d])&&a[0]!==m[0];d++)if(c[t=a.nodeName()])if(t==o)return a.css("list-style-type");return false}var c={ol:"insertOrderedList",ul:"insertUnorderedList"},f=u.RANGE,e=u.ElementPath,n=u.Walker,j=i.UA,l=i.Node,y=i.DOM,B=/^h[1-6]$/;k.prototype={changeListType:function(o,b,a,t,d){var m=v.listToArray(b.root,a,s,s,s),h=[];
for(o=0;o<b.contents.length;o++){var r=b.contents[o];r=r.closest("li",s);if(!(!r||!r[0]||r.data("list_item_processed"))){h.push(r);r._4e_setMarker(a,"list_item_processed",true,s)}}r=new l(b.root[0].ownerDocument.createElement(this.type));r.css("list-style-type",d);for(o=0;o<h.length;o++){d=h[o].data("listarray_index");m[d].parent=r}a=v.arrayToList(m,a,null,"p");var p;d=a.listNode.childNodes.length;for(o=0;o<d&&(p=new l(a.listNode.childNodes[o]));o++)p.nodeName()==this.type&&t.push(p);b.root.before(a.listNode);
b.root.remove()},createList:function(o,b,a,t){var d=b.contents;o=b.root[0].ownerDocument;var m=[];if(d.length==1&&d[0][0]===b.root[0]){var h=new l(o.createElement("div"));d[0][0].nodeType!=y.NodeType.TEXT_NODE&&d[0]._4e_moveChildren(h,s,s);d[0][0].appendChild(h[0]);d[0]=h}b=b.contents[0].parent();for(h=0;h<d.length;h++)b=b._4e_commonAncestor(d[h].parent(),s);for(h=0;h<d.length;h++)for(var r=d[h],p;p=r.parent();){if(p[0]===b[0]){m.push(r);break}r=p}if(!(m.length<1)){d=new l(m[m.length-1][0].nextSibling);
h=new l(o.createElement(this.type));h.css("list-style-type",t);for(a.push(h);m.length;){a=m.shift();t=new l(o.createElement("li"));if(B.test(a.nodeName()))t[0].appendChild(a[0]);else{a._4e_copyAttributes(t,s,s);a._4e_moveChildren(t,s,s);a.remove()}h[0].appendChild(t[0]);j.ie||t._4e_appendBogus(s)}d[0]?h.insertBefore(d,s):b.append(h)}},removeList:function(o,b,a){function t(H){if((w=new l(p[H?"firstChild":"lastChild"]))&&!(w[0].nodeType==y.NodeType.ELEMENT_NODE&&w._4e_isBlockBoundary(s,s))&&(A=b.root[H?
"prev":"next"](n.whitespaces(true),1))&&!(w[0].nodeType==y.NodeType.ELEMENT_NODE&&A._4e_isBlockBoundary({br:1},s)))w[H?"before":"after"](o.get("document")[0].createElement("br"))}for(var d=v.listToArray(b.root,a,s,s,s),m=[],h=0;h<b.contents.length;h++){var r=b.contents[h];r=r.closest("li",s);if(!(!r||r.data("list_item_processed"))){m.push(r);r._4e_setMarker(a,"list_item_processed",true,s)}}r=null;for(h=0;h<m.length;h++){r=m[h].data("listarray_index");d[r].indent=-1;r=r}for(h=r+1;h<d.length;h++)if(d[h].indent>
Math.max(d[h-1].indent,0)){m=d[h-1].indent+1-d[h].indent;for(r=d[h].indent;d[h]&&d[h].indent>=r;){d[h].indent+=m;h++}h--}var p=v.arrayToList(d,a,null,"p").listNode,w,A;t(true);t(s);b.root.before(p);b.root.remove()},exec:function(o,b){var a=o.getSelection(),t=a&&a.getRanges();if(!(!t||t.length<1)){var d=a.getStartElement();d=new u.ElementPath(d);var m=g(this.type,d);d=a.createBookmarks(true);for(var h=[],r={};t.length>0;){var p=t.shift(),w=p.getBoundaryNodes(),A=w.startNode,H=w.endNode;A[0].nodeType==
y.NodeType.ELEMENT_NODE&&A.nodeName()=="td"&&p.setStartAt(w.startNode,f.POSITION_AFTER_START);H[0].nodeType==y.NodeType.ELEMENT_NODE&&H.nodeName()=="td"&&p.setEndAt(w.endNode,f.POSITION_BEFORE_END);p=p.createIterator();for(p.forceBrBreak=false;w=p.getNextParagraph();)if(!w.data("list_block")){w._4e_setMarker(r,"list_block",1,s);H=new e(w);var N=H.elements,Q=null,q=false;Q=H.blockLimit;var x;for(A=N.length-1;A>=0&&(x=N[A]);A--)if(c[x.nodeName()]&&Q.contains(x)){Q.removeData("list_group_object");if(A=
x.data("list_group_object"))A.contents.push(w);else{A={root:x,contents:[w]};h.push(A);x._4e_setMarker(r,"list_group_object",A,s)}q=true;break}if(!q){H=Q||H.block;if(H.data("list_group_object"))H.data("list_group_object").contents.push(w);else{A={root:H,contents:[w]};H._4e_setMarker(r,"list_group_object",A,s);h.push(A)}}}}for(t=[];h.length>0;){A=h.shift();if(m){if(c[A.root.nodeName()])A.root.css("list-style-type")==b?this.removeList(o,A,r):A.root.css("list-style-type",b)}else if(c[A.root.nodeName()])this.changeListType(o,
A,r,t,b);else{u.Utils.clearAllMarkers(r);this.createList(o,A,t,b)}}var C=this;for(A=0;A<t.length;A++){Q=t[A];x=function(F,z){var D=z[F?"prev":"next"](n.whitespaces(true),1);if(D&&D[0]&&D.nodeName()==C.type&&D.css("list-style-type")==b){D.remove();D._4e_moveChildren(z,F?true:false,s)}};x(s,Q);x(true,Q)}u.Utils.clearAllMarkers(r);a.selectBookmarks(d)}}};return{ListCommand:k,queryActive:g}},{requires:["editor","../list-utils/"]});
KISSY.add("editor/plugin/list-utils/index",function(i){var u={ol:1,ul:1},v=i.Node,s=i.DOM,k=s.NodeType,g=i.UA,c={listToArray:function(f,e,n,j,l){if(!u[f.nodeName()])return[];j||(j=0);n||(n=[]);for(var y=0,B=f[0].childNodes.length;y<B;y++){var o=new v(f[0].childNodes[y]);if(o.nodeName()=="li"){var b={parent:f,indent:j,element:o,contents:[]};if(l)b.grandparent=l;else{b.grandparent=f.parent();if(b.grandparent&&b.grandparent.nodeName()=="li")b.grandparent=b.grandparent.parent()}e&&o._4e_setMarker(e,"listarray_index",
n.length,undefined);n.push(b);for(var a=0,t=o[0].childNodes.length,d;a<t;a++){d=new v(o[0].childNodes[a]);d[0].nodeType==s.NodeType.ELEMENT_NODE&&u[d.nodeName()]?c.listToArray(d,e,n,j+1,b.grandparent):b.contents.push(d)}}}return n},arrayToList:function(f,e,n,j){n||(n=0);if(!f||f.length<n+1)return null;for(var l=f[n].parent[0].ownerDocument,y=l.createDocumentFragment(),B=null,o=n,b=Math.max(f[n].indent,0),a=null;;){var t=f[o];if(t.indent==b){if(!B||f[o].parent.nodeName()!=B.nodeName()){B=f[o].parent.clone(false);
y.appendChild(B[0])}a=B[0].appendChild(t.element.clone(false)[0]);for(var d=0;d<t.contents.length;d++)a.appendChild(t.contents[d].clone(true)[0]);o++}else if(t.indent==Math.max(b,0)+1){o=c.arrayToList(f,null,o,j);a.appendChild(o.listNode);o=o.nextIndex}else if(t.indent==-1&&!n&&t.grandparent){if(u[t.grandparent.nodeName()])a=t.element.clone(false)[0];else if(t.grandparent.nodeName()!="td"){a=l.createElement(j);t.element._4e_copyAttributes(new v(a))}else a=l.createDocumentFragment();for(d=0;d<t.contents.length;d++){B=
t.contents[d].clone(true);a.nodeType==k.DOCUMENT_FRAGMENT_NODE&&t.element._4e_copyAttributes(new v(B));a.appendChild(B[0])}if(a.nodeType==k.DOCUMENT_FRAGMENT_NODE&&o!=f.length-1){a.lastChild&&a.lastChild.nodeType==s.NodeType.ELEMENT_NODE&&a.lastChild.getAttribute("type")=="_moz"&&s._4e_remove(a.lastChild);s._4e_appendBogus(a)}if(a.nodeType==s.NodeType.ELEMENT_NODE&&s.nodeName(a)==j&&a.firstChild){s._4e_trim(a);B=a.firstChild;if(B.nodeType==s.NodeType.ELEMENT_NODE&&s._4e_isBlockBoundary(B)){B=l.createDocumentFragment();
s._4e_moveChildren(a,B);a=B}}B=s.nodeName(a);if(!g.ie&&(B=="div"||B=="p"))s._4e_appendBogus(a);y.appendChild(a);B=null;o++}else return null;if(f.length<=o||Math.max(f[o].indent,0)<b)break}if(e)for(f=new v(y.firstChild);f&&f[0];){f[0].nodeType==s.NodeType.ELEMENT_NODE&&f._4e_clearMarkers(e,true);f=f._4e_nextSourceNode()}return{listNode:y,nextIndex:o}}};return c},{requires:["editor"]});
KISSY.add("editor/plugin/local-storage/index",function(i,u,v,s){if(!i.UA.ie&&window.localStorage)return window.localStorage;var k=u.Utils.debugUrl("plugin/local-storage/swfstore.swf?t="+ +new Date),g={width:215,border:"1px solid red"},c={width:0,border:"none"},f=new v({prefixCls:"ks-editor-",elStyle:{background:"white"},width:"0px",content:"<h1 style='text-align:center;'>\u8bf7\u70b9\u51fb\u5141\u8bb8</h1><div class='storage-container'></div>",zIndex:u.baseZIndex(u.zIndexManager.STORE_FLASH_SHOW)});f.render();f.show();var e=
new s({src:k,render:f.get("contentEl").one(".storage-container"),params:{flashVars:{useCompression:true}},attrs:{height:138,width:"100%"},methods:["setItem","removeItem","getItem","setMinDiskSpace","getValueOf"]});i.ready(function(){setTimeout(function(){f.center()},0)});e.on("pending",function(){f.get("el").css(g);f.center();f.show();setTimeout(function(){e.retrySave()},1E3)});e.on("save",function(){f.get("el").css(c)});var n=e.setItem;i.mix(e,{_ke:1,getItem:function(j){return this.getValueOf(j)},
retrySave:function(){this.setItem(this.lastSave.k,this.lastSave.v)},setItem:function(j,l){this.lastSave={k:j,v:l};n.call(this,j,l)}});e.on("contentReady",function(){e._ready=1});return e},{requires:["editor","overlay","../flash-bridge/"]});
KISSY.add("editor/plugin/maximize/cmd",function(i,u){function v(j){this.editor=j}var s=i.UA,k=s.ie,g=document,c=i.Node,f=i.Event,e=i.DOM,n;i.augment(v,{restoreWindow:function(){var j=this,l=j.editor;if(l.fire("beforeRestoreWindow")!==false)if(j._resize){f.remove(window,"resize",j._resize);j._resize.stop();j._resize=0;j._saveEditorStatus();j._restoreState();setTimeout(function(){j._restoreEditorStatus();l.notifySelectionChange();l.fire("afterRestoreWindow")},30)}},_restoreState:function(){var j=this.editor,
l=j.get("textarea"),y=this._savedParents;if(y){for(var B=0;B<y.length;B++){var o=y[B];o.el.css("position",o.position)}this._savedParents=null}l.parent().css({height:this.iframeHeight});l.css({height:this.iframeHeight});e.css(g.body,{width:"",height:"",overflow:""});g.documentElement.style.overflow="";l=j.get("el")[0].style;l.position="static";l.width=this.editorElWidth;n.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);k<8&&j.get("toolBarEl").removeClass(j.get("prefixCls")+
"editor-toolbar-padding",undefined)},_saveSate:function(){var j=this.editor,l=[],y=j.get("el");this.iframeHeight=j.get("textarea").parent().style("height");this.editorElWidth=y.style("width");this.scrollLeft=e.scrollLeft();this.scrollTop=e.scrollTop();window.scrollTo(0,0);for(y=y.parent();y;){var B=y.css("position");if(B!="static"){l.push({el:y,position:B});y.css("position","static")}y=y.parent()}this._savedParents=l;k<8&&j.get("toolBarEl").addClass(j.get("prefixCls")+"editor-toolbar-padding",undefined)},
_saveEditorStatus:function(){var j=this.editor;this.savedRanges=null;if(s.gecko&&j.__iframeFocus)this.savedRanges=(j=j.getSelection())&&j.getRanges()},_restoreEditorStatus:function(){var j=this.editor,l=j.getSelection(),y=this.savedRanges;s.gecko&&j.activateGecko();y&&l&&l.selectRanges(y);if(j.__iframeFocus&&l)(j=l.getStartElement())&&j.scrollIntoView(undefined,{alignWithTop:false,allowHorizontalScroll:true,onlyScrollIfNeeded:true})},_maximize:function(j){var l=this.editor,y=l.get("el"),B=e.viewportHeight(),
o=e.viewportWidth(),b=l.get("textarea"),a=l.get("statusBarEl")?l.get("statusBarEl")[0].offsetHeight:0;l=l.get("toolBarEl")[0].offsetHeight;if(k)g.body.style.overflow="hidden";else e.css(g.body,{width:0,height:0,overflow:"hidden"});g.documentElement.style.overflow="hidden";y.css({position:"absolute",zIndex:u.baseZIndex(u.zIndexManager.MAXIMIZE),width:o+"px"});n.css({zIndex:u.baseZIndex(u.zIndexManager.MAXIMIZE-5),height:B+"px",width:o+"px"});y.offset({left:0,top:0});n.css({left:0,top:0});b.parent().css({height:B-
a-l+"px"});b.css({height:B-a-l+"px"});j!==true&&arguments.callee.call(this,true)},_real:function(){var j=this,l=j.editor;if(!j._resize){j._saveEditorStatus();j._saveSate();j._maximize();if(!j._resize)j._resize=i.buffer(function(){j._maximize();l.fire("afterMaximizeWindow")},100);f.on(window,"resize",j._resize);setTimeout(function(){j._restoreEditorStatus();l.notifySelectionChange();l.fire("afterMaximizeWindow")},30)}},maximizeWindow:function(){if(this.editor.fire("beforeMaximizeWindow")!==false){n||
(n=(new c("<iframe  style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(g.body,undefined));this._real()}},destroy:function(){if(this._resize){f.remove(window,"resize",this._resize);this._resize.stop();this._resize=0}}});return{init:function(j){if(!j.hasCommand("maximizeWindow")){var l=new v(j);j.addCommand("maximizeWindow",{exec:function(){l.maximizeWindow()}});j.addCommand("restoreWindow",{exec:function(){l.restoreWindow()}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/maximize/index",function(i,u,v){function s(){}i.augment(s,{pluginRenderUI:function(k){v.init(k);k.addButton("maximize",{tooltip:"\u5168\u5c4f",listeners:{click:function(){if(this.get("checked")){k.execCommand("maximizeWindow");this.set("tooltip","\u53d6\u6d88\u5168\u5c4f");this.set("contentCls","restore")}else{k.execCommand("restoreWindow");this.set("tooltip","\u5168\u5c4f");this.set("contentCls","maximize")}k.focus()}},checkable:true})}});return s},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/menubutton/index",function(i,u,v){u.prototype.addSelect=function(s,k,g){g=g||v.Select;var c=this.get("prefixCls")+"editor-";if(k){k.editor=this;if(k.menu)k.menu.zIndex=u.baseZIndex(u.zIndexManager.SELECT);if(k.elCls)k.elCls=c+k.elCls}var f=(new g(i.mix({render:this.get("toolBarEl"),prefixCls:c},k))).render();f.get("el").unselectable();if(k.mode==u.WYSIWYG_MODE){this.on("wysiwygMode",function(){f.set("disabled",false)});this.on("sourceMode",function(){f.set("disabled",true)})}this.addControl(s+
"/select",f);return f};return v},{requires:["editor","menubutton"]});KISSY.add("editor/plugin/multiple-upload/index",function(i,u,v){function s(k){this.config=k||{}}i.augment(s,{pluginRenderUI:function(k){var g=this;k.addButton("multipleUpload",{tooltip:"\u6279\u91cf\u63d2\u56fe",listeners:{click:function(){v.useDialog(k,"multiple-upload",g.config)}},mode:u.WYSIWYG_MODE})}});return s},{requires:["editor","../dialog-loader/"]});
KISSY.add("editor/plugin/ordered-list/cmd",function(i,u,v){var s=v.queryActive,k=new v.ListCommand("ol");return{init:function(g){g.hasCommand("insertOrderedList")||g.addCommand("insertOrderedList",{exec:function(f,e){f.focus();k.exec(f,e)}});var c=u.Utils.getQueryCmd("insertOrderedList");g.hasCommand(c)||g.addCommand(c,{exec:function(f){if((f=f.getSelection())&&!f.isInvalid){f=f.getStartElement();f=new u.ElementPath(f);return s("ol",f)}}})}}},{requires:["editor","../list-utils/cmd"]});
KISSY.add("editor/plugin/ordered-list/index",function(i,u,v,s){function k(){}i.augment(k,{pluginRenderUI:function(g){s.init(g);v.init(g,{cmdType:"insertOrderedList",buttonId:"orderedList",menu:{width:75,children:[{content:"1,2,3...",value:"decimal"},{content:"a,b,c...",value:"lower-alpha"},{content:"A,B,C...",value:"upper-alpha"},{content:"i,ii,iii...",value:"lower-roman"},{content:"I,II,III...",value:"upper-roman"}]},tooltip:"\u6709\u5e8f\u5217\u8868"})}});return k},{requires:["editor","../list-utils/btn","./cmd"]});
KISSY.add("editor/plugin/outdent/cmd",function(i,u,v){var s=v.addCommand,k=v.checkOutdentActive;return{init:function(g){s(g,"outdent");var c=u.Utils.getQueryCmd("outdent");g.hasCommand(c)||g.addCommand(c,{exec:function(f){if((f=f.getSelection())&&!f.isInvalid){f=f.getStartElement();f=new u.ElementPath(f);return k(f)}}})}}},{requires:["editor","../dent-utils/cmd"]});
KISSY.add("editor/plugin/outdent/index",function(i,u,v){function s(){}i.augment(s,{pluginRenderUI:function(k){v.init(k);k.addButton("outdent",{tooltip:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",listeners:{click:function(){k.execCommand("outdent");k.focus()},afterSyncUI:function(){var g=this;k.on("selectionChange",function(){if(k.get("mode")!=u.SOURCE_MODE)k.queryCommandValue("outdent")?g.set("disabled",false):g.set("disabled",true)})}},mode:u.WYSIWYG_MODE})}});return s},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/overlay/index",function(i,u,v,s,k,g){var c=v.extend({bindUI:function(){s.init(this)}},{ATTRS:{prefixCls:{value:"ks-editor-"},zIndex:{value:u.baseZIndex(u.zIndexManager.OVERLAY)}}});c.Dialog=v.Dialog.extend({initializer:function(){this.plug(new g({handlers:[".ks-editor-stdmod-header"],plugins:[new k({constrain:window})]}))},bindUI:function(){s.init(this)},show:function(){this.center();var f=this.get("y");if(f-i.DOM.scrollTop()>200){f=i.DOM.scrollTop()+200;this.set("y",f)}c.prototype.show.call(this)}},
{ATTRS:{prefixCls:{value:"ks-editor-"},zIndex:{value:u.baseZIndex(u.zIndexManager.OVERLAY)}}});return c},{requires:["editor","overlay","../focus-fix/","dd/plugin/constrain","component/plugin/drag"]});
KISSY.add("editor/plugin/page-break/index",function(i,u,v){function s(){}var k=i.Node;i.augment(s,{pluginRenderUI:function(g){v.init(g);var c=g.htmlDataProcessor;(c&&c.dataFilter).addRules({tags:{div:function(f){var e=f.getAttribute("style"),n;if(e)for(var j=f.childNodes,l=0;l<j.length;l++)if(j[l].nodeType==1)n=j[l];if((n=n&&n.nodeName=="span"&&n.getAttribute("style"))&&/page-break-after\s*:\s*always/i.test(e)&&/display\s*:\s*none/i.test(n))return c.createFakeParserElement(f,"ke_pagebreak","div")}}});
g.addButton("pageBreak",{tooltip:"\u5206\u9875",listeners:{click:function(){var f=new k('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,g.get("document")[0]);f=g.createFakeElement(f,"ke_pagebreak","div",false,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>');g.focus();var e=g.getSelection();if(e=e&&e.getRanges()[0]){g.execCommand("save");for(var n=e.startContainer,j=n;n.nodeName()!=="body";){j=n;n=n.parent()}e.collapse(true);
e.splitElement(j);f.insertAfter(j);g.execCommand("save")}}},mode:u.WYSIWYG_MODE})}});return s},{requires:["editor","../fake-objects/"]});
KISSY.add("editor/plugin/preview/index",function(i){function u(){}var v=window;i.augment(u,{pluginRenderUI:function(s){s.addButton("preview",{tooltip:"\u9884\u89c8",listeners:{click:function(){try{var k=v.screen,g=Math.round(k.width*0.8),c=Math.round(k.height*0.7),f=Math.round(k.width*0.1)}catch(e){g=640;c=420;f=80}k=s.getDocHtml().replace(/\${title}/,"\u9884\u89c8");g=v.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+g+",height="+c+",left="+f);c=g.document;c.open();c.write(k);
c.close();g.focus()}}})}});return u});
KISSY.add("editor/plugin/progressbar/index",function(i){function u(){u.superclass.constructor.apply(this,arguments);this._init()}var v=i.Node;u.ATTRS={container:{},width:{},height:{},progress:{value:0},prefixCls:{value:"ks-"}};i.extend(u,i.Base,{destroy:function(){this.detach();this.el.remove()},_init:function(){var s=this.get("height"),k=this.get("prefixCls"),g=new v(i.substitute("<div class='{prefixCls}editor-progressbar'  style='width:"+this.get("width")+";height:"+s+";'></div>",{prefixCls:k})),
c=this.get("container");s=(new v(i.substitute("<div style='overflow:hidden;'><div class='{prefixCls}editor-progressbar-inner' style='height:"+(parseInt(s)-4)+"px'><div class='{prefixCls}editor-progressbar-inner-bg'></div></div></div>",{prefixCls:k}))).appendTo(g);k=(new v("<span class='"+k+"editor-progressbar-title'></span>")).appendTo(g);c&&g.appendTo(c);this.el=g;this._title=k;this._p=s;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},
_progressChange:function(s){s=s.newVal;this._p.css("width",s+"%");this._title.html(s+"%")}});return u});
KISSY.add("editor/plugin/remove-format/cmd",function(i,u){function v(e,n){for(var j=0;j<n.length;j++)e.removeAttr(n[j])}var s=u.RANGE,k=u.ElementPath,g=i.DOM,c="class,style,lang,width,height,align,hspace,valign".split(/,/),f=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");return{init:function(e){e.hasCommand("removeFormat")||e.addCommand("removeFormat",{exec:function(){e.focus();f.lastIndex=0;var n=e.getSelection().getRanges();
e.execCommand("save");for(var j=0,l;l=n[j];j++)if(!l.collapsed){l.enlarge(s.ENLARGE_ELEMENT);var y=l.createBookmark(),B=y.startNode,o=y.endNode,b=function(a){for(var t=new k(a),d=t.elements,m=1,h;h=d[m];m++){if(h.equals(t.block)||h.equals(t.blockLimit))break;f.test(h.nodeName())&&a._4e_breakParent(h)}};b(B);b(o);for(B=B._4e_nextSourceNode(true,g.NodeType.ELEMENT_NODE,undefined,undefined);B;){if(B.equals(o))break;b=B._4e_nextSourceNode(false,g.NodeType.ELEMENT_NODE,undefined,undefined);B.nodeName()==
"img"&&(B.attr("_ke_realelement")||/\bke_/.test(B[0].className))||(f.test(B.nodeName())?B._4e_remove(true):v(B,c));B=b}l.moveToBookmark(y)}e.getSelection().selectRanges(n);e.execCommand("save")}})}}},{requires:["editor"]});
KISSY.add("editor/plugin/remove-format/index",function(i,u,v){function s(){}i.augment(s,{pluginRenderUI:function(k){v.init(k);k.addButton("removeFormat",{tooltip:"\u6e05\u9664\u683c\u5f0f",listeners:{click:function(){k.execCommand("removeFormat")}},mode:u.WYSIWYG_MODE})}});return s},{requires:["editor","./cmd","../button/"]});
KISSY.add("editor/plugin/resize/index",function(i,u,v){function s(g){this.config=g||{}}var k=i.Node;i.augment(s,{pluginRenderUI:function(g){var c=v.Draggable,f=g.get("statusBarEl");g.get("textarea");var e=this.config.direction||["x","y"],n="se-resize";if(e.length==1)n=e[0]=="x"?"e-resize":"s-resize";var j=(new k("<div class='"+g.get("prefixCls")+"editor-resizer' style='cursor: "+n+"'></div>")).appendTo(f);g.on("maximizeWindow",function(){j.css("display","none")});g.on("restoreWindow",function(){j.css("display",
"")});var l=new c({node:j}),y=0,B=0,o=g.get("el"),b=g.get("el");l.on("dragstart",function(){y=o.height();B=b.width();g.fire("resizeStart")});l.on("drag",function(a){var t=a.left-this.get("startNodePos").left;a=a.top-this.get("startNodePos").top;i.inArray("y",e)&&g.set("height",y+a);i.inArray("x",e)&&g.set("width",B+t);g.fire("resize")});g.on("destroy",function(){l.destroy();j.remove()})}});return s},{requires:["editor","dd/base"]});
KISSY.add("editor/plugin/separator/index",function(i){function u(){}i.augment(u,{pluginRenderUI:function(v){i.all('<span class="'+v.get("prefixCls")+'editor-toolbar-separator">&nbsp;</span>').appendTo(v.get("toolBarEl"))}});return u},{requires:["editor"]});
KISSY.add("editor/plugin/smiley/index",function(i,u,v){function s(){}for(var k="<div class='{prefixCls}editor-smiley-sprite'>",g=0;g<=98;g++)k+="<a href='javascript:void(0)' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+g+".gif'></a>";k+="</div>";i.augment(s,{pluginRenderUI:function(c){var f=c.get("prefixCls");c.addButton("smiley",{tooltip:"\u63d2\u5165\u8868\u60c5",checkable:true,listeners:{afterSyncUI:function(){var e=this;e.on("blur",function(){setTimeout(function(){e.smiley&&e.smiley.hide()},150)})},click:function(){var e=
this,n;if(e.get("checked")){if(!(n=e.smiley)){n=e.smiley=(new v({content:i.substitute(k,{prefixCls:f}),focus4e:false,width:300,elCls:f+"editor-popup",zIndex:u.baseZIndex(u.zIndexManager.POPUP_MENU),mask:false})).render();n.get("el").on("click",function(j){j=new i.Node(j.target);var l;if(j.nodeName()=="a"&&(l=j.attr("data-icon"))){l=new i.Node("<img alt='' src='"+l+"'/>",null,c.get("document")[0]);c.insertElement(l)}});n.on("hide",function(){e.set("checked",false)})}n.set("align",{node:this.get("el"),
points:["bl","tl"],overflow:{adjustX:1,adjustY:1}});n.show()}else e.smiley&&e.smiley.hide()},destroy:function(){this.smiley&&this.smiley.destroy()}},mode:u.WYSIWYG_MODE})}});return s},{requires:["editor","../overlay/"]});
KISSY.add("editor/plugin/source-area/index",function(i,u){function v(){}var s=u.SOURCE_MODE,k=u.WYSIWYG_MODE;i.augment(v,{pluginRenderUI:function(g){g.addButton("sourceArea",{tooltip:"\u6e90\u7801",listeners:{afterSyncUI:function(){var c=this;g.on("wysiwygMode",function(){c.set("checked",false)});g.on("sourceMode",function(){c.set("checked",true)})},click:function(){this.get("checked")?g.set("mode",s):g.set("mode",k)}},checkable:true})}});return v},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/strike-through/cmd",function(i,u,v){var s=new u.Style({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"},{element:"strike"}]});return{init:function(k){v.addButtonCmd(k,"strikeThrough",s)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/strike-through/index",function(i,u,v,s){function k(){}i.augment(k,{pluginRenderUI:function(g){s.init(g);g.addButton("strikeThrough",{cmdType:"strikeThrough",tooltip:"\u5220\u9664\u7ebf "},v.Button)}});return k},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/table/index",function(i,u,v){function s(p){function w(F){if(!(N.length>0))if(F[0].nodeType==o.NodeType.ELEMENT_NODE&&t.test(F.nodeName())&&!F.data("selected_cell")){F._4e_setMarker(Q,"selected_cell",true,undefined);N.push(F)}}for(var A=p.createBookmarks(),H=p.getRanges(),N=[],Q={},q=0;q<H.length;q++){var x=H[q];if(x.collapsed){x=x.getCommonAncestor();(x=x.closest("td",undefined)||x.closest("th",undefined))&&N.push(x)}else{x=new Walker(x);var C;for(x.guard=w;C=x.next();)if((C=
C.parent())&&t.test(C.nodeName())&&!C.data("selected_cell")){C._4e_setMarker(Q,"selected_cell",true,undefined);N.push(C)}}}u.Utils.clearAllMarkers(Q);p.selectBookmarks(A);return N}function k(p,w){var A=p.getStartElement().parent("tr");if(A){var H=A.clone(true);H.insertBefore(A);A=(w?H[0]:A[0]).cells;for(H=0;H<A.length;H++){A[H].innerHTML="";B.ie||(new b(A[H]))._4e_appendBogus(undefined)}}}function g(p){if(p instanceof u.Selection){var w=s(p),A=w.length;p=[];for(var H,N,Q=0;Q<A;Q++){var q=w[Q].parent(),
x=q[0].rowIndex;!Q&&(H=x-1);p[x]=q;Q==A-1&&(N=x+1)}Q=q.parent("table");H=new b(N<Q[0].rows.length&&Q[0].rows[N]||H>0&&Q[0].rows[H]||Q[0].parentNode);for(Q=p.length;Q>=0;Q--)p[Q]&&g(p[Q]);return H}else if(p instanceof b){Q=p.parent("table");Q[0].rows.length==1?Q.remove():p.remove()}return 0}function c(p,w){var A=p.getStartElement();if(A=A.closest("td",undefined)||A.closest("th",undefined))for(var H=A.parent("table"),N=A[0].cellIndex,Q=0;Q<H[0].rows.length;Q++){var q=H[0].rows[Q];if(!(q.cells.length<
N+1)){A=new b(q.cells[N].cloneNode(undefined));B.ie||A._4e_appendBogus(undefined);q=new b(q.cells[N]);w?A.insertBefore(q):A.insertAfter(q)}}}function f(p){if(p instanceof u.Selection){var w=s(p),A,H=[];p=w[0]&&w[0].parent("table");var N,Q,q;N=0;for(Q=w.length;N<Q;N++)H.push(w[N][0].cellIndex);H.sort();N=1;for(Q=H.length;N<Q;N++)if(H[N]-H[N-1]>1){q=H[N-1]+1;break}q||(q=H[0]>0?H[0]-1:H[H.length-1]+1);H=p[0].rows;N=0;for(Q=H.length;N<Q;N++)if(A=H[N].cells[q])break;A=A?new b(A):p.prev();for(q=w.length-
1;q>=0;q--)w[q]&&f(w[q]);return A}else if(p instanceof b){w=p.parent("table");if(!w)return null;A=p[0].cellIndex;for(q=w[0].rows.length-1;q>=0;q--){p=new b(w[0].rows[q]);if(!A&&p[0].cells.length==1)g(p);else p[0].cells[A]&&p[0].removeChild(p[0].cells[A])}}return null}function e(p,w){var A=new u.Range(p[0].ownerDocument);if(!A.moveToElementEditablePosition(p,w?true:undefined)){A.selectNodeContents(p);A.collapse(w?false:true)}A.select(true)}function n(p){var w=(p=p.getSelection())&&p.getStartElement(),
A=w&&w.closest("table",undefined);if(A){p=w.closest(function(H){var N=o.nodeName(H);return A.contains(H)&&(N=="td"||N=="th")},undefined);w=w.closest(function(H){var N=o.nodeName(H);return A.contains(H)&&N=="tr"},undefined);return{table:A,td:p,tr:w}}}function j(p){return(p=n(p))&&p.td}function l(p){return(p=n(p))&&p.tr}function y(p){this.config=p||{}}var B=i.UA,o=i.DOM,b=i.Node,a=["tr","th","td","tbody","table"],t=/^(?:td|th)$/,d={"\u8868\u683c\u5c5e\u6027":n,"\u5220\u9664\u8868\u683c":j,"\u5220\u9664\u5217":j,"\u5220\u9664\u884c":l,"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":l,"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":l,"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":j,
"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":j},m=(B.ie===6?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[" table.%2,"," table.%2 > tr > td,  table.%2 > tr > th,"," table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,"," table.%2 > thead > tr > td,  table.%2 > thead > tr > th,"," table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th","{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"ke_show_border"),h={tags:{table:function(p){var w=p.getAttribute("class"),A=parseInt(p.getAttribute("border"),
10);if(!A||A<=0)p.setAttribute("class",i.trim((w||"")+" ke_show_border"))}}},r={tags:{table:function(p){var w=p.getAttribute("class");if(w)(w=i.trim(w.replace("ke_show_border","")))?p.setAttribute("class",w):p.removeAttribute("class")}}};i.augment(y,{pluginRenderUI:function(p){p.addCustomStyle(m);var w=p.htmlDataProcessor,A=w&&w.htmlFilter;(w&&w.dataFilter).addRules(h);A.addRules(r);var H=this,N={"\u8868\u683c\u5c5e\u6027":function(){this.hide();var q=n(p);q&&v.useDialog(p,"table",H.config,{selectedTable:q.table,selectedTd:q.td})},
"\u5220\u9664\u8868\u683c":function(){this.hide();var q=p.getSelection(),x=q&&q.getStartElement();if(x=x&&x.closest("table",undefined)){p.execCommand("save");q.selectElement(x);var C=q.getRanges()[0];C.collapse();q.selectRanges([C]);q=x.parent();q[0].childNodes.length==1&&q.nodeName()!="body"&&q.nodeName()!="td"?q.remove():x.remove();p.execCommand("save")}},"\u5220\u9664\u884c ":function(){this.hide();p.execCommand("save");var q=p.getSelection();e(g(q),undefined);p.execCommand("save")},"\u5220\u9664\u5217 ":function(){this.hide();p.execCommand("save");
var q=p.getSelection();(q=f(q))&&e(q,true);p.execCommand("save")},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(){this.hide();p.execCommand("save");var q=p.getSelection();k(q,true);p.execCommand("save")},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(){this.hide();p.execCommand("save");var q=p.getSelection();k(q,undefined);p.execCommand("save")},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(){this.hide();p.execCommand("save");var q=p.getSelection();c(q,true);p.execCommand("save")},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(){this.hide();p.execCommand("save");var q=p.getSelection();c(q,undefined);p.execCommand("save")}},
Q=[];i.each(N,function(q,x){Q.push({content:x})});p.addContextMenu("table",function(q){if(i.inArray(o.nodeName(q),a))return true},{width:"120px",children:Q,listeners:{click:function(q){q=q.target.get("content");N[q]&&N[q].apply(this)},beforeVisibleChange:function(q){if(q.newVal){var x=this;q=x.get("children");var C=x.get("editor");i.each(q,function(F){var z=F.get("content");!d[z]||d[z].call(x,C)?F.set("disabled",false):F.set("disabled",true)})}}}});p.addButton("table",{mode:u.WYSIWYG_MODE,listeners:{click:function(){v.useDialog(p,
"table",H.config,{selectedTable:0,selectedTd:0})}},tooltip:"\u63d2\u5165\u8868\u683c"})}});return y},{requires:["editor","../dialog-loader/","../contextmenu/"]});KISSY.add("editor/plugin/underline/cmd",function(i,u,v){var s=new u.Style({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]});return{init:function(k){v.addButtonCmd(k,"underline",s)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/underline/index",function(i,u,v,s){function k(){}i.augment(k,{pluginRenderUI:function(g){s.init(g);g.addButton("underline",{cmdType:"underline",tooltip:"\u4e0b\u5212\u7ebf "},v.Button);g.docReady(function(){g.get("document").on("keydown",function(c){if(c.ctrlKey&&c.keyCode==i.Node.KeyCodes.U){g.execCommand("underline");c.preventDefault()}})})}});return k},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/undo/btn",function(i,u,v){i=v.extend({bindUI:function(){var s=this,k=s.get("editor");s.on("click",function(){k.execCommand("undo")});k.on("afterUndo afterRedo afterSave",function(g){g.index>0?s.set("disabled",false):s.set("disabled",true)})}},{ATTRS:{mode:{value:u.WYSIWYG_MODE},disabled:{value:true}}});return{RedoBtn:v.extend({bindUI:function(){var s=this,k=s.get("editor");s.on("click",function(){k.execCommand("redo")});k.on("afterUndo afterRedo afterSave",function(g){g.index<
g.history.length-1?s.set("disabled",false):s.set("disabled",true)})}},{mode:{value:u.WYSIWYG_MODE},ATTRS:{disabled:{value:true}}}),UndoBtn:i}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/undo/cmd",function(i,u){function v(e){var n=e.get("document")[0].body.innerHTML,j;if(n)j=e.getSelection();this.contents=n;this.bookmarks=j&&j.createBookmarks2(true)}function s(e){this.history=[];this.index=-1;this.editor=e;this.bufferRunner=i.buffer(this.save,500,this);this._init()}var k=u.Utils.arrayCompare,g=i.UA;i.augment(v,{equals:function(e){if(this.contents!=e.contents)return false;var n=this.bookmarks;e=e.bookmarks;if(n||e){if(!n||!e||n.length!=e.length)return false;
for(var j=0;j<n.length;j++){var l=n[j],y=e[j];if(l.startOffset!=y.startOffset||l.endOffset!=y.endOffset||!k(l.start,y.start)||!k(l.end,y.end))return false}}return true}});var c={16:1,17:1,18:1},f={37:1,38:1,39:1,40:1,33:1,34:1};i.augment(s,{_keyMonitor:function(){var e=this,n=e.editor;n.docReady(function(){n.get("document").on("keydown",function(j){var l=j.keyCode;if(!(l in f||l in c))if(l===90&&(j.ctrlKey||j.metaKey)){false!==n.fire("beforeRedo")&&e.restore(-1);j.halt()}else if(l===89&&(j.ctrlKey||
j.metaKey)){false!==n.fire("beforeUndo")&&e.restore(1);j.halt()}else n.fire("beforeSave",{buffer:1})!==false&&e.save(1)})})},_init:function(){var e=this;e._keyMonitor();setTimeout(function(){e.save()},0)},save:function(e){var n=this.editor;if(n.get("mode")==u.WYSIWYG_MODE)if(n.get("document"))if(e)this.bufferRunner();else{e=this.history;var j=this.index;e.length>j+1&&e.splice(j+1,e.length-j-1);j=e[e.length-1];var l=new v(n);if(!j||!j.equals(l)){e.length===30&&e.shift();e.push(l);this.index=j=e.length-
1;n.fire("afterSave",{history:e,index:j})}}},restore:function(e){if(this.editor.get("mode")==u.WYSIWYG_MODE){var n=this.history,j=this.editor,l=j.get("document")[0].body,y=n[this.index+e];if(y){l.innerHTML=y.contents;if(y.bookmarks)j.getSelection().selectBookmarks(y.bookmarks);else if(g.ie){l=l.createTextRange();l.collapse(true);l.select()}(l=j.getSelection())&&l.scrollIntoView();this.index+=e;j.fire(e>0?"afterUndo":"afterRedo",{history:n,index:this.index});j.notifySelectionChange()}return y}}});
return{init:function(e){if(!e.hasCommand("save")){var n=new s(e);e.addCommand("save",{exec:function(j,l){e.focus();n.save(l)}});e.addCommand("undo",{exec:function(){e.focus();n.restore(-1)}});e.addCommand("redo",{exec:function(){e.focus();n.restore(1)}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/undo/index",function(i,u,v,s){function k(){}i.augment(k,{pluginRenderUI:function(g){s.init(g);g.addButton("undo",{mode:u.WYSIWYG_MODE,tooltip:"\u64a4\u9500",editor:g},v.UndoBtn);g.addButton("redo",{mode:u.WYSIWYG_MODE,tooltip:"\u91cd\u505a",editor:g},v.RedoBtn)}});return k},{requires:["editor","./btn","./cmd"]});
KISSY.add("editor/plugin/unordered-list/cmd",function(i,u,v){var s=v.queryActive,k=new v.ListCommand("ul");return{init:function(g){g.hasCommand("insertUnorderedList")||g.addCommand("insertUnorderedList",{exec:function(f,e){f.focus();k.exec(f,e)}});var c=u.Utils.getQueryCmd("insertUnorderedList");g.hasCommand(c)||g.addCommand(c,{exec:function(f){if((f=f.getSelection())&&!f.isInvalid){f=f.getStartElement();f=new u.ElementPath(f);return s("ul",f)}}})}}},{requires:["editor","../list-utils/cmd"]});
KISSY.add("editor/plugin/unordered-list/index",function(i,u,v,s){function k(){}i.augment(k,{pluginRenderUI:function(g){s.init(g);v.init(g,{cmdType:"insertUnorderedList",buttonId:"unorderedList",menu:{width:75,children:[{content:"\u25cf \u5706\u70b9",value:"disc"},{content:"\u25cb \u5706\u5708",value:"circle"},{content:"\u25a0 \u65b9\u5757",value:"square"}]},tooltip:"\u65e0\u5e8f\u5217\u8868"})}});return k},{requires:["editor","../list-utils/btn","./cmd"]});
KISSY.add("editor/plugin/video/index",function(i,u,v,s,k){function g(c){this.config=c}i.augment(g,{pluginRenderUI:function(c){function f(B){for(var o=0;o<j.length;o++){var b=j[o];if(b.reg.test(B))return b}}k.init(c);var e=c.htmlDataProcessor,n=e&&e.dataFilter,j=[],l=this.config;l.providers&&j.push.apply(j,l.providers);l.getProvider=f;n&&n.addRules({tags:{object:function(B){var o=B.getAttribute("classid"),b=B.childNodes;if(!o){for(o=0;o<b.length;o++)if(b[o].nodeName=="embed"){if(!v.isFlashEmbed(b[o]))break;
if(f(b[o].getAttribute("src")))return e.createFakeParserElement(B,"ke_video","video",true)}return null}for(o=0;o<b.length;o++){var a=b[o];if(a.nodeName=="param"&&a.getAttribute("name").toLowerCase()=="movie")if(f(a.getAttribute("value")||a.getAttribute("VALUE")))return e.createFakeParserElement(B,"ke_video","video",true)}},embed:function(B){if(!v.isFlashEmbed(B))return null;if(f(B.getAttribute("src")))return e.createFakeParserElement(B,"ke_video","video",true)}}},4);var y=new s({editor:c,cls:"ke_video",
type:"video",pluginConfig:this.config,bubbleId:"video",contextMenuId:"video",contextMenuHandlers:{"\u89c6\u9891\u5c5e\u6027":function(){var B=this.get("editorSelectedEl");B&&y.show(B)}}});c.addButton("video",{tooltip:"\u63d2\u5165\u89c6\u9891",listeners:{click:function(){y.show()}},mode:u.WYSIWYG_MODE})}});return g},{requires:["editor","../flash-common/utils","../flash-common/baseClass","../fake-objects/"]});
KISSY.add("editor/plugin/xiami-music/index",function(i,u,v,s,k){function g(){g.superclass.constructor.apply(this,arguments)}function c(f){this.config=f||{}}i.extend(g,v,{_updateTip:function(f,e){var n=this.get("editor").restoreRealElement(e);if(n){f.html(e.attr("title"));f.attr("href",this._getFlashUrl(n))}}});i.augment(c,{pluginRenderUI:function(f){function e(y){return/xiami\.com/i.test(y)}k.init(f);var n=f.htmlDataProcessor,j=n&&n.dataFilter;j&&j.addRules({tags:{object:function(y){var B=y.getAttribute("title"),
o,b;o=y.getAttribute("classid");var a=y.childNodes;if(!o){for(o=0;o<a.length;o++){b=a[o];if(b.nodeName=="embed"){if(!s.isFlashEmbed(b))break;if(e(b.attributes.src))return n.createFakeParserElement(y,"ke_xiami","xiami-music",true,{title:B})}}return null}for(o=0;o<a.length;o++){b=a[o];if(b.nodeName=="param"&&b.getAttribute("name").toLowerCase()=="movie")if(e(b.getAttribute("value")||b.getAttribute("VALUE")))return n.createFakeParserElement(y,"ke_xiami","xiami-music",true,{title:B})}},embed:function(y){if(s.isFlashEmbed(y)&&
e(y.getAttribute("src")))return n.createFakeParserElement(y,"ke_xiami","xiami-music",true,{title:y.getAttribute("title")})}}},4);var l=new g({editor:f,cls:"ke_xiami",type:"xiami-music",bubbleId:"xiami",pluginConfig:this.config,contextMenuId:"xiami",contextMenuHandlers:{"\u867e\u7c73\u5c5e\u6027":function(){var y=this.get("editorSelectedEl");y&&l.show(y)}}});f.addButton("xiamiMusic",{tooltip:"\u63d2\u5165\u867e\u7c73\u97f3\u4e50",listeners:{click:function(){l.show()}},mode:u.WYSIWYG_MODE})}});return c},{requires:["editor","../flash-common/baseClass",
"../flash-common/utils","../fake-objects/"]});KISSY.add("editor/full",function(i,u){return u},{requires:["editor"]});
